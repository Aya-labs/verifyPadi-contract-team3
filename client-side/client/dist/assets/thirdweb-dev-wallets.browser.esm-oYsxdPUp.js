import{g as Un,a as qn,r as Fn,h as Ht,f as Y,t as G,c as gs,d as jn,b as Yt,A as J,_ as W,W as oe,T as Jt,e as A,w as Z,S as Ci,i as kn,j as ys,B as ms,k as Zt,l as re,m as z,n as f,o as Xt,u as zn,p as Vn,q as Wn,s as Kn,v as Gn,x as Bn,y as Qn,z as Hn,C as Yn,D as Ai,E as Jn,F as Zn,G as Xn,H as fs,I as er,J as ws,K as ae,L as tr,M as sr,N as ir,O as nr,P as rr,Q as ar,R as or,U as cr,V as lr,X as hr,Y as ur,Z as dr,$ as pr,a0 as gr,a1 as yr,a2 as mr,a3 as fr,a4 as wr,a5 as br,a6 as vr,a7 as Er,a8 as Ir,a9 as Sr}from"./index-OE56k1X-.js";import{c as b,A as Ni,F as vt,V as bs,q as _r,f as ot,i as ne,a as ee,N as Ri,D as Tr,b as ct,d as lt,B as Pr,e as y,j as Cr,Q as Ar,s as ht,_ as Nr,g as be,h as ye,I as Ie,k as Rr,l as Oi,x as xi,r as Mi,H as Or,m as Li,n as xr,o as it,p as Mr,R as Lr,t as vs,u as $i,v as $r,w as Dr,y as Di,z as Ur,C as qr,E as $e,G as Fr,J as Es,K as jr,L as kr,M as zr,O as Vr,P as Wr}from"./index.es-c5c7QnKt.js";import{e as ce,$ as Ui}from"./tslib.es6-GVow8CXj.js";import{W as Kr,A as Gr,C as Br,P as Qr,S as Hr,U as Yr}from"./errors-3055a99c.browser.esm-nv5LXain.js";import{n as Jr}from"./normalizeChainId-e4cc0175.browser.esm-3qrEAm98.js";function Zr(i,e){return e=e||{},new Promise(function(t,s){var n=new XMLHttpRequest,r=[],a=[],o={},c=function(){return{ok:(n.status/100|0)==2,statusText:n.statusText,status:n.status,url:n.responseURL,text:function(){return Promise.resolve(n.responseText)},json:function(){return Promise.resolve(n.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([n.response]))},clone:c,headers:{keys:function(){return r},entries:function(){return a},get:function(h){return o[h.toLowerCase()]},has:function(h){return h.toLowerCase()in o}}}};for(var l in n.open(e.method||"get",i,!0),n.onload=function(){n.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(h,u,g){r.push(u=u.toLowerCase()),a.push([u,g]),o[u]=o[u]?o[u]+","+g:g}),t(c())},n.onerror=s,n.withCredentials=e.credentials=="include",e.headers)n.setRequestHeader(l,e.headers[l]);n.send(e.body||null)})}const Xr=Object.freeze(Object.defineProperty({__proto__:null,default:Zr},Symbol.toStringTag,{value:"Module"})),Is=Un(Xr);var ea=self.fetch||(self.fetch=Is.default||Is);const ta=qn(ea);let sa=class{constructor(e){this.client=e}},ia=class{constructor(e){this.opts=e}};const na="https://rpc.walletconnect.com/v1",Ge={wc_authRequest:{req:{ttl:y.ONE_DAY,prompt:!0,tag:3e3},res:{ttl:y.ONE_DAY,prompt:!1,tag:3001}}},Et={min:y.FIVE_MINUTES,max:y.SEVEN_DAYS},qi="wc",ra=1,aa="auth",Ss="authClient",He=`${qi}@1:${aa}:`,Oe=`${He}:PUB_KEY`;function es(i){return i==null?void 0:i.split(":")}function oa(i){const e=i&&es(i);if(e)return e[3]}function ca(i){const e=i&&es(i);if(e)return e[2]+":"+e[3]}function _s(i){const e=i&&es(i);if(e)return e.pop()}async function la(i,e,t,s,n){switch(t.t){case"eip191":return ha(i,e,t.s);case"eip1271":return await ua(i,e,t.s,s,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}}function ha(i,e,t){return Fn(Ht(e),t).toLowerCase()===i.toLowerCase()}async function ua(i,e,t,s,n){try{const r="0x1626ba7e",a="0000000000000000000000000000000000000000000000000000000000000040",o="0000000000000000000000000000000000000000000000000000000000000041",c=t.substring(2),l=Ht(e).substring(2),h=r+l+a+o+c,u=await ta(`${na}/?chainId=${s}&projectId=${n}`,{method:"POST",body:JSON.stringify({id:da(),jsonrpc:"2.0",method:"eth_call",params:[{to:i,data:h},"latest"]})}),{result:g}=await u.json();return g?g.slice(0,r.length).toLowerCase()===r.toLowerCase():!1}catch(r){return console.error("isValidEip1271Signature: ",r),!1}}function da(){return Date.now()+Math.floor(Math.random()*1e3)}function Fi(i){return i.getAll().filter(e=>"requester"in e)}function ji(i,e){return Fi(i).find(t=>t.id===e)}function pa(i){const e=Cr(i.aud),t=new RegExp(`${i.domain}`).test(i.aud),s=!!i.nonce,n=i.type?i.type==="eip4361":!0,r=i.expiry;if(r&&!Ar(r,Et)){const{message:a}=Ri("MISSING_OR_INVALID",`request() expiry: ${r}. Expiry must be a number (in seconds) between ${Et.min} and ${Et.max}`);throw new Error(a)}return!!(e&&t&&s&&n)}function ga(i,e){return!!ji(e,i.id)}function ya(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(i):new Uint8Array(i)}function ma(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),s=0;s<t.length;s++)t[s]=255;for(var n=0;n<i.length;n++){var r=i.charAt(n),a=r.charCodeAt(0);if(t[a]!==255)throw new TypeError(r+" is ambiguous");t[a]=n}var o=i.length,c=i.charAt(0),l=Math.log(o)/Math.log(256),h=Math.log(256)/Math.log(o);function u(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var m=0,T=0,v=0,P=d.length;v!==P&&d[v]===0;)v++,m++;for(var E=(P-v)*h+1>>>0,w=new Uint8Array(E);v!==P;){for(var _=d[v],L=0,C=E-1;(_!==0||L<T)&&C!==-1;C--,L++)_+=256*w[C]>>>0,w[C]=_%o>>>0,_=_/o>>>0;if(_!==0)throw new Error("Non-zero carry");T=L,v++}for(var O=E-T;O!==E&&w[O]===0;)O++;for(var te=c.repeat(m);O<E;++O)te+=i.charAt(w[O]);return te}function g(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var m=0;if(d[m]!==" "){for(var T=0,v=0;d[m]===c;)T++,m++;for(var P=(d.length-m)*l+1>>>0,E=new Uint8Array(P);d[m];){var w=t[d.charCodeAt(m)];if(w===255)return;for(var _=0,L=P-1;(w!==0||_<v)&&L!==-1;L--,_++)w+=o*E[L]>>>0,E[L]=w%256>>>0,w=w/256>>>0;if(w!==0)throw new Error("Non-zero carry");v=_,m++}if(d[m]!==" "){for(var C=P-v;C!==P&&E[C]===0;)C++;for(var O=new Uint8Array(T+(P-C)),te=T;C!==P;)O[te++]=E[C++];return O}}}function S(d){var m=g(d);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:u,decodeUnsafe:g,decode:S}}var fa=ma,wa=fa;const ki=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},ba=i=>new TextEncoder().encode(i),va=i=>new TextDecoder().decode(i);let Ea=class{constructor(e,t,s){this.name=e,this.prefix=t,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Ia=class{constructor(e,t,s){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return zi(this,e)}},Sa=class{constructor(e){this.decoders=e}or(e){return zi(this,e)}decode(e){const t=e[0],s=this.decoders[t];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const zi=(i,e)=>new Sa({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}});let _a=class{constructor(e,t,s,n){this.name=e,this.prefix=t,this.baseEncode=s,this.baseDecode=n,this.encoder=new Ea(e,t,s),this.decoder=new Ia(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const ut=({name:i,prefix:e,encode:t,decode:s})=>new _a(i,e,t,s),De=({prefix:i,name:e,alphabet:t})=>{const{encode:s,decode:n}=wa(t,e);return ut({prefix:i,name:e,encode:s,decode:r=>ki(n(r))})},Ta=(i,e,t,s)=>{const n={};for(let h=0;h<e.length;++h)n[e[h]]=h;let r=i.length;for(;i[r-1]==="=";)--r;const a=new Uint8Array(r*t/8|0);let o=0,c=0,l=0;for(let h=0;h<r;++h){const u=n[i[h]];if(u===void 0)throw new SyntaxError(`Non-${s} character`);c=c<<t|u,o+=t,o>=8&&(o-=8,a[l++]=255&c>>o)}if(o>=t||255&c<<8-o)throw new SyntaxError("Unexpected end of data");return a},Pa=(i,e,t)=>{const s=e[e.length-1]==="=",n=(1<<t)-1;let r="",a=0,o=0;for(let c=0;c<i.length;++c)for(o=o<<8|i[c],a+=8;a>t;)a-=t,r+=e[n&o>>a];if(a&&(r+=e[n&o<<t-a]),s)for(;r.length*t&7;)r+="=";return r},$=({name:i,prefix:e,bitsPerChar:t,alphabet:s})=>ut({prefix:e,name:i,encode(n){return Pa(n,s,t)},decode(n){return Ta(n,s,t,i)}}),Ca=ut({prefix:"\0",name:"identity",encode:i=>va(i),decode:i=>ba(i)});var Aa=Object.freeze({__proto__:null,identity:Ca});const Na=$({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Ra=Object.freeze({__proto__:null,base2:Na});const Oa=$({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var xa=Object.freeze({__proto__:null,base8:Oa});const Ma=De({prefix:"9",name:"base10",alphabet:"0123456789"});var La=Object.freeze({__proto__:null,base10:Ma});const $a=$({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Da=$({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Ua=Object.freeze({__proto__:null,base16:$a,base16upper:Da});const qa=$({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Fa=$({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ja=$({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ka=$({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),za=$({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Va=$({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Wa=$({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Ka=$({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Ga=$({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Ba=Object.freeze({__proto__:null,base32:qa,base32upper:Fa,base32pad:ja,base32padupper:ka,base32hex:za,base32hexupper:Va,base32hexpad:Wa,base32hexpadupper:Ka,base32z:Ga});const Qa=De({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Ha=De({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Ya=Object.freeze({__proto__:null,base36:Qa,base36upper:Ha});const Ja=De({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Za=De({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Xa=Object.freeze({__proto__:null,base58btc:Ja,base58flickr:Za});const eo=$({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),to=$({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),so=$({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),io=$({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var no=Object.freeze({__proto__:null,base64:eo,base64pad:to,base64url:so,base64urlpad:io});const Vi=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),ro=Vi.reduce((i,e,t)=>(i[t]=e,i),[]),ao=Vi.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function oo(i){return i.reduce((e,t)=>(e+=ro[t],e),"")}function co(i){const e=[];for(const t of i){const s=ao[t.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}const lo=ut({prefix:"ðŸš€",name:"base256emoji",encode:oo,decode:co});var ho=Object.freeze({__proto__:null,base256emoji:lo}),uo=Wi,Ts=128,po=127,go=~po,yo=Math.pow(2,31);function Wi(i,e,t){e=e||[],t=t||0;for(var s=t;i>=yo;)e[t++]=i&255|Ts,i/=128;for(;i&go;)e[t++]=i&255|Ts,i>>>=7;return e[t]=i|0,Wi.bytes=t-s+1,e}var mo=qt,fo=128,Ps=127;function qt(i,s){var t=0,s=s||0,n=0,r=s,a,o=i.length;do{if(r>=o)throw qt.bytes=0,new RangeError("Could not decode varint");a=i[r++],t+=n<28?(a&Ps)<<n:(a&Ps)*Math.pow(2,n),n+=7}while(a>=fo);return qt.bytes=r-s,t}var wo=Math.pow(2,7),bo=Math.pow(2,14),vo=Math.pow(2,21),Eo=Math.pow(2,28),Io=Math.pow(2,35),So=Math.pow(2,42),_o=Math.pow(2,49),To=Math.pow(2,56),Po=Math.pow(2,63),Co=function(i){return i<wo?1:i<bo?2:i<vo?3:i<Eo?4:i<Io?5:i<So?6:i<_o?7:i<To?8:i<Po?9:10},Ao={encode:uo,decode:mo,encodingLength:Co},Ki=Ao;const Cs=(i,e,t=0)=>(Ki.encode(i,e,t),e),As=i=>Ki.encodingLength(i),Ft=(i,e)=>{const t=e.byteLength,s=As(i),n=s+As(t),r=new Uint8Array(n+t);return Cs(i,r,0),Cs(t,r,s),r.set(e,n),new No(i,t,e,r)};class No{constructor(e,t,s,n){this.code=e,this.size=t,this.digest=s,this.bytes=n}}const Gi=({name:i,code:e,encode:t})=>new Ro(i,e,t);let Ro=class{constructor(e,t,s){this.name=e,this.code=t,this.encode=s}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ft(this.code,t):t.then(s=>Ft(this.code,s))}else throw Error("Unknown type, must be binary type")}};const Bi=i=>async e=>new Uint8Array(await crypto.subtle.digest(i,e)),Oo=Gi({name:"sha2-256",code:18,encode:Bi("SHA-256")}),xo=Gi({name:"sha2-512",code:19,encode:Bi("SHA-512")});var Mo=Object.freeze({__proto__:null,sha256:Oo,sha512:xo});const Qi=0,Lo="identity",Hi=ki,$o=i=>Ft(Qi,Hi(i)),Do={code:Qi,name:Lo,encode:Hi,digest:$o};var Uo=Object.freeze({__proto__:null,identity:Do});new TextEncoder,new TextDecoder;const Ns={...Aa,...Ra,...xa,...La,...Ua,...Ba,...Ya,...Xa,...no,...ho};({...Mo,...Uo});function Yi(i,e,t,s){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:s}}}const Rs=Yi("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),It=Yi("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=ya(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),Ji={utf8:Rs,"utf-8":Rs,hex:Ns.base16,latin1:It,ascii:It,binary:It,...Ns};function qo(i,e="utf8"){const t=Ji[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i,"utf8"):t.decoder.decode(`${t.prefix}${i}`)}function Fo(i,e="utf8"){const t=Ji[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(i.buffer,i.byteOffset,i.byteLength).toString("utf8"):t.encoder.encode(i).substring(1)}const jo="base16",ko="utf8";function Os(i){const e=ht.hash(qo(i,ko));return Fo(e,jo)}var zo=Object.defineProperty,Vo=Object.defineProperties,Wo=Object.getOwnPropertyDescriptors,xs=Object.getOwnPropertySymbols,Ko=Object.prototype.hasOwnProperty,Go=Object.prototype.propertyIsEnumerable,Ms=(i,e,t)=>e in i?zo(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Pe=(i,e)=>{for(var t in e||(e={}))Ko.call(e,t)&&Ms(i,t,e[t]);if(xs)for(var t of xs(e))Go.call(e,t)&&Ms(i,t,e[t]);return i},St=(i,e)=>Vo(i,Wo(e));class Bo extends sa{constructor(e){super(e),this.initialized=!1,this.name="authEngine",this.init=()=>{this.initialized||(this.registerRelayerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Ge)}),this.initialized=!0)},this.request=async(t,s)=>{if(this.isInitialized(),!pa(t))throw new Error("Invalid request");if(s!=null&&s.topic)return await this.requestOnKnownPairing(s.topic,t);const{chainId:n,statement:r,aud:a,domain:o,nonce:c,type:l,exp:h,nbf:u}=t,{topic:g,uri:S}=await this.client.core.pairing.create();this.client.logger.info({message:"Generated new pairing",pairing:{topic:g,uri:S}});const d=await this.client.core.crypto.generateKeyPair(),m=bs(d);await this.client.authKeys.set(Oe,{responseTopic:m,publicKey:d}),await this.client.pairingTopics.set(m,{topic:m,pairingTopic:g}),await this.client.core.relayer.subscribe(m),this.client.logger.info(`sending request to new pairing topic: ${g}`);const T=await this.sendRequest(g,"wc_authRequest",{payloadParams:{type:l??"eip4361",chainId:n,statement:r,aud:a,domain:o,version:"1",nonce:c,iat:new Date().toISOString(),exp:h,nbf:u},requester:{publicKey:d,metadata:this.client.metadata}},{},t.expiry);return this.client.logger.info(`sent request to new pairing topic: ${g}`),{uri:S,id:T}},this.respond=async(t,s)=>{if(this.isInitialized(),!ga(t,this.client.requests))throw new Error("Invalid response");const n=ji(this.client.requests,t.id);if(!n)throw new Error(`Could not find pending auth request with id ${t.id}`);const r=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),o=bs(r),c={type:Nr,receiverPublicKey:r,senderPublicKey:a};if("error"in t){await this.sendError(n.id,o,t,c);return}const l={h:{t:"eip4361"},p:St(Pe({},n.cacaoPayload),{iss:s}),s:t.signature};await this.sendResult(n.id,o,l,c),await this.client.core.pairing.activate({topic:n.pairingTopic}),await this.client.requests.update(n.id,Pe({},l))},this.getPendingRequests=()=>Fi(this.client.requests),this.formatMessage=(t,s)=>{this.client.logger.debug(`formatMessage, cacao is: ${JSON.stringify(t)}`);const n=`${t.domain} wants you to sign in with your Ethereum account:`,r=_s(s),a=t.statement,o=`URI: ${t.aud}`,c=`Version: ${t.version}`,l=`Chain ID: ${oa(s)}`,h=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,g=t.exp?`Expiry: ${t.exp}`:void 0,S=t.resources&&t.resources.length>0?`Resources:
${t.resources.map(d=>`- ${d}`).join(`
`)}`:void 0;return[n,r,"",a,"",o,c,l,h,u,g,S].filter(d=>d!=null).join(`
`)},this.setExpiry=async(t,s)=>{this.client.core.pairing.pairings.keys.includes(t)&&await this.client.core.pairing.updateExpiry({topic:t,expiry:s}),this.client.core.expirer.set(t,s)},this.sendRequest=async(t,s,n,r,a)=>{const o=be(s,n),c=await this.client.core.crypto.encode(t,o,r),l=Ge[s].req;if(a&&(l.ttl=a),this.client.core.history.set(t,o),_r()){const h=Os(JSON.stringify(o));this.client.core.verify.register({attestationId:h})}return await this.client.core.relayer.publish(t,c,St(Pe({},l),{internal:{throwOnFailedPublish:!0}})),o.id},this.sendResult=async(t,s,n,r)=>{const a=ye(t,n),o=await this.client.core.crypto.encode(s,a,r),c=await this.client.core.history.get(s,t),l=Ge[c.request.method].res;return await this.client.core.relayer.publish(s,o,St(Pe({},l),{internal:{throwOnFailedPublish:!0}})),await this.client.core.history.resolve(a),a.id},this.sendError=async(t,s,n,r)=>{const a=ot(t,n.error),o=await this.client.core.crypto.encode(s,a,r),c=await this.client.core.history.get(s,t),l=Ge[c.request.method].res;return await this.client.core.relayer.publish(s,o,l),await this.client.core.history.resolve(a),a.id},this.requestOnKnownPairing=async(t,s)=>{const n=this.client.core.pairing.pairings.getAll({active:!0}).find(S=>S.topic===t);if(!n)throw new Error(`Could not find pairing for provided topic ${t}`);const{publicKey:r}=this.client.authKeys.get(Oe),{chainId:a,statement:o,aud:c,domain:l,nonce:h,type:u}=s,g=await this.sendRequest(n.topic,"wc_authRequest",{payloadParams:{type:u??"eip4361",chainId:a,statement:o,aud:c,domain:l,version:"1",nonce:h,iat:new Date().toISOString()},requester:{publicKey:r,metadata:this.client.metadata}},{},s.expiry);return this.client.logger.info(`sent request to known pairing topic: ${n.topic}`),{id:g}},this.onPairingCreated=t=>{const s=this.getPendingRequests();if(s){const n=Object.values(s).find(r=>r.pairingTopic===t.topic);n&&this.handleAuthRequest(n)}},this.onRelayEventRequest=t=>{const{topic:s,payload:n}=t,r=n.method;switch(r){case"wc_authRequest":return this.onAuthRequest(s,n);default:return this.client.logger.info(`Unsupported request method ${r}`)}},this.onRelayEventResponse=async t=>{const{topic:s,payload:n}=t,r=(await this.client.core.history.get(s,n.id)).request.method;switch(r){case"wc_authRequest":return this.onAuthResponse(s,n);default:return this.client.logger.info(`Unsupported response method ${r}`)}},this.onAuthRequest=async(t,s)=>{const{requester:n,payloadParams:r}=s.params;this.client.logger.info({type:"onAuthRequest",topic:t,payload:s});const a=Os(JSON.stringify(s)),o=await this.getVerifyContext(a,this.client.metadata),c={requester:n,pairingTopic:t,id:s.id,cacaoPayload:r,verifyContext:o};await this.client.requests.set(s.id,c),this.handleAuthRequest(c)},this.handleAuthRequest=async t=>{const{id:s,pairingTopic:n,requester:r,cacaoPayload:a,verifyContext:o}=t;try{this.client.emit("auth_request",{id:s,topic:n,params:{requester:r,cacaoPayload:a},verifyContext:o})}catch(c){await this.sendError(t.id,t.pairingTopic,c),this.client.logger.error(c)}},this.onAuthResponse=async(t,s)=>{const{id:n}=s;if(this.client.logger.info({type:"onAuthResponse",topic:t,response:s}),ne(s)){const{pairingTopic:r}=this.client.pairingTopics.get(t);await this.client.core.pairing.activate({topic:r});const{s:a,p:o}=s.result;await this.client.requests.set(n,Pe({id:n,pairingTopic:r},s.result));const c=this.formatMessage(o,o.iss);this.client.logger.debug(`reconstructed message:
`,JSON.stringify(c)),this.client.logger.debug("payload.iss:",o.iss),this.client.logger.debug("signature:",a);const l=_s(o.iss),h=ca(o.iss);if(!l)throw new Error("Could not derive address from `payload.iss`");if(!h)throw new Error("Could not derive chainId from `payload.iss`");this.client.logger.debug("walletAddress extracted from `payload.iss`:",l),await la(l,c,a,h,this.client.projectId)?this.client.emit("auth_response",{id:n,topic:t,params:s}):this.client.emit("auth_response",{id:n,topic:t,params:{message:"Invalid signature",code:-1}})}else ee(s)&&this.client.emit("auth_response",{id:n,topic:t,params:s})},this.getVerifyContext=async(t,s)=>{const n={verified:{verifyUrl:s.verifyUrl||"",validation:"UNKNOWN",origin:s.url||""}};try{const r=await this.client.core.verify.resolve({attestationId:t,verifyUrl:s.verifyUrl});r&&(n.verified.origin=r.origin,n.verified.isScam=r.isScam,n.verified.validation=origin===new URL(s.url).origin?"VALID":"INVALID")}catch(r){this.client.logger.error(r)}return this.client.logger.info(`Verify context: ${JSON.stringify(n)}`),n}}isInitialized(){if(!this.initialized){const{message:e}=Ri("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(Tr.message,async e=>{const{topic:t,message:s}=e,{responseTopic:n,publicKey:r}=this.client.authKeys.keys.includes(Oe)?this.client.authKeys.get(Oe):{responseTopic:void 0,publicKey:void 0};if(n&&t!==n){this.client.logger.debug("[Auth] Ignoring message from unknown topic",t);return}const a=await this.client.core.crypto.decode(t,s,{receiverPublicKey:r});ct(a)?(this.client.core.history.set(t,a),this.onRelayEventRequest({topic:t,payload:a})):lt(a)&&(await this.client.core.history.resolve(a),this.onRelayEventResponse({topic:t,payload:a}))})}registerPairingEvents(){this.client.core.pairing.events.on(Pr.create,e=>this.onPairingCreated(e))}}let Qo=class Zi extends ia{constructor(e){super(e),this.protocol=qi,this.version=ra,this.name=Ss,this.events=new ce.EventEmitter,this.emit=(s,n)=>this.events.emit(s,n),this.on=(s,n)=>this.events.on(s,n),this.once=(s,n)=>this.events.once(s,n),this.off=(s,n)=>this.events.off(s,n),this.removeListener=(s,n)=>this.events.removeListener(s,n),this.request=async(s,n)=>{try{return await this.engine.request(s,n)}catch(r){throw this.logger.error(r.message),r}},this.respond=async(s,n)=>{try{return await this.engine.respond(s,n)}catch(r){throw this.logger.error(r.message),r}},this.getPendingRequests=()=>{try{return this.engine.getPendingRequests()}catch(s){throw this.logger.error(s.message),s}},this.formatMessage=(s,n)=>{try{return this.engine.formatMessage(s,n)}catch(r){throw this.logger.error(r.message),r}};const t=typeof e.logger<"u"&&typeof e.logger!="string"?e.logger:b.pino(b.getDefaultLoggerOptions({level:e.logger||"error"}));this.name=(e==null?void 0:e.name)||Ss,this.metadata=e.metadata,this.projectId=e.projectId,this.core=e.core||new Ni(e),this.logger=b.generateChildLogger(t,this.name),this.authKeys=new vt(this.core,this.logger,"authKeys",He,()=>Oe),this.pairingTopics=new vt(this.core,this.logger,"pairingTopics",He),this.requests=new vt(this.core,this.logger,"requests",He,s=>s.id),this.engine=new Bo(this)}static async init(e){const t=new Zi(e);return await t.initialize(),t}get context(){return b.getLoggerContext(this.logger)}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.authKeys.init(),await this.requests.init(),await this.pairingTopics.init(),await this.engine.init(),this.logger.info("AuthClient Initialization Success"),this.logger.info({authClient:this})}catch(e){throw this.logger.info("AuthClient Initialization Failure"),this.logger.error(e.message),e}}};const Ho=Qo;class Yo extends Ie{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let Jo=class extends Ie{constructor(e,t){super(),this.core=e,this.logger=t,this.records=new Map}},Zo=class{constructor(e,t){this.logger=e,this.core=t}},Xo=class extends Ie{constructor(e,t){super(),this.relayer=e,this.logger=t}},ec=class extends Ie{constructor(e){super()}},tc=class{constructor(e,t,s,n){this.core=e,this.logger=t,this.name=s}},sc=class extends Ie{constructor(e,t){super(),this.relayer=e,this.logger=t}},ic=class extends Ie{constructor(e,t){super(),this.core=e,this.logger=t}},nc=class{constructor(e,t){this.projectId=e,this.logger=t}},rc=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},ac=class{constructor(e){this.client=e}};function Xi(i,e){return i.includes(":")?[i]:e.chains||[]}const en="base10",F="base16",jt="base64pad",ts="utf8",tn=0,me=1,oc=0,Ls=1,kt=12,ss=32;function cc(){const i=xi.generateKeyPair();return{privateKey:G(i.secretKey,F),publicKey:G(i.publicKey,F)}}function zt(){const i=Mi.randomBytes(ss);return G(i,F)}function lc(i,e){const t=xi.sharedKey(Y(i,F),Y(e,F),!0),s=new Or(ht.SHA256,t).expand(ss);return G(s,F)}function hc(i){const e=ht.hash(Y(i,F));return G(e,F)}function ve(i){const e=ht.hash(Y(i,ts));return G(e,F)}function uc(i){return Y(`${i}`,en)}function Ue(i){return Number(G(i,en))}function dc(i){const e=uc(typeof i.type<"u"?i.type:tn);if(Ue(e)===me&&typeof i.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof i.senderPublicKey<"u"?Y(i.senderPublicKey,F):void 0,s=typeof i.iv<"u"?Y(i.iv,F):Mi.randomBytes(kt),n=new Li.ChaCha20Poly1305(Y(i.symKey,F)).seal(s,Y(i.message,ts));return gc({type:e,sealed:n,iv:s,senderPublicKey:t})}function pc(i){const e=new Li.ChaCha20Poly1305(Y(i.symKey,F)),{sealed:t,iv:s}=nt(i.encoded),n=e.open(s,t);if(n===null)throw new Error("Failed to decrypt");return G(n,ts)}function gc(i){if(Ue(i.type)===me){if(typeof i.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return G(gs([i.type,i.senderPublicKey,i.iv,i.sealed]),jt)}return G(gs([i.type,i.iv,i.sealed]),jt)}function nt(i){const e=Y(i,jt),t=e.slice(oc,Ls),s=Ls;if(Ue(t)===me){const o=s+ss,c=o+kt,l=e.slice(s,o),h=e.slice(o,c),u=e.slice(c);return{type:t,sealed:u,iv:h,senderPublicKey:l}}const n=s+kt,r=e.slice(s,n),a=e.slice(n);return{type:t,sealed:a,iv:r}}function yc(i,e){const t=nt(i);return sn({type:Ue(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?G(t.senderPublicKey,F):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function sn(i){const e=(i==null?void 0:i.type)||tn;if(e===me){if(typeof(i==null?void 0:i.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(i==null?void 0:i.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:i==null?void 0:i.senderPublicKey,receiverPublicKey:i==null?void 0:i.receiverPublicKey}}function $s(i){return i.type===me&&typeof i.senderPublicKey=="string"&&typeof i.receiverPublicKey=="string"}var mc=Object.defineProperty,Ds=Object.getOwnPropertySymbols,fc=Object.prototype.hasOwnProperty,wc=Object.prototype.propertyIsEnumerable,Us=(i,e,t)=>e in i?mc(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,qs=(i,e)=>{for(var t in e||(e={}))fc.call(e,t)&&Us(i,t,e[t]);if(Ds)for(var t of Ds(e))wc.call(e,t)&&Us(i,t,e[t]);return i};const bc="ReactNative",V={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},vc="js";function is(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Se(){return!xr()&&!!Oi()&&navigator.product===bc}function qe(){return!is()&&!!Oi()}function Fe(){return Se()?V.reactNative:is()?V.node:qe()?V.browser:V.unknown}function Ec(){var i;try{return Se()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(i=global.Application)==null?void 0:i.applicationId:void 0}catch{return}}function Ic(i,e){let t=it.parse(i);return t=qs(qs({},t),e),i=it.stringify(t),i}function Sc(){return Rr()||{name:"",description:"",url:"",icons:[""]}}function _c(){if(Fe()===V.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:t,Version:s}=global.Platform;return[t,s].join("-")}const i=jn();if(i===null)return"unknown";const e=i.os?i.os.replace(" ","").toLowerCase():"unknown";return i.type==="browser"?[e,i.name,i.version].join("-"):[e,i.version].join("-")}function Tc(){var i;const e=Fe();return e===V.browser?[e,((i=Mr())==null?void 0:i.host)||"unknown"].join(":"):e}function Pc(i,e,t){const s=_c(),n=Tc();return[[i,e].join("-"),[vc,t].join("-"),s,n].join("/")}function Cc({protocol:i,version:e,relayUrl:t,sdkVersion:s,auth:n,projectId:r,useOnCloseEvent:a,bundleId:o}){const c=t.split("?"),l=Pc(i,e,s),h={auth:n,ua:l,projectId:r,useOnCloseEvent:a||void 0,origin:o||void 0},u=Ic(c[1]||"",h);return c[0]+"?"+u}function ge(i,e){return i.filter(t=>e.includes(t)).length===i.length}function nn(i){return Object.fromEntries(i.entries())}function rn(i){return new Map(Object.entries(i))}function fe(i=y.FIVE_MINUTES,e){const t=y.toMiliseconds(i||y.FIVE_MINUTES);let s,n,r;return{resolve:a=>{r&&s&&(clearTimeout(r),s(a))},reject:a=>{r&&n&&(clearTimeout(r),n(a))},done:()=>new Promise((a,o)=>{r=setTimeout(()=>{o(new Error(e))},t),s=a,n=o})}}function Le(i,e,t){return new Promise(async(s,n)=>{const r=setTimeout(()=>n(new Error(t)),e);try{const a=await i;s(a)}catch(a){n(a)}clearTimeout(r)})}function an(i,e){if(typeof e=="string"&&e.startsWith(`${i}:`))return e;if(i.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(i.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${i}`)}function Ac(i){return an("topic",i)}function Nc(i){return an("id",i)}function on(i){const[e,t]=i.split(":"),s={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")s.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))s.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return s}function Q(i,e){return y.fromMiliseconds((e||Date.now())+y.toMiliseconds(i))}function le(i){return Date.now()>=y.toMiliseconds(i)}function N(i,e){return`${i}${e?`:${e}`:""}`}async function Rc({id:i,topic:e,wcDeepLink:t}){try{if(!t)return;const s=typeof t=="string"?JSON.parse(t):t;let n=s==null?void 0:s.href;if(typeof n!="string")return;n.endsWith("/")&&(n=n.slice(0,-1));const r=`${n}/wc?requestId=${i}&sessionTopic=${e}`,a=Fe();a===V.browser?r.startsWith("https://")?window.open(r,"_blank","noreferrer noopener"):window.open(r,"_self","noreferrer noopener"):a===V.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(r)}catch(s){console.error(s)}}const Oc="irn";function Vt(i){return(i==null?void 0:i.relay)||{protocol:Oc}}function Ye(i){const e=Lr[i];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${i}`);return e}var xc=Object.defineProperty,Fs=Object.getOwnPropertySymbols,Mc=Object.prototype.hasOwnProperty,Lc=Object.prototype.propertyIsEnumerable,js=(i,e,t)=>e in i?xc(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$c=(i,e)=>{for(var t in e||(e={}))Mc.call(e,t)&&js(i,t,e[t]);if(Fs)for(var t of Fs(e))Lc.call(e,t)&&js(i,t,e[t]);return i};function Dc(i,e="-"){const t={},s="relay"+e;return Object.keys(i).forEach(n=>{if(n.startsWith(s)){const r=n.replace(s,""),a=i[n];t[r]=a}}),t}function Uc(i){i=i.includes("wc://")?i.replace("wc://",""):i,i=i.includes("wc:")?i.replace("wc:",""):i;const e=i.indexOf(":"),t=i.indexOf("?")!==-1?i.indexOf("?"):void 0,s=i.substring(0,e),n=i.substring(e+1,t).split("@"),r=typeof t<"u"?i.substring(t):"",a=it.parse(r);return{protocol:s,topic:qc(n[0]),version:parseInt(n[1],10),symKey:a.symKey,relay:Dc(a)}}function qc(i){return i.startsWith("//")?i.substring(2):i}function Fc(i,e="-"){const t="relay",s={};return Object.keys(i).forEach(n=>{const r=t+e+n;i[n]&&(s[r]=i[n])}),s}function jc(i){return`${i.protocol}:${i.topic}@${i.version}?`+it.stringify($c({symKey:i.symKey},Fc(i.relay)))}function _e(i){const e=[];return i.forEach(t=>{const[s,n]=t.split(":");e.push(`${s}:${n}`)}),e}function kc(i){const e=[];return Object.values(i).forEach(t=>{e.push(..._e(t.accounts))}),e}function zc(i,e){const t=[];return Object.values(i).forEach(s=>{_e(s.accounts).includes(e)&&t.push(...s.methods)}),t}function Vc(i,e){const t=[];return Object.values(i).forEach(s=>{_e(s.accounts).includes(e)&&t.push(...s.events)}),t}function Wc(i,e){const t=Je(i,e);if(t)throw new Error(t.message);const s={};for(const[n,r]of Object.entries(i))s[n]={methods:r.methods,events:r.events,chains:r.accounts.map(a=>`${a.split(":")[0]}:${a.split(":")[1]}`)};return s}const Kc={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Gc={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function p(i,e){const{message:t,code:s}=Gc[i];return{message:e?`${t} ${e}`:t,code:s}}function x(i,e){const{message:t,code:s}=Kc[i];return{message:e?`${t} ${e}`:t,code:s}}function je(i,e){return Array.isArray(i)?typeof e<"u"&&i.length?i.every(e):!0:!1}function Me(i){return Object.getPrototypeOf(i)===Object.prototype&&Object.keys(i).length}function q(i){return typeof i>"u"}function M(i,e){return e&&q(i)?!0:typeof i=="string"&&!!i.trim().length}function ns(i,e){return e&&q(i)?!0:typeof i=="number"&&!isNaN(i)}function Bc(i,e){const{requiredNamespaces:t}=e,s=Object.keys(i.namespaces),n=Object.keys(t);let r=!0;return ge(n,s)?(s.forEach(a=>{const{accounts:o,methods:c,events:l}=i.namespaces[a],h=_e(o),u=t[a];(!ge(Xi(a,u),h)||!ge(u.methods,c)||!ge(u.events,l))&&(r=!1)}),r):!1}function rt(i){return M(i,!1)&&i.includes(":")?i.split(":").length===2:!1}function Qc(i){if(M(i,!1)&&i.includes(":")){const e=i.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&rt(t)}}return!1}function Hc(i){if(M(i,!1))try{return typeof new URL(i)<"u"}catch{return!1}return!1}function Yc(i){var e;return(e=i==null?void 0:i.proposer)==null?void 0:e.publicKey}function Jc(i){return i==null?void 0:i.topic}function Zc(i,e){let t=null;return M(i==null?void 0:i.publicKey,!1)||(t=p("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function ks(i){let e=!0;return je(i)?i.length&&(e=i.every(t=>M(t,!1))):e=!1,e}function Xc(i,e,t){let s=null;return je(e)&&e.length?e.forEach(n=>{s||rt(n)||(s=x("UNSUPPORTED_CHAINS",`${t}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):rt(i)||(s=x("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function el(i,e,t){let s=null;return Object.entries(i).forEach(([n,r])=>{if(s)return;const a=Xc(n,Xi(n,r),`${e} ${t}`);a&&(s=a)}),s}function tl(i,e){let t=null;return je(i)?i.forEach(s=>{t||Qc(s)||(t=x("UNSUPPORTED_ACCOUNTS",`${e}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):t=x("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function sl(i,e){let t=null;return Object.values(i).forEach(s=>{if(t)return;const n=tl(s==null?void 0:s.accounts,`${e} namespace`);n&&(t=n)}),t}function il(i,e){let t=null;return ks(i==null?void 0:i.methods)?ks(i==null?void 0:i.events)||(t=x("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=x("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function cn(i,e){let t=null;return Object.values(i).forEach(s=>{if(t)return;const n=il(s,`${e}, namespace`);n&&(t=n)}),t}function nl(i,e,t){let s=null;if(i&&Me(i)){const n=cn(i,e);n&&(s=n);const r=el(i,e,t);r&&(s=r)}else s=p("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return s}function Je(i,e){let t=null;if(i&&Me(i)){const s=cn(i,e);s&&(t=s);const n=sl(i,e);n&&(t=n)}else t=p("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function ln(i){return M(i.protocol,!0)}function rl(i,e){let t=!1;return e&&!i?t=!0:i&&je(i)&&i.length&&i.forEach(s=>{t=ln(s)}),t}function al(i){return typeof i=="number"}function k(i){return typeof i<"u"&&typeof i!==null}function ol(i){return!(!i||typeof i!="object"||!i.code||!ns(i.code,!1)||!i.message||!M(i.message,!1))}function cl(i){return!(q(i)||!M(i.method,!1))}function ll(i){return!(q(i)||q(i.result)&&q(i.error)||!ns(i.id,!1)||!M(i.jsonrpc,!1))}function hl(i){return!(q(i)||!M(i.name,!1))}function zs(i,e){return!(!rt(e)||!kc(i).includes(e))}function ul(i,e,t){return M(t,!1)?zc(i,e).includes(t):!1}function dl(i,e,t){return M(t,!1)?Vc(i,e).includes(t):!1}function Vs(i,e,t){let s=null;const n=pl(i),r=gl(e),a=Object.keys(n),o=Object.keys(r),c=Ws(Object.keys(i)),l=Ws(Object.keys(e)),h=c.filter(u=>!l.includes(u));return h.length&&(s=p("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${h.toString()}
      Received: ${Object.keys(e).toString()}`)),ge(a,o)||(s=p("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${a.toString()}
      Approved: ${o.toString()}`)),Object.keys(e).forEach(u=>{if(!u.includes(":")||s)return;const g=_e(e[u].accounts);g.includes(u)||(s=p("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${u}
        Required: ${u}
        Approved: ${g.toString()}`))}),a.forEach(u=>{s||(ge(n[u].methods,r[u].methods)?ge(n[u].events,r[u].events)||(s=p("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${u}`)):s=p("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${u}`))}),s}function pl(i){const e={};return Object.keys(i).forEach(t=>{var s;t.includes(":")?e[t]=i[t]:(s=i[t].chains)==null||s.forEach(n=>{e[n]={methods:i[t].methods,events:i[t].events}})}),e}function Ws(i){return[...new Set(i.map(e=>e.includes(":")?e.split(":")[0]:e))]}function gl(i){const e={};return Object.keys(i).forEach(t=>{if(t.includes(":"))e[t]=i[t];else{const s=_e(i[t].accounts);s==null||s.forEach(n=>{e[n]={accounts:i[t].accounts.filter(r=>r.includes(`${n}:`)),methods:i[t].methods,events:i[t].events}})}}),e}function yl(i,e){return ns(i,!1)&&i<=e.max&&i>=e.min}function Ks(){const i=Fe();return new Promise(e=>{switch(i){case V.browser:e(ml());break;case V.reactNative:e(fl());break;case V.node:e(wl());break;default:e(!0)}})}function ml(){return qe()&&(navigator==null?void 0:navigator.onLine)}async function fl(){if(Se()&&typeof global<"u"&&global!=null&&global.NetInfo){const i=await(global==null?void 0:global.NetInfo.fetch());return i==null?void 0:i.isConnected}return!0}function wl(){return!0}function bl(i){switch(Fe()){case V.browser:vl(i);break;case V.reactNative:El(i);break}}function vl(i){!Se()&&qe()&&(window.addEventListener("online",()=>i(!0)),window.addEventListener("offline",()=>i(!1)))}function El(i){Se()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>i(e==null?void 0:e.isConnected)))}const _t={};let Be=class{static get(e){return _t[e]}static set(e,t){_t[e]=t}static delete(e){delete _t[e]}};const Il=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Sl=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Gs=i=>i.split("?")[0],Bs=10,_l=Il();let Tl=class{constructor(e){if(this.url=e,this.events=new ce.EventEmitter,this.registering=!1,!vs(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send($i(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!vs(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((s,n)=>{this.events.once("register_error",r=>{this.resetMaxListeners(),n(r)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,s)=>{const n=new URLSearchParams(e).get("origin"),r=$r.isReactNative()?{headers:{origin:n}}:{rejectUnauthorized:!Dr(e)},a=new _l(e,[],r);Sl()?a.onerror=o=>{const c=o;s(this.emitError(c.error))}:a.on("error",o=>{s(this.emitError(o))}),a.onopen=()=>{this.onOpen(a),t(a)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?Di(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const s=this.parseError(t),n=s.message||s.toString(),r=ot(e,n);this.events.emit("payload",r)}parseError(e,t=this.url){return Ur(e,Gs(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Bs&&this.events.setMaxListeners(Bs)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${Gs(this.url)}`));return this.events.emit("register_error",t),t}};var Pl={};function Cl(i,e){if(i.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),s=0;s<t.length;s++)t[s]=255;for(var n=0;n<i.length;n++){var r=i.charAt(n),a=r.charCodeAt(0);if(t[a]!==255)throw new TypeError(r+" is ambiguous");t[a]=n}var o=i.length,c=i.charAt(0),l=Math.log(o)/Math.log(256),h=Math.log(256)/Math.log(o);function u(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var m=0,T=0,v=0,P=d.length;v!==P&&d[v]===0;)v++,m++;for(var E=(P-v)*h+1>>>0,w=new Uint8Array(E);v!==P;){for(var _=d[v],L=0,C=E-1;(_!==0||L<T)&&C!==-1;C--,L++)_+=256*w[C]>>>0,w[C]=_%o>>>0,_=_/o>>>0;if(_!==0)throw new Error("Non-zero carry");T=L,v++}for(var O=E-T;O!==E&&w[O]===0;)O++;for(var te=c.repeat(m);O<E;++O)te+=i.charAt(w[O]);return te}function g(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var m=0;if(d[m]!==" "){for(var T=0,v=0;d[m]===c;)T++,m++;for(var P=(d.length-m)*l+1>>>0,E=new Uint8Array(P);d[m];){var w=t[d.charCodeAt(m)];if(w===255)return;for(var _=0,L=P-1;(w!==0||_<v)&&L!==-1;L--,_++)w+=o*E[L]>>>0,E[L]=w%256>>>0,w=w/256>>>0;if(w!==0)throw new Error("Non-zero carry");v=_,m++}if(d[m]!==" "){for(var C=P-v;C!==P&&E[C]===0;)C++;for(var O=new Uint8Array(T+(P-C)),te=T;C!==P;)O[te++]=E[C++];return O}}}function S(d){var m=g(d);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:u,decodeUnsafe:g,decode:S}}var Al=Cl,Nl=Al;const hn=i=>{if(i instanceof Uint8Array&&i.constructor.name==="Uint8Array")return i;if(i instanceof ArrayBuffer)return new Uint8Array(i);if(ArrayBuffer.isView(i))return new Uint8Array(i.buffer,i.byteOffset,i.byteLength);throw new Error("Unknown type, must be binary type")},Rl=i=>new TextEncoder().encode(i),Ol=i=>new TextDecoder().decode(i);class xl{constructor(e,t,s){this.name=e,this.prefix=t,this.baseEncode=s}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Ml{constructor(e,t,s){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=s}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return un(this,e)}}class Ll{constructor(e){this.decoders=e}or(e){return un(this,e)}decode(e){const t=e[0],s=this.decoders[t];if(s)return s.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const un=(i,e)=>new Ll({...i.decoders||{[i.prefix]:i},...e.decoders||{[e.prefix]:e}});class $l{constructor(e,t,s,n){this.name=e,this.prefix=t,this.baseEncode=s,this.baseDecode=n,this.encoder=new xl(e,t,s),this.decoder=new Ml(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const dt=({name:i,prefix:e,encode:t,decode:s})=>new $l(i,e,t,s),ke=({prefix:i,name:e,alphabet:t})=>{const{encode:s,decode:n}=Nl(t,e);return dt({prefix:i,name:e,encode:s,decode:r=>hn(n(r))})},Dl=(i,e,t,s)=>{const n={};for(let h=0;h<e.length;++h)n[e[h]]=h;let r=i.length;for(;i[r-1]==="=";)--r;const a=new Uint8Array(r*t/8|0);let o=0,c=0,l=0;for(let h=0;h<r;++h){const u=n[i[h]];if(u===void 0)throw new SyntaxError(`Non-${s} character`);c=c<<t|u,o+=t,o>=8&&(o-=8,a[l++]=255&c>>o)}if(o>=t||255&c<<8-o)throw new SyntaxError("Unexpected end of data");return a},Ul=(i,e,t)=>{const s=e[e.length-1]==="=",n=(1<<t)-1;let r="",a=0,o=0;for(let c=0;c<i.length;++c)for(o=o<<8|i[c],a+=8;a>t;)a-=t,r+=e[n&o>>a];if(a&&(r+=e[n&o<<t-a]),s)for(;r.length*t&7;)r+="=";return r},D=({name:i,prefix:e,bitsPerChar:t,alphabet:s})=>dt({prefix:e,name:i,encode(n){return Ul(n,s,t)},decode(n){return Dl(n,s,t,i)}}),ql=dt({prefix:"\0",name:"identity",encode:i=>Ol(i),decode:i=>Rl(i)});var Fl=Object.freeze({__proto__:null,identity:ql});const jl=D({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var kl=Object.freeze({__proto__:null,base2:jl});const zl=D({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Vl=Object.freeze({__proto__:null,base8:zl});const Wl=ke({prefix:"9",name:"base10",alphabet:"0123456789"});var Kl=Object.freeze({__proto__:null,base10:Wl});const Gl=D({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Bl=D({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Ql=Object.freeze({__proto__:null,base16:Gl,base16upper:Bl});const Hl=D({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Yl=D({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Jl=D({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Zl=D({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Xl=D({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),eh=D({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),th=D({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),sh=D({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ih=D({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var nh=Object.freeze({__proto__:null,base32:Hl,base32upper:Yl,base32pad:Jl,base32padupper:Zl,base32hex:Xl,base32hexupper:eh,base32hexpad:th,base32hexpadupper:sh,base32z:ih});const rh=ke({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ah=ke({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var oh=Object.freeze({__proto__:null,base36:rh,base36upper:ah});const ch=ke({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),lh=ke({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var hh=Object.freeze({__proto__:null,base58btc:ch,base58flickr:lh});const uh=D({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),dh=D({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ph=D({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),gh=D({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var yh=Object.freeze({__proto__:null,base64:uh,base64pad:dh,base64url:ph,base64urlpad:gh});const dn=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),mh=dn.reduce((i,e,t)=>(i[t]=e,i),[]),fh=dn.reduce((i,e,t)=>(i[e.codePointAt(0)]=t,i),[]);function wh(i){return i.reduce((e,t)=>(e+=mh[t],e),"")}function bh(i){const e=[];for(const t of i){const s=fh[t.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}const vh=dt({prefix:"ðŸš€",name:"base256emoji",encode:wh,decode:bh});var Eh=Object.freeze({__proto__:null,base256emoji:vh}),Ih=pn,Qs=128,Sh=127,_h=~Sh,Th=Math.pow(2,31);function pn(i,e,t){e=e||[],t=t||0;for(var s=t;i>=Th;)e[t++]=i&255|Qs,i/=128;for(;i&_h;)e[t++]=i&255|Qs,i>>>=7;return e[t]=i|0,pn.bytes=t-s+1,e}var Ph=Wt,Ch=128,Hs=127;function Wt(i,s){var t=0,s=s||0,n=0,r=s,a,o=i.length;do{if(r>=o)throw Wt.bytes=0,new RangeError("Could not decode varint");a=i[r++],t+=n<28?(a&Hs)<<n:(a&Hs)*Math.pow(2,n),n+=7}while(a>=Ch);return Wt.bytes=r-s,t}var Ah=Math.pow(2,7),Nh=Math.pow(2,14),Rh=Math.pow(2,21),Oh=Math.pow(2,28),xh=Math.pow(2,35),Mh=Math.pow(2,42),Lh=Math.pow(2,49),$h=Math.pow(2,56),Dh=Math.pow(2,63),Uh=function(i){return i<Ah?1:i<Nh?2:i<Rh?3:i<Oh?4:i<xh?5:i<Mh?6:i<Lh?7:i<$h?8:i<Dh?9:10},qh={encode:Ih,decode:Ph,encodingLength:Uh},gn=qh;const Ys=(i,e,t=0)=>(gn.encode(i,e,t),e),Js=i=>gn.encodingLength(i),Kt=(i,e)=>{const t=e.byteLength,s=Js(i),n=s+Js(t),r=new Uint8Array(n+t);return Ys(i,r,0),Ys(t,r,s),r.set(e,n),new Fh(i,t,e,r)};class Fh{constructor(e,t,s,n){this.code=e,this.size=t,this.digest=s,this.bytes=n}}const yn=({name:i,code:e,encode:t})=>new jh(i,e,t);class jh{constructor(e,t,s){this.name=e,this.code=t,this.encode=s}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Kt(this.code,t):t.then(s=>Kt(this.code,s))}else throw Error("Unknown type, must be binary type")}}const mn=i=>async e=>new Uint8Array(await crypto.subtle.digest(i,e)),kh=yn({name:"sha2-256",code:18,encode:mn("SHA-256")}),zh=yn({name:"sha2-512",code:19,encode:mn("SHA-512")});var Vh=Object.freeze({__proto__:null,sha256:kh,sha512:zh});const fn=0,Wh="identity",wn=hn,Kh=i=>Kt(fn,wn(i)),Gh={code:fn,name:Wh,encode:wn,digest:Kh};var Bh=Object.freeze({__proto__:null,identity:Gh});new TextEncoder,new TextDecoder;const Zs={...Fl,...kl,...Vl,...Kl,...Ql,...nh,...oh,...hh,...yh,...Eh};({...Vh,...Bh});function bn(i){return globalThis.Buffer!=null?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):i}function Qh(i=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?bn(globalThis.Buffer.allocUnsafe(i)):new Uint8Array(i)}function vn(i,e,t,s){return{name:i,prefix:e,encoder:{name:i,prefix:e,encode:t},decoder:{decode:s}}}const Xs=vn("utf8","u",i=>"u"+new TextDecoder("utf8").decode(i),i=>new TextEncoder().encode(i.substring(1))),Tt=vn("ascii","a",i=>{let e="a";for(let t=0;t<i.length;t++)e+=String.fromCharCode(i[t]);return e},i=>{i=i.substring(1);const e=Qh(i.length);for(let t=0;t<i.length;t++)e[t]=i.charCodeAt(t);return e}),Hh={utf8:Xs,"utf-8":Xs,hex:Zs.base16,latin1:Tt,ascii:Tt,binary:Tt,...Zs};function Yh(i,e="utf8"){const t=Hh[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?bn(globalThis.Buffer.from(i,"utf-8")):t.decoder.decode(`${t.prefix}${i}`)}const En="wc",Jh=2,rs="core",ue=`${En}@2:${rs}:`,Zh={name:rs,logger:"error"},Xh={database:":memory:"},eu="crypto",ei="client_ed25519_seed",tu=y.ONE_DAY,su="keychain",iu="0.3",nu="messages",ru="0.3",au=y.SIX_HOURS,ou="publisher",In="irn",cu="error",Sn="wss://relay.walletconnect.com",ti="wss://relay.walletconnect.org",lu="relayer",U={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},hu="_subscription",se={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},uu=y.ONE_SECOND,du="2.10.5",pu=1e4,gu="0.3",yu="WALLETCONNECT_CLIENT_ID",B={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},mu="subscription",fu="0.3",wu=y.FIVE_SECONDS*1e3,bu="pairing",vu="0.3",Ce={wc_pairingDelete:{req:{ttl:y.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:y.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:y.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:y.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:y.ONE_DAY,prompt:!1,tag:0},res:{ttl:y.ONE_DAY,prompt:!1,tag:0}}},xe={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},X={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Eu="history",Iu="0.3",Su="expirer",K={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},_u="0.3",Pt="verify-api",we="https://verify.walletconnect.com",Gt="https://verify.walletconnect.org",Tu=[we,Gt];class Pu{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name=su,this.version=iu,this.initialized=!1,this.storagePrefix=ue,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,n)=>{this.isInitialized(),this.keychain.set(s,n),await this.persist()},this.get=s=>{this.isInitialized();const n=this.keychain.get(s);if(typeof n>"u"){const{message:r}=p("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(r)}return n},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=e,this.logger=b.generateChildLogger(t,this.name)}get context(){return b.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,nn(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?rn(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=p("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Cu{constructor(e,t,s){this.core=e,this.logger=t,this.name=eu,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=n=>(this.isInitialized(),this.keychain.has(n)),this.getClientId=async()=>{this.isInitialized();const n=await this.getClientSeed(),r=Es(n);return jr(r.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const n=cc();return this.setPrivateKey(n.publicKey,n.privateKey)},this.signJWT=async n=>{this.isInitialized();const r=await this.getClientSeed(),a=Es(r),o=zt();return await kr(o,n,tu,a)},this.generateSharedKey=(n,r,a)=>{this.isInitialized();const o=this.getPrivateKey(n),c=lc(o,r);return this.setSymKey(c,a)},this.setSymKey=async(n,r)=>{this.isInitialized();const a=r||hc(n);return await this.keychain.set(a,n),a},this.deleteKeyPair=async n=>{this.isInitialized(),await this.keychain.del(n)},this.deleteSymKey=async n=>{this.isInitialized(),await this.keychain.del(n)},this.encode=async(n,r,a)=>{this.isInitialized();const o=sn(a),c=$i(r);if($s(o)){const g=o.senderPublicKey,S=o.receiverPublicKey;n=await this.generateSharedKey(g,S)}const l=this.getSymKey(n),{type:h,senderPublicKey:u}=o;return dc({type:h,symKey:l,message:c,senderPublicKey:u})},this.decode=async(n,r,a)=>{this.isInitialized();const o=yc(r,a);if($s(o)){const c=o.receiverPublicKey,l=o.senderPublicKey;n=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(n),l=pc({symKey:c,encoded:r});return Di(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}},this.getPayloadType=n=>{const r=nt(n);return Ue(r.type)},this.getPayloadSenderPublicKey=n=>{const r=nt(n);return r.senderPublicKey?G(r.senderPublicKey,F):void 0},this.core=e,this.logger=b.generateChildLogger(t,this.name),this.keychain=s||new Pu(this.core,this.logger)}get context(){return b.getLoggerContext(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(ei)}catch{e=zt(),await this.keychain.set(ei,e)}return Yh(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=p("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Au extends Zo{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name=nu,this.version=ru,this.initialized=!1,this.storagePrefix=ue,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,n)=>{this.isInitialized();const r=ve(n);let a=this.messages.get(s);return typeof a>"u"&&(a={}),typeof a[r]<"u"||(a[r]=n,this.messages.set(s,a),await this.persist()),r},this.get=s=>{this.isInitialized();let n=this.messages.get(s);return typeof n>"u"&&(n={}),n},this.has=(s,n)=>{this.isInitialized();const r=this.get(s),a=ve(n);return typeof r[a]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=b.generateChildLogger(e,this.name),this.core=t}get context(){return b.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,nn(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?rn(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=p("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Nu extends Xo{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new ce.EventEmitter,this.name=ou,this.queue=new Map,this.publishTimeout=y.toMiliseconds(y.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,n,r)=>{var a;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:n,opts:r}});try{const o=(r==null?void 0:r.ttl)||au,c=Vt(r),l=(r==null?void 0:r.prompt)||!1,h=(r==null?void 0:r.tag)||0,u=(r==null?void 0:r.id)||Vr().toString(),g={topic:s,message:n,opts:{ttl:o,relay:c,prompt:l,tag:h,id:u}},S=setTimeout(()=>this.queue.set(u,g),this.publishTimeout);try{await await Le(this.rpcPublish(s,n,o,c,l,h,u),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(u),this.relayer.events.emit(U.publish,g)}catch(d){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(a=r==null?void 0:r.internal)!=null&&a.throwOnFailedPublish)throw this.removeRequestFromQueue(u),d;return}finally{clearTimeout(S)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:n,opts:r}})}catch(o){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(o),o}},this.on=(s,n)=>{this.events.on(s,n)},this.once=(s,n)=>{this.events.once(s,n)},this.off=(s,n)=>{this.events.off(s,n)},this.removeListener=(s,n)=>{this.events.removeListener(s,n)},this.relayer=e,this.logger=b.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return b.getLoggerContext(this.logger)}rpcPublish(e,t,s,n,r,a,o){var c,l,h,u;const g={method:Ye(n.protocol).publish,params:{topic:e,message:t,ttl:s,prompt:r,tag:a},id:o};return q((c=g.params)==null?void 0:c.prompt)&&((l=g.params)==null||delete l.prompt),q((h=g.params)==null?void 0:h.tag)&&((u=g.params)==null||delete u.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:g}),this.relayer.request(g)}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:t,message:s,opts:n}=e;await this.publish(t,s,n)})}registerEventListeners(){this.relayer.core.heartbeat.on($e.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(U.connection_stalled);return}this.checkQueue()}),this.relayer.on(U.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}class Ru{constructor(){this.map=new Map,this.set=(e,t)=>{const s=this.get(e);this.exists(e,t)||this.map.set(e,[...s,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const s=this.get(e);if(!this.exists(e,t))return;const n=s.filter(r=>r!==t);if(!n.length){this.map.delete(e);return}this.map.set(e,n)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Ou=Object.defineProperty,xu=Object.defineProperties,Mu=Object.getOwnPropertyDescriptors,si=Object.getOwnPropertySymbols,Lu=Object.prototype.hasOwnProperty,$u=Object.prototype.propertyIsEnumerable,ii=(i,e,t)=>e in i?Ou(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ae=(i,e)=>{for(var t in e||(e={}))Lu.call(e,t)&&ii(i,t,e[t]);if(si)for(var t of si(e))$u.call(e,t)&&ii(i,t,e[t]);return i},Ct=(i,e)=>xu(i,Mu(e));class Du extends sc{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new Ru,this.events=new ce.EventEmitter,this.name=mu,this.version=fu,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=ue,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,n)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:n}});try{const r=Vt(n),a={topic:s,relay:r};this.pending.set(s,a);const o=await this.rpcSubscribe(s,r);return this.onSubscribe(o,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:n}}),o}catch(r){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(r),r}},this.unsubscribe=async(s,n)=>{await this.restartToComplete(),this.isInitialized(),typeof(n==null?void 0:n.id)<"u"?await this.unsubscribeById(s,n.id,n):await this.unsubscribeByTopic(s,n)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((n,r)=>{const a=new y.Watch;a.start(this.pendingSubscriptionWatchLabel);const o=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(o),a.stop(this.pendingSubscriptionWatchLabel),n(!0)),a.elapsed(this.pendingSubscriptionWatchLabel)>=wu&&(clearInterval(o),a.stop(this.pendingSubscriptionWatchLabel),r(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,n)=>{this.events.on(s,n)},this.once=(s,n)=>{this.events.once(s,n)},this.off=(s,n)=>{this.events.off(s,n)},this.removeListener=(s,n)=>{this.events.removeListener(s,n)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=b.generateChildLogger(t,this.name),this.clientId=""}get context(){return b.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let s=!1;try{s=this.getSubscription(e).topic===t}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const s=this.topicMap.get(e);await Promise.all(s.map(async n=>await this.unsubscribeById(e,n,t)))}async unsubscribeById(e,t,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:s}});try{const n=Vt(s);await this.rpcUnsubscribe(e,t,n);const r=x("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,r),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:s}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,t){const s={method:Ye(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await Le(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(U.connection_stalled)}return ve(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,s={method:Ye(t.protocol).batchSubscribe,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await Le(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(U.connection_stalled)}}rpcUnsubscribe(e,t,s){const n={method:Ye(s.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,t){this.setSubscription(e,Ct(Ae({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,Ae({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,s){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,s),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}addSubscription(e,t){this.subscriptions.set(e,Ae({},t)),this.topicMap.set(t.topic,e),this.events.emit(B.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:s}=p("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const s=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(s.topic,e),this.events.emit(B.deleted,Ct(Ae({},s),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(B.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let t=0;t<e;t++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(B.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=p("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const t=await this.rpcBatchSubscribe(e);je(t)&&this.onBatchSubscribe(t.map((s,n)=>Ct(Ae({},e[n]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on($e.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(U.connect,async()=>{await this.onConnect()}),this.relayer.on(U.disconnect,()=>{this.onDisconnect()}),this.events.on(B.created,async e=>{const t=B.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(B.deleted,async e=>{const t=B.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=p("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const t=setInterval(()=>{this.restartInProgress||(clearInterval(t),e())},this.pollingInterval)})}}var Uu=Object.defineProperty,ni=Object.getOwnPropertySymbols,qu=Object.prototype.hasOwnProperty,Fu=Object.prototype.propertyIsEnumerable,ri=(i,e,t)=>e in i?Uu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ju=(i,e)=>{for(var t in e||(e={}))qu.call(e,t)&&ri(i,t,e[t]);if(ni)for(var t of ni(e))Fu.call(e,t)&&ri(i,t,e[t]);return i};class ku extends ec{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new ce.EventEmitter,this.name=lu,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async t=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(t)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=t=>{this.onProviderPayload(t)},this.onConnectHandler=()=>{this.events.emit(U.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=t=>{this.logger.error(t),this.events.emit(U.error,t),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(se.payload,this.onPayloadHandler),this.provider.on(se.connect,this.onConnectHandler),this.provider.on(se.disconnect,this.onDisconnectHandler),this.provider.on(se.error,this.onProviderErrorHandler)},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?b.generateChildLogger(e.logger,this.name):b.pino(b.getDefaultLoggerOptions({level:e.logger||cu})),this.messages=new Au(this.logger,e.core),this.subscriber=new Du(this,this.logger),this.publisher=new Nu(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Sn,this.projectId=e.projectId,this.bundleId=Ec(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${ti}...`),await this.restartTransport(ti)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},pu)}get context(){return b.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,t,s){this.isInitialized(),await this.publisher.publish(e,t,s),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now()})}async subscribe(e,t){var s;this.isInitialized();let n=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"";if(n)return n;let r;const a=o=>{o.topic===e&&(this.subscriber.off(B.created,a),r())};return await Promise.all([new Promise(o=>{r=o,this.subscriber.on(B.created,a)}),new Promise(async o=>{n=await this.subscriber.subscribe(e,t),o()})]),n}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await Le(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(e){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(t=>{if(!this.initialized)return t();this.subscriber.once(B.resubscribed,()=>{t()})}),new Promise(async(t,s)=>{try{await Le(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(n){s(n);return}t()})])}catch(t){this.logger.error(t);const s=t;if(!this.isConnectionStalled(s.message))throw t;this.provider.events.emit(se.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(e){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Ks())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(e){return this.staleConnectionErrors.some(t=>e.includes(t))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new zr(new Tl(Cc({sdkVersion:du,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:t,message:s}=e;await this.messages.set(t,s)}async shouldIgnoreMessageEvent(e){const{topic:t,message:s}=e;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(t))return this.logger.debug(`Ignoring message for non-subscribed topic ${t}`),!0;const n=this.messages.has(t,s);return n&&this.logger.debug(`Ignoring duplicate message: ${s}`),n}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),ct(e)){if(!e.method.endsWith(hu))return;const t=e.params,{topic:s,message:n,publishedAt:r}=t.data,a={topic:s,message:n,publishedAt:r};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(ju({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else lt(e)&&this.events.emit(U.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(U.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=ye(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(se.payload,this.onPayloadHandler),this.provider.off(se.connect,this.onConnectHandler),this.provider.off(se.disconnect,this.onDisconnectHandler),this.provider.off(se.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(U.connection_stalled,()=>{this.restartTransport().catch(t=>this.logger.error(t))});let e=await Ks();bl(async t=>{this.initialized&&e!==t&&(e=t,t?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(U.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(e=>this.logger.error(e))},y.toMiliseconds(uu)))}isInitialized(){if(!this.initialized){const{message:e}=p("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(e=>{const t=setInterval(()=>{this.connected&&(clearInterval(t),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var zu=Object.defineProperty,ai=Object.getOwnPropertySymbols,Vu=Object.prototype.hasOwnProperty,Wu=Object.prototype.propertyIsEnumerable,oi=(i,e,t)=>e in i?zu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ci=(i,e)=>{for(var t in e||(e={}))Vu.call(e,t)&&oi(i,t,e[t]);if(ai)for(var t of ai(e))Wu.call(e,t)&&oi(i,t,e[t]);return i};class pt extends tc{constructor(e,t,s,n=ue,r=void 0){super(e,t,s,n),this.core=e,this.logger=t,this.name=s,this.map=new Map,this.version=gu,this.cached=[],this.initialized=!1,this.storagePrefix=ue,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{this.getKey&&a!==null&&!q(a)?this.map.set(this.getKey(a),a):Yc(a)?this.map.set(a.id,a):Jc(a)&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)},this.set=async(a,o)=>{this.isInitialized(),this.map.has(a)?await this.update(a,o):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:o}),this.map.set(a,o),await this.persist())},this.get=a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a)),this.getAll=a=>(this.isInitialized(),a?this.values.filter(o=>Object.keys(a).every(c=>qr(o[c],a[c]))):this.values),this.update=async(a,o)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:o});const c=ci(ci({},this.getData(a)),o);this.map.set(a,c),await this.persist()},this.delete=async(a,o)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:o}),this.map.delete(a),await this.persist())},this.logger=b.generateChildLogger(t,this.name),this.storagePrefix=n,this.getKey=r}get context(){return b.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){const{message:s}=p("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=p("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=p("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Ku{constructor(e,t){this.core=e,this.logger=t,this.name=bu,this.version=vu,this.events=new Ui,this.initialized=!1,this.storagePrefix=ue,this.ignoredPayloadTypes=[me],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=zt(),n=await this.core.crypto.setSymKey(s),r=Q(y.FIVE_MINUTES),a={protocol:In},o={topic:n,expiry:r,relay:a,active:!1},c=jc({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:a});return await this.pairings.set(n,o),await this.core.relayer.subscribe(n),this.core.expirer.set(n,r),{topic:n,uri:c}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:n,symKey:r,relay:a}=Uc(s.uri);let o;if(this.pairings.keys.includes(n)&&(o=this.pairings.get(n),o.active))throw new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);this.core.crypto.keychain.has(n)||(await this.core.crypto.setSymKey(r,n),await this.core.relayer.subscribe(n,{relay:a}));const c=Q(y.FIVE_MINUTES),l={topic:n,relay:a,expiry:c,active:!1};return await this.pairings.set(n,l),this.core.expirer.set(n,c),s.activatePairing&&await this.activate({topic:n}),this.events.emit(xe.create,l),l},this.activate=async({topic:s})=>{this.isInitialized();const n=Q(y.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:n}),this.core.expirer.set(s,n)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:n}=s;if(this.pairings.keys.includes(n)){const r=await this.sendRequest(n,"wc_pairingPing",{}),{done:a,resolve:o,reject:c}=fe();this.events.once(N("pairing_ping",r),({error:l})=>{l?c(l):o()}),await a()}},this.updateExpiry=async({topic:s,expiry:n})=>{this.isInitialized(),await this.pairings.update(s,{expiry:n})},this.updateMetadata=async({topic:s,metadata:n})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:n})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:n}=s;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",x("USER_DISCONNECTED")),await this.deletePairing(n))},this.sendRequest=async(s,n,r)=>{const a=be(n,r),o=await this.core.crypto.encode(s,a),c=Ce[n].req;return this.core.history.set(s,a),this.core.relayer.publish(s,o,c),a.id},this.sendResult=async(s,n,r)=>{const a=ye(s,r),o=await this.core.crypto.encode(n,a),c=await this.core.history.get(n,s),l=Ce[c.request.method].res;await this.core.relayer.publish(n,o,l),await this.core.history.resolve(a)},this.sendError=async(s,n,r)=>{const a=ot(s,r),o=await this.core.crypto.encode(n,a),c=await this.core.history.get(n,s),l=Ce[c.request.method]?Ce[c.request.method].res:Ce.unregistered_method.res;await this.core.relayer.publish(n,o,l),await this.core.history.resolve(a)},this.deletePairing=async(s,n)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,x("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),n?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(n=>le(n.expiry));await Promise.all(s.map(n=>this.deletePairing(n.topic)))},this.onRelayEventRequest=s=>{const{topic:n,payload:r}=s;switch(r.method){case"wc_pairingPing":return this.onPairingPingRequest(n,r);case"wc_pairingDelete":return this.onPairingDeleteRequest(n,r);default:return this.onUnknownRpcMethodRequest(n,r)}},this.onRelayEventResponse=async s=>{const{topic:n,payload:r}=s,a=(await this.core.history.get(n,r.id)).request.method;switch(a){case"wc_pairingPing":return this.onPairingPingResponse(n,r);default:return this.onUnknownRpcMethodResponse(a)}},this.onPairingPingRequest=async(s,n)=>{const{id:r}=n;try{this.isValidPing({topic:s}),await this.sendResult(r,s,!0),this.events.emit(xe.ping,{id:r,topic:s})}catch(a){await this.sendError(r,s,a),this.logger.error(a)}},this.onPairingPingResponse=(s,n)=>{const{id:r}=n;setTimeout(()=>{ne(n)?this.events.emit(N("pairing_ping",r),{}):ee(n)&&this.events.emit(N("pairing_ping",r),{error:n.error})},500)},this.onPairingDeleteRequest=async(s,n)=>{const{id:r}=n;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit(xe.delete,{id:r,topic:s})}catch(a){await this.sendError(r,s,a),this.logger.error(a)}},this.onUnknownRpcMethodRequest=async(s,n)=>{const{id:r,method:a}=n;try{if(this.registeredMethods.includes(a))return;const o=x("WC_METHOD_UNSUPPORTED",a);await this.sendError(r,s,o),this.logger.error(o)}catch(o){await this.sendError(r,s,o),this.logger.error(o)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(x("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{if(!k(s)){const{message:n}=p("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(n)}if(!Hc(s.uri)){const{message:n}=p("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(n)}},this.isValidPing=async s=>{if(!k(s)){const{message:r}=p("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(r)}const{topic:n}=s;await this.isValidPairingTopic(n)},this.isValidDisconnect=async s=>{if(!k(s)){const{message:r}=p("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(r)}const{topic:n}=s;await this.isValidPairingTopic(n)},this.isValidPairingTopic=async s=>{if(!M(s,!1)){const{message:n}=p("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(n)}if(!this.pairings.keys.includes(s)){const{message:n}=p("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(n)}if(le(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:n}=p("EXPIRED",`pairing topic: ${s}`);throw new Error(n)}},this.core=e,this.logger=b.generateChildLogger(t,this.name),this.pairings=new pt(this.core,this.logger,this.name,this.storagePrefix)}get context(){return b.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=p("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(U.message,async e=>{const{topic:t,message:s}=e;if(!this.pairings.keys.includes(t)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const n=await this.core.crypto.decode(t,s);try{ct(n)?(this.core.history.set(t,n),this.onRelayEventRequest({topic:t,payload:n})):lt(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:t,payload:n}),this.core.history.delete(t,n.id))}catch(r){this.logger.error(r)}})}registerExpirerEvents(){this.core.expirer.on(K.expired,async e=>{const{topic:t}=on(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(xe.expire,{topic:t}))})}}class Gu extends Jo{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.records=new Map,this.events=new ce.EventEmitter,this.name=Eu,this.version=Iu,this.cached=[],this.initialized=!1,this.storagePrefix=ue,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,n,r)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:n,chainId:r}),this.records.has(n.id))return;const a={id:n.id,topic:s,request:{method:n.method,params:n.params||null},chainId:r,expiry:Q(y.THIRTY_DAYS)};this.records.set(a.id,a),this.events.emit(X.created,a)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const n=await this.getRecord(s.id);typeof n.response>"u"&&(n.response=ee(s)?{error:s.error}:{result:s.result},this.records.set(n.id,n),this.events.emit(X.updated,n))},this.get=async(s,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:n}),await this.getRecord(n)),this.delete=(s,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(r=>{if(r.topic===s){if(typeof n<"u"&&r.id!==n)return;this.records.delete(r.id),this.events.emit(X.deleted,r)}})},this.exists=async(s,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===s:!1),this.on=(s,n)=>{this.events.on(s,n)},this.once=(s,n)=>{this.events.once(s,n)},this.off=(s,n)=>{this.events.off(s,n)},this.removeListener=(s,n)=>{this.events.removeListener(s,n)},this.logger=b.generateChildLogger(t,this.name)}get context(){return b.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const s={topic:t.topic,request:be(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(s)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:s}=p("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(s)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(X.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=p("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(X.created,e=>{const t=X.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(X.updated,e=>{const t=X.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(X.deleted,e=>{const t=X.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.core.heartbeat.on($e.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{y.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=p("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Bu extends ic{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.expirations=new Map,this.events=new ce.EventEmitter,this.name=Su,this.version=_u,this.cached=[],this.initialized=!1,this.storagePrefix=ue,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const n=this.formatTarget(s);return typeof this.getExpiration(n)<"u"}catch{return!1}},this.set=(s,n)=>{this.isInitialized();const r=this.formatTarget(s),a={target:r,expiry:n};this.expirations.set(r,a),this.checkExpiry(r,a),this.events.emit(K.created,{target:r,expiration:a})},this.get=s=>{this.isInitialized();const n=this.formatTarget(s);return this.getExpiration(n)},this.del=s=>{if(this.isInitialized(),this.has(s)){const n=this.formatTarget(s),r=this.getExpiration(n);this.expirations.delete(n),this.events.emit(K.deleted,{target:n,expiration:r})}},this.on=(s,n)=>{this.events.on(s,n)},this.once=(s,n)=>{this.events.once(s,n)},this.off=(s,n)=>{this.events.off(s,n)},this.removeListener=(s,n)=>{this.events.removeListener(s,n)},this.logger=b.generateChildLogger(t,this.name)}get context(){return b.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Ac(e);if(typeof e=="number")return Nc(e);const{message:t}=p("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(K.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=p("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:s}=p("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}return t}checkExpiry(e,t){const{expiry:s}=t;y.toMiliseconds(s)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(K.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on($e.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(K.created,e=>{const t=K.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(K.expired,e=>{const t=K.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(K.deleted,e=>{const t=K.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=p("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Qu extends nc{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,this.name=Pt,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||Se()||!qe())return;const n=this.getVerifyUrl(s==null?void 0:s.verifyUrl);this.verifyUrl!==n&&this.removeIframe(),this.verifyUrl=n;try{await this.createIframe()}catch(r){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(r)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Gt;try{await this.createIframe()}catch(r){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(r),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const n=this.getVerifyUrl(s==null?void 0:s.verifyUrl);let r;try{r=await this.fetchAttestation(s.attestationId,n)}catch(a){this.logger.info(`failed to resolve attestation: ${s.attestationId} from url: ${n}`),this.logger.info(a),r=await this.fetchAttestation(s.attestationId,Gt)}return r},this.fetchAttestation=async(s,n)=>{this.logger.info(`resolving attestation: ${s} from url: ${n}`);const r=this.startAbortTimer(y.ONE_SECOND*2),a=await fetch(`${n}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(r),a.status===200?await a.json():void 0},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var n;try{if(!this.iframe)return;(n=this.iframe.contentWindow)==null||n.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const n=r=>{r.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",n),s())};await Promise.race([new Promise(r=>{if(document.getElementById(Pt))return r();window.addEventListener("message",n);const a=document.createElement("iframe");a.id=Pt,a.src=`${this.verifyUrl}/${this.projectId}`,a.style.display="none",document.body.append(a),this.iframe=a,s=r}),new Promise((r,a)=>setTimeout(()=>{window.removeEventListener("message",n),a("verify iframe load timeout")},y.toMiliseconds(y.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=s=>{let n=s||we;return Tu.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${we}`),n=we),n},this.logger=b.generateChildLogger(t,this.name),this.verifyUrl=we,this.abortController=new AbortController,this.isDevEnv=is()&&Pl.IS_VITEST}get context(){return b.getLoggerContext(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),y.toMiliseconds(e))}}var Hu=Object.defineProperty,li=Object.getOwnPropertySymbols,Yu=Object.prototype.hasOwnProperty,Ju=Object.prototype.propertyIsEnumerable,hi=(i,e,t)=>e in i?Hu(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ui=(i,e)=>{for(var t in e||(e={}))Yu.call(e,t)&&hi(i,t,e[t]);if(li)for(var t of li(e))Ju.call(e,t)&&hi(i,t,e[t]);return i};class as extends Yo{constructor(e){super(e),this.protocol=En,this.version=Jh,this.name=rs,this.events=new ce.EventEmitter,this.initialized=!1,this.on=(s,n)=>this.events.on(s,n),this.once=(s,n)=>this.events.once(s,n),this.off=(s,n)=>this.events.off(s,n),this.removeListener=(s,n)=>this.events.removeListener(s,n),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Sn,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:b.pino(b.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Zh.logger}));this.logger=b.generateChildLogger(t,this.name),this.heartbeat=new $e.HeartBeat,this.crypto=new Cu(this,this.logger,e==null?void 0:e.keychain),this.history=new Gu(this,this.logger),this.expirer=new Bu(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Fr(ui(ui({},Xh),e==null?void 0:e.storageOptions)),this.relayer=new ku({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Ku(this,this.logger),this.verify=new Qu(this.projectId||"",this.logger)}static async init(e){const t=new as(e);await t.initialize();const s=await t.crypto.getClientId();return await t.storage.setItem(yu,s),t}get context(){return b.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const Zu=as,_n="wc",Tn=2,Pn="client",os=`${_n}@${Tn}:${Pn}:`,At={name:Pn,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},di="WALLETCONNECT_DEEPLINK_CHOICE",Xu="proposal",ed="Proposal expired",td="session",Qe=y.SEVEN_DAYS,sd="engine",Ne={wc_sessionPropose:{req:{ttl:y.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:y.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:y.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:y.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:y.ONE_DAY,prompt:!1,tag:1104},res:{ttl:y.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:y.ONE_DAY,prompt:!1,tag:1106},res:{ttl:y.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:y.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:y.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:y.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:y.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:y.ONE_DAY,prompt:!1,tag:1112},res:{ttl:y.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:y.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:y.THIRTY_SECONDS,prompt:!1,tag:1115}}},Nt={min:y.FIVE_MINUTES,max:y.SEVEN_DAYS},ie={idle:"IDLE",active:"ACTIVE"},id="request",nd=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var rd=Object.defineProperty,ad=Object.defineProperties,od=Object.getOwnPropertyDescriptors,pi=Object.getOwnPropertySymbols,cd=Object.prototype.hasOwnProperty,ld=Object.prototype.propertyIsEnumerable,gi=(i,e,t)=>e in i?rd(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,j=(i,e)=>{for(var t in e||(e={}))cd.call(e,t)&&gi(i,t,e[t]);if(pi)for(var t of pi(e))ld.call(e,t)&&gi(i,t,e[t]);return i},Re=(i,e)=>ad(i,od(e));class hd extends ac{constructor(e){super(e),this.name=sd,this.events=new Ui,this.initialized=!1,this.ignoredPayloadTypes=[me],this.requestQueue={state:ie.idle,queue:[]},this.sessionRequestQueue={state:ie.idle,queue:[]},this.requestQueueDelay=y.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(Ne)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},y.toMiliseconds(this.requestQueueDelay)))},this.connect=async t=>{await this.isInitialized();const s=Re(j({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:n,requiredNamespaces:r,optionalNamespaces:a,sessionProperties:o,relays:c}=s;let l=n,h,u=!1;if(l&&(u=this.client.core.pairing.pairings.get(l).active),!l||!u){const{topic:E,uri:w}=await this.client.core.pairing.create();l=E,h=w}const g=await this.client.core.crypto.generateKeyPair(),S=j({requiredNamespaces:r,optionalNamespaces:a,relays:c??[{protocol:In}],proposer:{publicKey:g,metadata:this.client.metadata}},o&&{sessionProperties:o}),{reject:d,resolve:m,done:T}=fe(y.FIVE_MINUTES,ed);if(this.events.once(N("session_connect"),async({error:E,session:w})=>{if(E)d(E);else if(w){w.self.publicKey=g;const _=Re(j({},w),{requiredNamespaces:w.requiredNamespaces,optionalNamespaces:w.optionalNamespaces});await this.client.session.set(w.topic,_),await this.setExpiry(w.topic,w.expiry),l&&await this.client.core.pairing.updateMetadata({topic:l,metadata:w.peer.metadata}),m(_)}}),!l){const{message:E}=p("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(E)}const v=await this.sendRequest({topic:l,method:"wc_sessionPropose",params:S}),P=Q(y.FIVE_MINUTES);return await this.setProposal(v,j({id:v,expiry:P},S)),{uri:h,approval:T}},this.pair=async t=>(await this.isInitialized(),await this.client.core.pairing.pair(t)),this.approve=async t=>{await this.isInitialized(),await this.isValidApprove(t);const{id:s,relayProtocol:n,namespaces:r,sessionProperties:a}=t,o=this.client.proposal.get(s);let{pairingTopic:c,proposer:l,requiredNamespaces:h,optionalNamespaces:u}=o;c=c||"",Me(h)||(h=Wc(r,"approve()"));const g=await this.client.core.crypto.generateKeyPair(),S=l.publicKey,d=await this.client.core.crypto.generateSharedKey(g,S);c&&s&&(await this.client.core.pairing.updateMetadata({topic:c,metadata:l.metadata}),await this.sendResult({id:s,topic:c,result:{relay:{protocol:n??"irn"},responderPublicKey:g}}),await this.client.proposal.delete(s,x("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:c}));const m=j({relay:{protocol:n??"irn"},namespaces:r,requiredNamespaces:h,optionalNamespaces:u,pairingTopic:c,controller:{publicKey:g,metadata:this.client.metadata},expiry:Q(Qe)},a&&{sessionProperties:a});await this.client.core.relayer.subscribe(d),await this.sendRequest({topic:d,method:"wc_sessionSettle",params:m,throwOnFailedPublish:!0});const T=Re(j({},m),{topic:d,pairingTopic:c,acknowledged:!1,self:m.controller,peer:{publicKey:l.publicKey,metadata:l.metadata},controller:g});return await this.client.session.set(d,T),await this.setExpiry(d,Q(Qe)),{topic:d,acknowledged:()=>new Promise(v=>setTimeout(()=>v(this.client.session.get(d)),500))}},this.reject=async t=>{await this.isInitialized(),await this.isValidReject(t);const{id:s,reason:n}=t,{pairingTopic:r}=this.client.proposal.get(s);r&&(await this.sendError(s,r,n),await this.client.proposal.delete(s,x("USER_DISCONNECTED")))},this.update=async t=>{await this.isInitialized(),await this.isValidUpdate(t);const{topic:s,namespaces:n}=t,r=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:n}}),{done:a,resolve:o,reject:c}=fe();return this.events.once(N("session_update",r),({error:l})=>{l?c(l):o()}),await this.client.session.update(s,{namespaces:n}),{acknowledged:a}},this.extend=async t=>{await this.isInitialized(),await this.isValidExtend(t);const{topic:s}=t,n=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:r,resolve:a,reject:o}=fe();return this.events.once(N("session_extend",n),({error:c})=>{c?o(c):a()}),await this.setExpiry(s,Q(Qe)),{acknowledged:r}},this.request=async t=>{await this.isInitialized(),await this.isValidRequest(t);const{chainId:s,request:n,topic:r,expiry:a}=t,o=Wr(),{done:c,resolve:l,reject:h}=fe(a,"Request expired. Please try again.");return this.events.once(N("session_request",o),({error:u,result:g})=>{u?h(u):l(g)}),await Promise.all([new Promise(async u=>{await this.sendRequest({clientRpcId:o,topic:r,method:"wc_sessionRequest",params:{request:n,chainId:s},expiry:a,throwOnFailedPublish:!0}).catch(g=>h(g)),this.client.events.emit("session_request_sent",{topic:r,request:n,chainId:s,id:o}),u()}),new Promise(async u=>{const g=await this.client.core.storage.getItem(di);Rc({id:o,topic:r,wcDeepLink:g}),u()}),c()]).then(u=>u[2])},this.respond=async t=>{await this.isInitialized(),await this.isValidRespond(t);const{topic:s,response:n}=t,{id:r}=n;ne(n)?await this.sendResult({id:r,topic:s,result:n.result,throwOnFailedPublish:!0}):ee(n)&&await this.sendError(r,s,n.error),this.cleanupAfterResponse(t)},this.ping=async t=>{await this.isInitialized(),await this.isValidPing(t);const{topic:s}=t;if(this.client.session.keys.includes(s)){const n=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:r,resolve:a,reject:o}=fe();this.events.once(N("session_ping",n),({error:c})=>{c?o(c):a()}),await r()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async t=>{await this.isInitialized(),await this.isValidEmit(t);const{topic:s,event:n,chainId:r}=t;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:n,chainId:r}})},this.disconnect=async t=>{await this.isInitialized(),await this.isValidDisconnect(t);const{topic:s}=t;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:x("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=t=>(this.isInitialized(),this.client.session.getAll().filter(s=>Bc(s,t))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async t=>{if(t.pairingTopic)try{const s=this.client.core.pairing.pairings.get(t.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(r=>{var a,o;return((a=r.peerMetadata)==null?void 0:a.url)&&((o=r.peerMetadata)==null?void 0:o.url)===t.peer.metadata.url&&r.topic&&r.topic!==s.topic});if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(r=>this.client.core.pairing.disconnect({topic:r.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(t,s)=>{const{self:n}=this.client.session.get(t);await this.client.core.relayer.unsubscribe(t),this.client.session.delete(t,x("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(n.publicKey)&&await this.client.core.crypto.deleteKeyPair(n.publicKey),this.client.core.crypto.keychain.has(t)&&await this.client.core.crypto.deleteSymKey(t),s||this.client.core.expirer.del(t),this.client.core.storage.removeItem(di).catch(r=>this.client.logger.warn(r))},this.deleteProposal=async(t,s)=>{await Promise.all([this.client.proposal.delete(t,x("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(t)])},this.deletePendingSessionRequest=async(t,s,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,s),n?Promise.resolve():this.client.core.expirer.del(t)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(r=>r.id!==t),n&&(this.sessionRequestQueue.state=ie.idle)},this.setExpiry=async(t,s)=>{this.client.session.keys.includes(t)&&await this.client.session.update(t,{expiry:s}),this.client.core.expirer.set(t,s)},this.setProposal=async(t,s)=>{await this.client.proposal.set(t,s),this.client.core.expirer.set(t,s.expiry)},this.setPendingSessionRequest=async t=>{const s=Ne.wc_sessionRequest.req.ttl,{id:n,topic:r,params:a,verifyContext:o}=t;await this.client.pendingRequest.set(n,{id:n,topic:r,params:a,verifyContext:o}),s&&this.client.core.expirer.set(n,Q(s))},this.sendRequest=async t=>{const{topic:s,method:n,params:r,expiry:a,relayRpcId:o,clientRpcId:c,throwOnFailedPublish:l}=t,h=be(n,r,c);if(qe()&&nd.includes(n)){const S=ve(JSON.stringify(h));this.client.core.verify.register({attestationId:S})}const u=await this.client.core.crypto.encode(s,h),g=Ne[n].req;return a&&(g.ttl=a),o&&(g.id=o),this.client.core.history.set(s,h),l?(g.internal=Re(j({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,u,g)):this.client.core.relayer.publish(s,u,g).catch(S=>this.client.logger.error(S)),h.id},this.sendResult=async t=>{const{id:s,topic:n,result:r,throwOnFailedPublish:a}=t,o=ye(s,r),c=await this.client.core.crypto.encode(n,o),l=await this.client.core.history.get(n,s),h=Ne[l.request.method].res;a?(h.internal=Re(j({},h.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,c,h)):this.client.core.relayer.publish(n,c,h).catch(u=>this.client.logger.error(u)),await this.client.core.history.resolve(o)},this.sendError=async(t,s,n)=>{const r=ot(t,n),a=await this.client.core.crypto.encode(s,r),o=await this.client.core.history.get(s,t),c=Ne[o.request.method].res;this.client.core.relayer.publish(s,a,c),await this.client.core.history.resolve(r)},this.cleanup=async()=>{const t=[],s=[];this.client.session.getAll().forEach(n=>{le(n.expiry)&&t.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{le(n.expiry)&&s.push(n.id)}),await Promise.all([...t.map(n=>this.deleteSession(n)),...s.map(n=>this.deleteProposal(n))])},this.onRelayEventRequest=async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===ie.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ie.active;const t=this.requestQueue.queue.shift();if(t)try{this.processRequest(t),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=ie.idle},this.processRequest=t=>{const{topic:s,payload:n}=t,r=n.method;switch(r){case"wc_sessionPropose":return this.onSessionProposeRequest(s,n);case"wc_sessionSettle":return this.onSessionSettleRequest(s,n);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,n);case"wc_sessionExtend":return this.onSessionExtendRequest(s,n);case"wc_sessionPing":return this.onSessionPingRequest(s,n);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,n);case"wc_sessionRequest":return this.onSessionRequest(s,n);case"wc_sessionEvent":return this.onSessionEventRequest(s,n);default:return this.client.logger.info(`Unsupported request method ${r}`)}},this.onRelayEventResponse=async t=>{const{topic:s,payload:n}=t,r=(await this.client.core.history.get(s,n.id)).request.method;switch(r){case"wc_sessionPropose":return this.onSessionProposeResponse(s,n);case"wc_sessionSettle":return this.onSessionSettleResponse(s,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,n);case"wc_sessionExtend":return this.onSessionExtendResponse(s,n);case"wc_sessionPing":return this.onSessionPingResponse(s,n);case"wc_sessionRequest":return this.onSessionRequestResponse(s,n);default:return this.client.logger.info(`Unsupported response method ${r}`)}},this.onRelayEventUnknownPayload=t=>{const{topic:s}=t,{message:n}=p("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)},this.onSessionProposeRequest=async(t,s)=>{const{params:n,id:r}=s;try{this.isValidConnect(j({},s.params));const a=Q(y.FIVE_MINUTES),o=j({id:r,pairingTopic:t,expiry:a},n);await this.setProposal(r,o);const c=ve(JSON.stringify(s)),l=await this.getVerifyContext(c,o.proposer.metadata);this.client.events.emit("session_proposal",{id:r,params:o,verifyContext:l})}catch(a){await this.sendError(r,t,a),this.client.logger.error(a)}},this.onSessionProposeResponse=async(t,s)=>{const{id:n}=s;if(ne(s)){const{result:r}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:r});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const o=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:o});const c=r.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:c});const l=await this.client.core.crypto.generateSharedKey(o,c);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:l});const h=await this.client.core.relayer.subscribe(l);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:t})}else ee(s)&&(await this.client.proposal.delete(n,x("USER_DISCONNECTED")),this.events.emit(N("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(t,s)=>{const{id:n,params:r}=s;try{this.isValidSessionSettleRequest(r);const{relay:a,controller:o,expiry:c,namespaces:l,requiredNamespaces:h,optionalNamespaces:u,sessionProperties:g,pairingTopic:S}=s.params,d=j({topic:t,relay:a,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:S,requiredNamespaces:h,optionalNamespaces:u,controller:o.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:o.publicKey,metadata:o.metadata}},g&&{sessionProperties:g});await this.sendResult({id:s.id,topic:t,result:!0}),this.events.emit(N("session_connect"),{session:d}),this.cleanupDuplicatePairings(d)}catch(a){await this.sendError(n,t,a),this.client.logger.error(a)}},this.onSessionSettleResponse=async(t,s)=>{const{id:n}=s;ne(s)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(N("session_approve",n),{})):ee(s)&&(await this.client.session.delete(t,x("USER_DISCONNECTED")),this.events.emit(N("session_approve",n),{error:s.error}))},this.onSessionUpdateRequest=async(t,s)=>{const{params:n,id:r}=s;try{const a=`${t}_session_update`,o=Be.get(a);if(o&&this.isRequestOutOfSync(o,r)){this.client.logger.info(`Discarding out of sync request - ${r}`);return}this.isValidUpdate(j({topic:t},n)),await this.client.session.update(t,{namespaces:n.namespaces}),await this.sendResult({id:r,topic:t,result:!0}),this.client.events.emit("session_update",{id:r,topic:t,params:n}),Be.set(a,r)}catch(a){await this.sendError(r,t,a),this.client.logger.error(a)}},this.isRequestOutOfSync=(t,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(t.toString().slice(0,-3)),this.onSessionUpdateResponse=(t,s)=>{const{id:n}=s;ne(s)?this.events.emit(N("session_update",n),{}):ee(s)&&this.events.emit(N("session_update",n),{error:s.error})},this.onSessionExtendRequest=async(t,s)=>{const{id:n}=s;try{this.isValidExtend({topic:t}),await this.setExpiry(t,Q(Qe)),await this.sendResult({id:n,topic:t,result:!0}),this.client.events.emit("session_extend",{id:n,topic:t})}catch(r){await this.sendError(n,t,r),this.client.logger.error(r)}},this.onSessionExtendResponse=(t,s)=>{const{id:n}=s;ne(s)?this.events.emit(N("session_extend",n),{}):ee(s)&&this.events.emit(N("session_extend",n),{error:s.error})},this.onSessionPingRequest=async(t,s)=>{const{id:n}=s;try{this.isValidPing({topic:t}),await this.sendResult({id:n,topic:t,result:!0}),this.client.events.emit("session_ping",{id:n,topic:t})}catch(r){await this.sendError(n,t,r),this.client.logger.error(r)}},this.onSessionPingResponse=(t,s)=>{const{id:n}=s;setTimeout(()=>{ne(s)?this.events.emit(N("session_ping",n),{}):ee(s)&&this.events.emit(N("session_ping",n),{error:s.error})},500)},this.onSessionDeleteRequest=async(t,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:t,reason:s.params}),await Promise.all([new Promise(r=>{this.client.core.relayer.once(U.publish,async()=>{r(await this.deleteSession(t))})}),this.sendResult({id:n,topic:t,result:!0})]),this.client.events.emit("session_delete",{id:n,topic:t})}catch(r){this.client.logger.error(r)}},this.onSessionRequest=async(t,s)=>{const{id:n,params:r}=s;try{this.isValidRequest(j({topic:t},r));const a=ve(JSON.stringify(be("wc_sessionRequest",r,n))),o=this.client.session.get(t),c=await this.getVerifyContext(a,o.peer.metadata),l={id:n,topic:t,params:r,verifyContext:c};await this.setPendingSessionRequest(l),this.addSessionRequestToSessionRequestQueue(l),this.processSessionRequestQueue()}catch(a){await this.sendError(n,t,a),this.client.logger.error(a)}},this.onSessionRequestResponse=(t,s)=>{const{id:n}=s;ne(s)?this.events.emit(N("session_request",n),{result:s.result}):ee(s)&&this.events.emit(N("session_request",n),{error:s.error})},this.onSessionEventRequest=async(t,s)=>{const{id:n,params:r}=s;try{const a=`${t}_session_event_${r.event.name}`,o=Be.get(a);if(o&&this.isRequestOutOfSync(o,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidEmit(j({topic:t},r)),this.client.events.emit("session_event",{id:n,topic:t,params:r}),Be.set(a,n)}catch(a){await this.sendError(n,t,a),this.client.logger.error(a)}},this.addSessionRequestToSessionRequestQueue=t=>{this.sessionRequestQueue.queue.push(t)},this.cleanupAfterResponse=t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ie.idle,this.processSessionRequestQueue()},y.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===ie.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=ie.active,this.client.events.emit("session_request",t)}catch(s){this.client.logger.error(s)}},this.onPairingCreated=t=>{if(t.active)return;const s=this.client.proposal.getAll().find(n=>n.pairingTopic===t.topic);s&&this.onSessionProposeRequest(t.topic,be("wc_sessionPropose",{requiredNamespaces:s.requiredNamespaces,optionalNamespaces:s.optionalNamespaces,relays:s.relays,proposer:s.proposer},s.id))},this.isValidConnect=async t=>{if(!k(t)){const{message:c}=p("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(c)}const{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:r,sessionProperties:a,relays:o}=t;if(q(s)||await this.isValidPairingTopic(s),!rl(o,!0)){const{message:c}=p("MISSING_OR_INVALID",`connect() relays: ${o}`);throw new Error(c)}!q(n)&&Me(n)!==0&&this.validateNamespaces(n,"requiredNamespaces"),!q(r)&&Me(r)!==0&&this.validateNamespaces(r,"optionalNamespaces"),q(a)||this.validateSessionProps(a,"sessionProperties")},this.validateNamespaces=(t,s)=>{const n=nl(t,"connect()",s);if(n)throw new Error(n.message)},this.isValidApprove=async t=>{if(!k(t))throw new Error(p("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:s,namespaces:n,relayProtocol:r,sessionProperties:a}=t;await this.isValidProposalId(s);const o=this.client.proposal.get(s),c=Je(n,"approve()");if(c)throw new Error(c.message);const l=Vs(o.requiredNamespaces,n,"approve()");if(l)throw new Error(l.message);if(!M(r,!0)){const{message:h}=p("MISSING_OR_INVALID",`approve() relayProtocol: ${r}`);throw new Error(h)}q(a)||this.validateSessionProps(a,"sessionProperties")},this.isValidReject=async t=>{if(!k(t)){const{message:r}=p("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(r)}const{id:s,reason:n}=t;if(await this.isValidProposalId(s),!ol(n)){const{message:r}=p("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(r)}},this.isValidSessionSettleRequest=t=>{if(!k(t)){const{message:l}=p("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(l)}const{relay:s,controller:n,namespaces:r,expiry:a}=t;if(!ln(s)){const{message:l}=p("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const o=Zc(n,"onSessionSettleRequest()");if(o)throw new Error(o.message);const c=Je(r,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(le(a)){const{message:l}=p("EXPIRED","onSessionSettleRequest()");throw new Error(l)}},this.isValidUpdate=async t=>{if(!k(t)){const{message:c}=p("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(c)}const{topic:s,namespaces:n}=t;await this.isValidSessionTopic(s);const r=this.client.session.get(s),a=Je(n,"update()");if(a)throw new Error(a.message);const o=Vs(r.requiredNamespaces,n,"update()");if(o)throw new Error(o.message)},this.isValidExtend=async t=>{if(!k(t)){const{message:n}=p("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(n)}const{topic:s}=t;await this.isValidSessionTopic(s)},this.isValidRequest=async t=>{if(!k(t)){const{message:c}=p("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(c)}const{topic:s,request:n,chainId:r,expiry:a}=t;await this.isValidSessionTopic(s);const{namespaces:o}=this.client.session.get(s);if(!zs(o,r)){const{message:c}=p("MISSING_OR_INVALID",`request() chainId: ${r}`);throw new Error(c)}if(!cl(n)){const{message:c}=p("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(c)}if(!ul(o,r,n.method)){const{message:c}=p("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(c)}if(a&&!yl(a,Nt)){const{message:c}=p("MISSING_OR_INVALID",`request() expiry: ${a}. Expiry must be a number (in seconds) between ${Nt.min} and ${Nt.max}`);throw new Error(c)}},this.isValidRespond=async t=>{if(!k(t)){const{message:r}=p("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(r)}const{topic:s,response:n}=t;if(await this.isValidSessionTopic(s),!ll(n)){const{message:r}=p("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(r)}},this.isValidPing=async t=>{if(!k(t)){const{message:n}=p("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(n)}const{topic:s}=t;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async t=>{if(!k(t)){const{message:o}=p("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(o)}const{topic:s,event:n,chainId:r}=t;await this.isValidSessionTopic(s);const{namespaces:a}=this.client.session.get(s);if(!zs(a,r)){const{message:o}=p("MISSING_OR_INVALID",`emit() chainId: ${r}`);throw new Error(o)}if(!hl(n)){const{message:o}=p("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(o)}if(!dl(a,r,n.name)){const{message:o}=p("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(o)}},this.isValidDisconnect=async t=>{if(!k(t)){const{message:n}=p("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(n)}const{topic:s}=t;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(t,s)=>{const n={verified:{verifyUrl:s.verifyUrl||we,validation:"UNKNOWN",origin:s.url||""}};try{const r=await this.client.core.verify.resolve({attestationId:t,verifyUrl:s.verifyUrl});r&&(n.verified.origin=r.origin,n.verified.isScam=r.isScam,n.verified.validation=r.origin===new URL(s.url).origin?"VALID":"INVALID")}catch(r){this.client.logger.info(r)}return this.client.logger.info(`Verify context: ${JSON.stringify(n)}`),n},this.validateSessionProps=(t,s)=>{Object.values(t).forEach(n=>{if(!M(n,!1)){const{message:r}=p("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(n)}`);throw new Error(r)}})}}async isInitialized(){if(!this.initialized){const{message:e}=p("NOT_INITIALIZED",this.name);throw new Error(e)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(U.message,async e=>{const{topic:t,message:s}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const n=await this.client.core.crypto.decode(t,s);try{ct(n)?(this.client.core.history.set(t,n),this.onRelayEventRequest({topic:t,payload:n})):lt(n)?(await this.client.core.history.resolve(n),await this.onRelayEventResponse({topic:t,payload:n}),this.client.core.history.delete(t,n.id)):this.onRelayEventUnknownPayload({topic:t,payload:n})}catch(r){this.client.logger.error(r)}})}registerExpirerEvents(){this.client.core.expirer.on(K.expired,async e=>{const{topic:t,id:s}=on(e.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,p("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession(t,!0),this.client.events.emit("session_expire",{topic:t})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}registerPairingEvents(){this.client.core.pairing.events.on(xe.create,e=>this.onPairingCreated(e))}isValidPairingTopic(e){if(!M(e,!1)){const{message:t}=p("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=p("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(le(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=p("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!M(e,!1)){const{message:t}=p("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(!this.client.session.keys.includes(e)){const{message:t}=p("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(le(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:t}=p("EXPIRED",`session topic: ${e}`);throw new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(M(e,!1)){const{message:t}=p("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=p("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!al(e)){const{message:t}=p("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=p("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(le(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:t}=p("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class ud extends pt{constructor(e,t){super(e,t,Xu,os),this.core=e,this.logger=t}}class dd extends pt{constructor(e,t){super(e,t,td,os),this.core=e,this.logger=t}}class pd extends pt{constructor(e,t){super(e,t,id,os,s=>s.id),this.core=e,this.logger=t}}class cs extends rc{constructor(e){super(e),this.protocol=_n,this.version=Tn,this.name=At.name,this.events=new ce.EventEmitter,this.on=(s,n)=>this.events.on(s,n),this.once=(s,n)=>this.events.once(s,n),this.off=(s,n)=>this.events.off(s,n),this.removeListener=(s,n)=>this.events.removeListener(s,n),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(n){throw this.logger.error(n.message),n}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(n){throw this.logger.error(n.message),n}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(n){throw this.logger.error(n.message),n}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(n){throw this.logger.error(n.message),n}},this.update=async s=>{try{return await this.engine.update(s)}catch(n){throw this.logger.error(n.message),n}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(n){throw this.logger.error(n.message),n}},this.request=async s=>{try{return await this.engine.request(s)}catch(n){throw this.logger.error(n.message),n}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(n){throw this.logger.error(n.message),n}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(n){throw this.logger.error(n.message),n}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(n){throw this.logger.error(n.message),n}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(n){throw this.logger.error(n.message),n}},this.find=s=>{try{return this.engine.find(s)}catch(n){throw this.logger.error(n.message),n}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(e==null?void 0:e.name)||At.name,this.metadata=(e==null?void 0:e.metadata)||Sc();const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:b.pino(b.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||At.logger}));this.core=(e==null?void 0:e.core)||new Zu(e),this.logger=b.generateChildLogger(t,this.name),this.session=new dd(this.core,this.logger),this.proposal=new ud(this.core,this.logger),this.pendingRequest=new pd(this.core,this.logger),this.engine=new hd(this)}static async init(e){const t=new cs(e);return await t.initialize(),t}get context(){return b.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const gd=cs;var Bt={exports:{}},Ee=typeof Reflect=="object"?Reflect:null,yi=Ee&&typeof Ee.apply=="function"?Ee.apply:function(i,e,t){return Function.prototype.apply.call(i,e,t)},Ze;Ee&&typeof Ee.ownKeys=="function"?Ze=Ee.ownKeys:Object.getOwnPropertySymbols?Ze=function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:Ze=function(i){return Object.getOwnPropertyNames(i)};function yd(i){console&&console.warn&&console.warn(i)}var mi=Number.isNaN||function(i){return i!==i};function I(){I.init.call(this)}Bt.exports=I,Bt.exports.once=bd,I.EventEmitter=I,I.prototype._events=void 0,I.prototype._eventsCount=0,I.prototype._maxListeners=void 0;var fi=10;function Xe(i){if(typeof i!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i)}Object.defineProperty(I,"defaultMaxListeners",{enumerable:!0,get:function(){return fi},set:function(i){if(typeof i!="number"||i<0||mi(i))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+i+".");fi=i}}),I.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},I.prototype.setMaxListeners=function(i){if(typeof i!="number"||i<0||mi(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this};function Cn(i){return i._maxListeners===void 0?I.defaultMaxListeners:i._maxListeners}I.prototype.getMaxListeners=function(){return Cn(this)},I.prototype.emit=function(i){for(var e=[],t=1;t<arguments.length;t++)e.push(arguments[t]);var s=i==="error",n=this._events;if(n!==void 0)s=s&&n.error===void 0;else if(!s)return!1;if(s){var r;if(e.length>0&&(r=e[0]),r instanceof Error)throw r;var a=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw a.context=r,a}var o=n[i];if(o===void 0)return!1;if(typeof o=="function")yi(o,this,e);else for(var c=o.length,l=An(o,c),t=0;t<c;++t)yi(l[t],this,e);return!0};function wi(i,e,t,s){var n,r,a;if(Xe(t),r=i._events,r===void 0?(r=i._events=Object.create(null),i._eventsCount=0):(r.newListener!==void 0&&(i.emit("newListener",e,t.listener?t.listener:t),r=i._events),a=r[e]),a===void 0)a=r[e]=t,++i._eventsCount;else if(typeof a=="function"?a=r[e]=s?[t,a]:[a,t]:s?a.unshift(t):a.push(t),n=Cn(i),n>0&&a.length>n&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=i,o.type=e,o.count=a.length,yd(o)}return i}I.prototype.addListener=function(i,e){return wi(this,i,e,!1)},I.prototype.on=I.prototype.addListener,I.prototype.prependListener=function(i,e){return wi(this,i,e,!0)};function md(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function bi(i,e,t){var s={fired:!1,wrapFn:void 0,target:i,type:e,listener:t},n=md.bind(s);return n.listener=t,s.wrapFn=n,n}I.prototype.once=function(i,e){return Xe(e),this.on(i,bi(this,i,e)),this},I.prototype.prependOnceListener=function(i,e){return Xe(e),this.prependListener(i,bi(this,i,e)),this},I.prototype.removeListener=function(i,e){var t,s,n,r,a;if(Xe(e),s=this._events,s===void 0)return this;if(t=s[i],t===void 0)return this;if(t===e||t.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete s[i],s.removeListener&&this.emit("removeListener",i,t.listener||e));else if(typeof t!="function"){for(n=-1,r=t.length-1;r>=0;r--)if(t[r]===e||t[r].listener===e){a=t[r].listener,n=r;break}if(n<0)return this;n===0?t.shift():fd(t,n),t.length===1&&(s[i]=t[0]),s.removeListener!==void 0&&this.emit("removeListener",i,a||e)}return this},I.prototype.off=I.prototype.removeListener,I.prototype.removeAllListeners=function(i){var e,t,s;if(t=this._events,t===void 0)return this;if(t.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):t[i]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete t[i]),this;if(arguments.length===0){var n=Object.keys(t),r;for(s=0;s<n.length;++s)r=n[s],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=t[i],typeof e=="function")this.removeListener(i,e);else if(e!==void 0)for(s=e.length-1;s>=0;s--)this.removeListener(i,e[s]);return this};function vi(i,e,t){var s=i._events;if(s===void 0)return[];var n=s[e];return n===void 0?[]:typeof n=="function"?t?[n.listener||n]:[n]:t?wd(n):An(n,n.length)}I.prototype.listeners=function(i){return vi(this,i,!0)},I.prototype.rawListeners=function(i){return vi(this,i,!1)},I.listenerCount=function(i,e){return typeof i.listenerCount=="function"?i.listenerCount(e):Ei.call(i,e)},I.prototype.listenerCount=Ei;function Ei(i){var e=this._events;if(e!==void 0){var t=e[i];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}I.prototype.eventNames=function(){return this._eventsCount>0?Ze(this._events):[]};function An(i,e){for(var t=new Array(e),s=0;s<e;++s)t[s]=i[s];return t}function fd(i,e){for(;e+1<i.length;e++)i[e]=i[e+1];i.pop()}function wd(i){for(var e=new Array(i.length),t=0;t<e.length;++t)e[t]=i[t].listener||i[t];return e}function bd(i,e){return new Promise(function(t,s){function n(a){i.removeListener(e,r),s(a)}function r(){typeof i.removeListener=="function"&&i.removeListener("error",n),t([].slice.call(arguments))}Nn(i,e,r,{once:!0}),e!=="error"&&vd(i,n,{once:!0})})}function vd(i,e,t){typeof i.on=="function"&&Nn(i,"error",e,t)}function Nn(i,e,t,s){if(typeof i.on=="function")s.once?i.once(e,t):i.on(e,t);else if(typeof i.addEventListener=="function")i.addEventListener(e,function n(r){s.once&&i.removeEventListener(e,n),t(r)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof i)}const Ed="Web3Wallet";class Id{constructor(e){this.opts=e}}class Sd{constructor(e){this.client=e}}class _d extends Sd{constructor(e){super(e),this.init=async()=>{this.signClient=await gd.init({core:this.client.core,metadata:this.client.metadata}),this.authClient=await Ho.init({core:this.client.core,projectId:"",metadata:this.client.metadata}),this.initializeEventListeners()},this.pair=async t=>{await this.client.core.pairing.pair(t)},this.approveSession=async t=>{const{topic:s,acknowledged:n}=await this.signClient.approve({id:t.id,namespaces:t.namespaces});return await n(),this.signClient.session.get(s)},this.rejectSession=async t=>await this.signClient.reject(t),this.updateSession=async t=>await(await this.signClient.update(t)).acknowledged(),this.extendSession=async t=>await(await this.signClient.extend(t)).acknowledged(),this.respondSessionRequest=async t=>await this.signClient.respond(t),this.disconnectSession=async t=>await this.signClient.disconnect(t),this.emitSessionEvent=async t=>await this.signClient.emit(t),this.getActiveSessions=()=>this.signClient.session.getAll().reduce((t,s)=>(t[s.topic]=s,t),{}),this.getPendingSessionProposals=()=>this.signClient.proposal.getAll(),this.getPendingSessionRequests=()=>this.signClient.getPendingSessionRequests(),this.respondAuthRequest=async(t,s)=>await this.authClient.respond(t,s),this.getPendingAuthRequests=()=>this.authClient.requests.getAll().filter(t=>"requester"in t),this.formatMessage=(t,s)=>this.authClient.formatMessage(t,s),this.onSessionRequest=t=>{this.client.events.emit("session_request",t)},this.onSessionProposal=t=>{this.client.events.emit("session_proposal",t)},this.onSessionDelete=t=>{this.client.events.emit("session_delete",t)},this.onAuthRequest=t=>{this.client.events.emit("auth_request",t)},this.initializeEventListeners=()=>{this.signClient.events.on("session_proposal",this.onSessionProposal),this.signClient.events.on("session_request",this.onSessionRequest),this.signClient.events.on("session_delete",this.onSessionDelete),this.authClient.on("auth_request",this.onAuthRequest)},this.signClient={},this.authClient={}}}class ls extends Id{constructor(e){super(e),this.events=new Bt.exports,this.on=(t,s)=>this.events.on(t,s),this.once=(t,s)=>this.events.once(t,s),this.off=(t,s)=>this.events.off(t,s),this.removeListener=(t,s)=>this.events.removeListener(t,s),this.pair=async t=>{try{return await this.engine.pair(t)}catch(s){throw this.logger.error(s.message),s}},this.approveSession=async t=>{try{return await this.engine.approveSession(t)}catch(s){throw this.logger.error(s.message),s}},this.rejectSession=async t=>{try{return await this.engine.rejectSession(t)}catch(s){throw this.logger.error(s.message),s}},this.updateSession=async t=>{try{return await this.engine.updateSession(t)}catch(s){throw this.logger.error(s.message),s}},this.extendSession=async t=>{try{return await this.engine.extendSession(t)}catch(s){throw this.logger.error(s.message),s}},this.respondSessionRequest=async t=>{try{return await this.engine.respondSessionRequest(t)}catch(s){throw this.logger.error(s.message),s}},this.disconnectSession=async t=>{try{return await this.engine.disconnectSession(t)}catch(s){throw this.logger.error(s.message),s}},this.emitSessionEvent=async t=>{try{return await this.engine.emitSessionEvent(t)}catch(s){throw this.logger.error(s.message),s}},this.getActiveSessions=()=>{try{return this.engine.getActiveSessions()}catch(t){throw this.logger.error(t.message),t}},this.getPendingSessionProposals=()=>{try{return this.engine.getPendingSessionProposals()}catch(t){throw this.logger.error(t.message),t}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(t){throw this.logger.error(t.message),t}},this.respondAuthRequest=async(t,s)=>{try{return await this.engine.respondAuthRequest(t,s)}catch(n){throw this.logger.error(n.message),n}},this.getPendingAuthRequests=()=>{try{return this.engine.getPendingAuthRequests()}catch(t){throw this.logger.error(t.message),t}},this.formatMessage=(t,s)=>{try{return this.engine.formatMessage(t,s)}catch(n){throw this.logger.error(n.message),n}},this.metadata=e.metadata,this.name=e.name||Ed,this.core=e.core,this.logger=this.core.logger,this.engine=new _d(this)}static async init(e){const t=new ls(e);return await t.initialize(),t}async initialize(){this.logger.trace("Initialized");try{await this.engine.init(),this.logger.info("Web3Wallet Initialization Success")}catch(e){throw this.logger.info("Web3Wallet Initialization Failure"),this.logger.error(e.message),e}}}const Td=ls;var Pd={Ethereum:"https://ethereum.rpc.thirdweb.com",Goerli:"https://goerli.rpc.thirdweb.com",Mumbai:"https://mumbai.rpc.thirdweb.com",Polygon:"https://polygon.rpc.thirdweb.com",Avalanche:"https://avalanche.rpc.thirdweb.com",Optimism:"https://optimism.rpc.thirdweb.com",OptimismGoerli:"https://optimism-goerli.rpc.thirdweb.com",BSC:"https://binance.rpc.thirdweb.com",BSCTestnet:"https://binance-testnet.rpc.thirdweb.com",ArbitrumOne:"https://arbitrum.rpc.thirdweb.com",ArbitrumGoerli:"https://arbitrum-goerli.rpc.thirdweb.com",Fantom:"https://fantom.rpc.thirdweb.com",FantomTestnet:"https://fantom-testnet.rpc.thirdweb.com",Sepolia:"https://sepolia.rpc.thirdweb.com",AvalancheFuji:"https://avalanche-fuji.rpc.thirdweb.com"},Cd=()=>typeof window<"u"&&window.localStorage.getItem("IS_PAPER_DEV")==="true",Ad=()=>typeof window<"u"&&window.location.origin.includes("paper.xyz"),Nd=()=>{var i;return Cd()?(i=window.localStorage.getItem("PAPER_DEV_URL"))!=null?i:"http://localhost:3000":Ad()?window.location.origin:"https://withpaper.com"};function Rn(){if(Yt(globalThis.window)&&globalThis.window.ethereum&&window.okxwallet)return window.okxwallet}class gt extends J{get walletName(){return"OKX"}constructor(e){super(gt.id,e),this.isInjected=!!Rn()}async getConnector(){var e,t,s;if(!this.connector)if(this.isInjected){const{OKXConnector:n}=await W(()=>import("./thirdweb-dev-wallets-evm-connectors-okx.browser.esm-UL6b3woO.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]));this.OKXConnector=new n({chains:this.chains,connectorStorage:this.walletStorage,options:{shimDisconnect:!0}}),this.connector=new oe(this.OKXConnector)}else{const{WalletConnectConnector:n}=await W(()=>import("./thirdweb-dev-wallets-evm-connectors-wallet-connect.browser.esm-bOO3calr.js"),__vite__mapDeps([9,1,2,5,3])),r=new n({chains:this.chains,options:{projectId:((e=this.options)==null?void 0:e.projectId)||Jt,storage:this.walletStorage,qrcode:(t=this.options)==null?void 0:t.qrcode,dappMetadata:this.dappMetadata,qrModalOptions:(s=this.options)==null?void 0:s.qrModalOptions}});r.getProvider().then(a=>{a.signer.client.on("session_request_sent",()=>{this.emit("wc_session_request_sent")})}),this.walletConnectConnector=r,this.connector=new oe(r)}return this.connector}async connectWithQrCode(e){await this.getConnector();const t=this.walletConnectConnector;if(!t)throw new Error("WalletConnect connector not found");(await t.getProvider()).on("display_uri",n=>{e.onQrCodeUri(n)}),this.connect({chainId:e.chainId}).then(e.onConnected)}async switchAccount(){if(!this.OKXConnector)throw new Error("Can not switch Account");await this.OKXConnector.switchAccount()}}A(gt,"id",Z.okx);function On(){if(Yt(globalThis.window)&&globalThis.window.ethereum&&window.avalanche)return window.avalanche}class yt extends J{get walletName(){return"Core wallet"}constructor(e){super(yt.id,e),this.isInjected=!!On()}async getConnector(){var e,t,s;if(!this.connector)if(this.isInjected){const{CoreWalletConnector:n}=await W(()=>import("./thirdweb-dev-wallets-evm-connectors-core-wallet.browser.esm-UtegL-Nh.js"),__vite__mapDeps([10,1,2,3,4,5,6,7,8]));this.CoreWalletConnector=new n({chains:this.chains,connectorStorage:this.walletStorage,options:{shimDisconnect:!0}}),this.connector=new oe(this.CoreWalletConnector)}else{const{WalletConnectConnector:n}=await W(()=>import("./thirdweb-dev-wallets-evm-connectors-wallet-connect.browser.esm-bOO3calr.js"),__vite__mapDeps([9,1,2,5,3])),r=new n({chains:this.chains,options:{projectId:((e=this.options)==null?void 0:e.projectId)||Jt,storage:this.walletStorage,qrcode:(t=this.options)==null?void 0:t.qrcode,dappMetadata:this.dappMetadata,qrModalOptions:(s=this.options)==null?void 0:s.qrModalOptions}});r.getProvider().then(a=>{a.signer.client.on("session_request_sent",()=>{this.emit("wc_session_request_sent")})}),this.walletConnectConnector=r,this.connector=new oe(r)}return this.connector}async connectWithQrCode(e){await this.getConnector();const t=this.walletConnectConnector;if(!t)throw new Error("WalletConnect connector not found");(await t.getProvider()).on("display_uri",n=>{e.onQrCodeUri(n)}),this.connect({chainId:e.chainId}).then(e.onConnected)}async switchAccount(){if(!this.CoreWalletConnector)throw new Error("Can not switch Account");await this.CoreWalletConnector.switchAccount()}}A(yt,"id",Z.coreWallet);class mt extends Ci{constructor(e,t){super(),this.config={...e,engineUrl:e.engineUrl.replace(/\/$/,"")},kn(this,"provider",t||null)}async getAddress(){return this.config.backendWalletAddress}async signMessage(e){return(await this.fetch({path:"/backend-wallet/sign-message",method:"POST",body:{message:e}})).result}async signTransaction(e){var n,r,a,o,c,l;const t=await ys(e);return(await this.fetch({path:"/backend-wallet/sign-transaction",method:"POST",body:{...t,nonce:(n=t.nonce)==null?void 0:n.toString(),gasLimit:(r=t.gasLimit)==null?void 0:r.toString(),gasPrice:(a=t.gasPrice)==null?void 0:a.toString(),value:(o=t.value)==null?void 0:o.toString(),maxPriorityFeePerGas:(c=t.maxPriorityFeePerGas)==null?void 0:c.toString(),maxFeePerGas:(l=t.maxFeePerGas)==null?void 0:l.toString()}})).result}async sendTransaction(e){if(!this.provider)throw new Error("Sending transactions requires a provider!");const t=(await this.provider.getNetwork()).chainId,s=await ys(e),r=(await this.fetch({path:`/backend-wallet/${t}/send-transaction`,method:"POST",body:{toAddress:s.to,data:s.data,value:s.value||"0"}})).result.queueId;return{hash:r,confirmations:0,from:this.config.backendWalletAddress,nonce:0,gasLimit:ms.from(0),value:ms.from(0),data:"",chainId:t,wait:async a=>{if(!this.provider)throw new Error("Sending transactions requires a provider!");for(;;){const{result:o}=await this.fetch({path:`/transaction/status/${r}`,method:"GET"});switch(o.status){case"errored":throw new Error(`Transaction errored with reason: ${o.errorMessage}`);case"cancelled":throw new Error("Transaction execution cancelled.");case"mined":return await this.provider.getTransactionReceipt(o.transactionHash)}await new Promise(c=>setTimeout(c,1e3))}}}}connect(e){return new mt(this.config,e)}async fetch(e){let{path:t,method:s,body:n}=e;const r=await fetch(`${this.config.engineUrl}${t}`,{method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.accessToken}`,"x-backend-wallet-address":this.config.backendWalletAddress},...n?{body:JSON.stringify(n)}:{}});if(!r.ok)throw new Error(await r.text());return r.json()}}var Rt=new WeakMap;class Rd extends Zt{constructor(e){super(),re(this,Rt,{writable:!0,value:void 0}),z(this,Rt,new mt(e))}async getSigner(){return f(this,Rt)}}class ze extends J{get walletName(){return"Paper Wallet"}constructor(e){var t;super(ze.id,{...e});try{this.chain={...e.chain,rpc:Xt(e.chain,e.clientId)}}catch{this.chain=e.chain}if(e.paperClientId&&e.paperClientId==="uninitialized"){this.paperClientId="00000000-0000-0000-0000-000000000000";return}if(e.advancedOptions&&((t=e.advancedOptions)==null?void 0:t.recoveryShareManagement)==="USER_MANAGED"&&(e.paperClientId&&!this.isClientIdLegacyPaper(e.paperClientId)||!e.paperClientId&&e.clientId&&!this.isClientIdLegacyPaper(e.clientId)))throw new Error('RecoveryShareManagement option "USER_MANAGED" is not supported with thirdweb client ID');if(!e.clientId&&!e.paperClientId)throw new Error("clientId or paperClientId is required");if(e.paperClientId&&!this.isClientIdLegacyPaper(e.paperClientId))throw new Error("paperClientId must be a legacy paper client ID");if(e.clientId&&this.isClientIdLegacyPaper(e.clientId))throw new Error("clientId must be a thirdweb client ID");this.paperClientId=e.paperClientId??e.clientId,this.onAuthSuccess=e.onAuthSuccess}isClientIdLegacyPaper(e){return e.indexOf("-")>0&&e.length===36}async getConnector(){var e,t,s;if(!this.connector){const{PaperWalletConnector:n}=await W(()=>import("./thirdweb-dev-wallets-evm-connectors-paper.browser.esm-zA63Tt_l.js"),__vite__mapDeps([11,1,2,6,7,8,3]));this.connector=new n({clientId:this.paperClientId,chain:this.chain,chains:this.chains,onAuthSuccess:this.onAuthSuccess,advancedOptions:{recoveryShareManagement:(t=(e=this.options)==null?void 0:e.advancedOptions)==null?void 0:t.recoveryShareManagement},styles:(s=this.options)==null?void 0:s.styles})}return this.connector}getConnectParams(){const e=super.getConnectParams();if(e)return typeof e.googleLogin=="object"?{...e,googleLogin:!0}:e}async getEmail(){return(await this.getConnector()).getEmail()}async getPaperSDK(){return(await this.getConnector()).getPaperSDK()}}A(ze,"id",Z.paper);A(ze,"meta",{name:"Paper Wallet",iconURL:"ipfs://QmNrLXtPoFrh4yjZbXui39zUMozS1oetpgU8dvZhFAxfRa/paper-logo-icon.svg"});class Ve extends J{constructor(e){e!=null&&e.chain&&e.clientId&&(e.chain=zn(e.chain,e.clientId)),super(Ve.id,e),A(this,"name","Blocto")}async initConnector(){var s,n,r;const{BloctoConnector:e}=await W(()=>import("./thirdweb-dev-wallets-evm-connectors-blocto.browser.esm-jsRgAUhv.js"),__vite__mapDeps([12,1,2,5,3,6])),t=new e({chains:this.chains,options:{appId:(s=this.options)==null?void 0:s.appId,chainId:(r=(n=this.options)==null?void 0:n.chain)==null?void 0:r.chainId}});return this.connector=new oe(t),this.connector}async getConnector(){return this.connector?Promise.resolve(this.connector):await this.initConnector()}}A(Ve,"id",Z.blocto);A(Ve,"meta",{name:"Blocto",iconURL:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgY2xpcC1wYXRoPSJ1cmwoI2NsaXAwXzIyMzNfMjM4NykiPgo8cmVjdCB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHJ4PSIxMiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTMyLjkwMjggMTguMzA2M0MyOC4zOTExIDE4LjMwNjMgMjMuOTg3MyAyMC4wNDU5IDIwLjY5NTIgMjMuMTMxOUMxNy4wODQzIDI2LjUxNzYgMTQuNzk5MiAzMS41MTc3IDEzLjQ4OTMgMzYuMjIxMkMxMi42MzE0IDM5LjI5OTIgMTIuMjAxNiA0Mi40OTE1IDEyLjIwMTYgNDUuNjg1M0MxMi4yMDE2IDQ2LjY1MTEgMTIuMjQxMiA0Ny42MDg5IDEyLjMxNzQgNDguNTU1NkMxMi40MTA5IDQ5LjcwNjkgMTMuNTMyMSA1MC41MDQ2IDE0LjY0ODUgNTAuMjAzM0MxNS42MjIyIDQ5Ljk0MTYgMTYuNjQ2NiA0OS44MDA1IDE3LjcwMjggNDkuODAwNUMxOS44NzIyIDQ5LjgwMDUgMjEuOTA1MiA1MC4zOTA0IDIzLjY0OCA1MS40MjEyQzIzLjY5MDggNTEuNDQ2NiAyMy43MzIgNTEuNDcxOSAyMy43NzQ4IDUxLjQ5NTdDMjYuNjA3MSA1My4xODQ2IDI5Ljk0ODQgNTQuMTEyMyAzMy41MTE3IDUzLjk5MzRDNDIuODA2MiA1My42ODU3IDUwLjM5OSA0Ni4xMjMgNTAuNzQxNiAzNi44MzAxQzUxLjExNTggMjYuNjYzNSA0Mi45ODY5IDE4LjMwNDcgMzIuOTA0NCAxOC4zMDQ3TDMyLjkwMjggMTguMzA2M1pNMzIuOTAyOCA0NC4zMTJDMjguMzk3NSA0NC4zMTIgMjQuNzQ1NCA0MC42NTk5IDI0Ljc0NTQgMzYuMTU2MkMyNC43NDU0IDMxLjY1MjUgMjguMzk3NSAyNy45OTg3IDMyLjkwMjggMjcuOTk4N0MzNy40MDgxIDI3Ljk5ODcgNDEuMDYwMiAzMS42NTA5IDQxLjA2MDIgMzYuMTU2MkM0MS4wNjAyIDQwLjY2MTQgMzcuNDA4MSA0NC4zMTIgMzIuOTAyOCA0NC4zMTJaIiBmaWxsPSIjMTRBQUZGIi8+CjxwYXRoIGQ9Ik0yNS41NjM2IDEyLjY4MjZDMjUuNTYzNiAxNS4wMzQ0IDI0LjMzMTUgMTcuMjE2NCAyMi4zMDggMTguNDE1M0MyMS4wMzc3IDE5LjE2ODYgMTkuODQ2OCAyMC4wNTgyIDE4Ljc2ODQgMjEuMDcxNUMxNi4zNzU1IDIzLjMxMzkgMTQuNTg5OCAyNi4wNjUzIDEzLjI2NzMgMjguNzkyOUMxMy4wMDcyIDI5LjMzMDQgMTIuMiAyOS4xNDAyIDEyLjIgMjguNTQyM1YxMi42ODI2QzEyLjIgOC45OTI0MiAxNS4xOTI0IDYgMTguODgyNiA2QzIyLjU3MjggNiAyNS41NjUyIDguOTkyNDIgMjUuNTY1MiAxMi42ODI2SDI1LjU2MzZaIiBmaWxsPSIjMDA3NUZGIi8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMjIzM18yMzg3Ij4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiBmaWxsPSJ3aGl0ZSIvPgo8L2NsaXBQYXRoPgo8L2RlZnM+Cjwvc3ZnPgo=",urls:{android:"https://play.google.com/store/apps/details?id=com.portto.blocto",ios:"https://apps.apple.com/app/blocto/id1481181682"}});let hs=class Qt extends J{static async sendVerificationEmail(e){return new Qt({chain:Vn,clientId:e.clientId}).sendVerificationEmail({email:e.email})}get walletName(){return"Embedded Wallet"}constructor(e){super(Qt.id,{...e});try{this.chain={...e.chain,rpc:Xt(e.chain,e.clientId)}}catch{this.chain=e.chain}}async getConnector(){var e,t;if(!this.connector){const{EmbeddedWalletConnector:s}=await W(()=>import("./thirdweb-dev-wallets-evm-connectors-embedded-wallet.browser.esm-QHTKDgtu.js"),__vite__mapDeps([13,1,2,6,7,8,3]));this.connector=new s({clientId:((e=this.options)==null?void 0:e.clientId)??"",chain:this.chain,chains:this.chains,onAuthSuccess:(t=this.options)==null?void 0:t.onAuthSuccess})}return this.connector}autoConnect(e){if(!e)throw new Error("Can't autoconnect embedded wallet");return this.connect(e)}getConnectParams(){const e=super.getConnectParams();if(e)return{chainId:e.chainId,authResult:{user:e.authResult.user}}}async getEmail(){return(await this.getConnector()).getEmail()}async getEmbeddedWalletSDK(){return(await this.getConnector()).getEmbeddedWalletSDK()}async getRecoveryInformation(){return(await this.getConnector()).getRecoveryInformation()}async sendVerificationEmail(e){let{email:t}=e;return(await this.getConnector()).sendVerificationEmail({email:t})}async authenticate(e){const s=(await this.getConnector()).authenticate(e);try{await this.walletStorage.setItem(Ii,e.strategy)}catch{}return s}async getLastUsedAuthStrategy(){try{return await this.walletStorage.getItem(Ii)}catch{return null}}};A(hs,"id",Z.embeddedWallet);A(hs,"meta",{name:"Embedded Wallet",iconURL:"ipfs://QmNx2evQa6tcQs9VTd3YaDm31ckfStvgRGKFGELahUmrbV/emailIcon.svg"});const Ii="lastUsedAuthStrategy";var Ot=new WeakMap;class Od extends Zt{constructor(e){super(),re(this,Ot,{writable:!0,value:void 0}),z(this,Ot,e)}async getSigner(){return f(this,Ot)}}class ft extends J{get walletName(){return"Frame Wallet"}constructor(e){super(ft.id,e)}async getConnector(){if(!this.connector){const{FrameConnector:e}=await W(()=>import("./thirdweb-dev-wallets-evm-connectors-frame.browser.esm-lIBX0_XT.js"),__vite__mapDeps([14,1,2,5,3,6]));this.connector=new oe(new e({chains:this.chains,connectorStorage:this.walletStorage,options:{shimDisconnect:!0}}))}return this.connector}}A(ft,"id",Z.frame);class wt extends J{get walletName(){return"Injected Wallet"}constructor(e){super(wt.id,e)}async getConnector(){if(!this.connector){const{InjectedConnector:e}=await W(()=>import("./thirdweb-dev-wallets-evm-connectors-injected.browser.esm-yG-y9jf8.js"),__vite__mapDeps([4,1,2,5,3,6]));this.connector=new oe(new e({chains:this.chains,connectorStorage:this.walletStorage,options:{shimDisconnect:!0}}))}return this.connector}}A(wt,"id","injected");class We extends J{get walletName(){return"Magic Link"}constructor(e){super(We.id,e),this.options=e}async initializeConnector(){const{MagicAuthConnector:e}=await W(()=>import("./thirdweb-dev-wallets-evm-connectors-magic.browser.esm-_X3bHoF0.js"),__vite__mapDeps([15,1,2,3,6])),t=new e({chains:this.chains,options:this.options});return this.magicConnector=t,this.connector=new oe(t),this.connector}async getConnector(){return this.connector?this.connector:await this.initializeConnector()}getMagic(){if(!this.magicConnector)throw new Error("Magic connector is not initialized");return this.magicConnector.getMagicSDK()}async autoConnect(e){var n;await this.initializeConnector(),await((n=this.magicConnector)==null?void 0:n.initializeMagicSDK(e));const t=this.getMagic();if(new URL(window.location.href).searchParams.get("magic_credential"))try{this.oAuthRedirectResult=await t.oauth.getRedirectResult()}catch{}if(await t.user.isLoggedIn())return super.autoConnect(e);throw new Error("Magic user is not logged in")}async disconnect(){return this.oAuthRedirectResult=void 0,await this.getMagic().user.logout(),super.disconnect()}async connect(e){if("email"in e&&this.options.emailLogin===!1)throw new Error("Email login is disabled");if("phoneNumber"in e&&this.options.smsLogin===!1)throw new Error("SMS login is disabled");return super.connect(e)}}A(We,"meta",{iconURL:"ipfs://QmUMBFZGXxBpgDmZzZAHhbcCL5nYvZnVaYLTajsNjLcxMU/1-Icon_Magic_Color.svg",name:"Magic Link"});A(We,"id",Z.magicLink);var xt=new WeakMap;class xd extends Zt{constructor(e,t,s){super(),re(this,xt,{writable:!0,value:void 0}),z(this,xt,new Wn(e,t?Kn(t,{secretKey:s}):void 0))}async getSigner(){return f(this,xt)}}const Md={1:"https://safe-transaction-mainnet.safe.global",5:"https://safe-transaction-goerli.safe.global",10:"https://safe-transaction-optimism.safe.global",56:"https://safe-transaction-bsc.safe.global",100:"https://safe-transaction-gnosis-chain.safe.global",137:"https://safe-transaction-polygon.safe.global",43114:"https://safe-transaction-avalanche.safe.global",42161:"https://safe-transaction-arbitrum.safe.global",42220:"https://safe-transaction-celo.safe.global",84531:"https://safe-transaction-base-testnet.safe.global",1313161554:"https://safe-transaction-aurora.safe.global"},Ld=new Set(Object.keys(Md).map(Number));class Ke extends J{get walletName(){return"Safe Wallet"}constructor(e){super(Ke.id,{...e})}async getConnector(){if(!this.connector){const{SafeConnector:e}=await W(()=>import("./thirdweb-dev-wallets-evm-connectors-safe.browser.esm-TOSJqRN2.js"),__vite__mapDeps([16,1,2,17,7,8,18,3,6]));this.connector=new e}return this.connector}async updateChains(e){}getPersonalWallet(){var e;return(e=this.connector)==null?void 0:e.personalWallet}autoConnect(e){return this.connect(e)}}A(Ke,"meta",{name:"Safe",iconURL:"ipfs://QmbbyxDDmmLQh8DzzeUR6X6B75bESsNUFmbdvS3ZsQ2pN1/SafeToken.svg"});A(Ke,"id",Z.safe);const Si=new Map;function bt(i){const e=Si.get(i);if(e)return e;const t=new Yn(i);return Si.set(i,t),t}async function $d(i,e,t){return await(await bt(i).getContract(e)).call("getSignersOfAccount",[t])}async function Dd(i,e,t){const n=await bt(i).getContract(e),r=await xn(i,e,t),a=await n.call("getAccountsOfSigner",[t]);return{owned:r,hasSignerRole:a}}async function Ud(i,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"0x";const n=bt(i),a=await(await n.getContract(e)).call("getAddress",[t,s]);return await Gn(a,n.getProvider())}async function xn(i,e,t){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"0x";return await(await bt(i).getContract(e)).call("getAddress",[t,s])}class Te extends J{get walletName(){return"Smart Wallet"}constructor(e){if(e.clientId&&typeof e.chain=="object")try{e.chain={...e.chain,rpc:Xt(e.chain,e.clientId)}}catch{}super(Te.id,{...e})}async getConnector(){if(!this.connector){const{SmartWalletConnector:e}=await W(()=>import("./thirdweb-dev-wallets-evm-connectors-smart-wallet.browser.esm-rpvDMaTO.js"),__vite__mapDeps([19,1,2,17,20,5,7,8,3,6]));this.connector=new e(this.options)}return this.connector}getPersonalWallet(){var e;return(e=this.connector)==null?void 0:e.personalWallet}async signMessage(e){const t=await this.getConnector();await t.deployIfNeeded();const s=await this.getSigner(),n=await s.getChainId(),r=await t.getAddress();try{const a=await Qn(s,{name:"Account",version:"1",chainId:n,verifyingContract:r},{AccountMessage:[{name:"message",type:"bytes"}]},{message:Bn.encode(["bytes32"],[Ht(e)])});if(!await Hn(e,a.signature,r,n))throw new Error("Invalid signature");return a.signature}catch{return await this.signMessageLegacy(s,e)}}async signMessageLegacy(e,t){return await e.signMessage(t)}async hasPermissionToExecute(e){return(await this.getConnector()).hasPermissionToExecute(e)}async send(e){return(await this.getConnector()).send(e)}async execute(e){return(await this.getConnector()).execute(e)}async sendBatch(e){return(await this.getConnector()).sendBatch(e)}async executeBatch(e){return(await this.getConnector()).executeBatch(e)}async sendRaw(e){return(await this.getConnector()).sendRaw(e)}async executeRaw(e){return(await this.getConnector()).executeRaw(e)}async estimate(e){return(await this.getConnector()).estimate(e)}async estimateBatch(e){return(await this.getConnector()).estimateBatch(e)}async estimateRaw(e){return(await this.getConnector()).estimateRaw(e)}async estimateBatchRaw(e){return(await this.getConnector()).estimateBatchRaw(e)}async sendBatchRaw(e){return(await this.getConnector()).sendBatchRaw(e)}async executeBatchRaw(e){return(await this.getConnector()).executeBatchRaw(e)}async deploy(){return(await this.getConnector()).deploy()}async deployIfNeeded(){return(await this.getConnector()).deployIfNeeded()}async isDeployed(){return(await this.getConnector()).isDeployed()}async createSessionKey(e,t){return(await this.getConnector()).grantPermissions(e,t)}async revokeSessionKey(e){return(await this.getConnector()).revokePermissions(e)}async addAdmin(e){return(await this.getConnector()).addAdmin(e)}async removeAdmin(e){return(await this.getConnector()).removeAdmin(e)}async getAllActiveSigners(){return(await this.getConnector()).getAllActiveSigners()}async getAccountContract(){return(await this.getConnector()).getAccountContract()}async getFactoryContract(){return(await this.getConnector()).getFactoryContract()}autoConnect(e){return this.connect(e)}}A(Te,"meta",{name:"Smart Wallet",iconURL:"ipfs://QmeAJVqn17aDNQhjEU3kcWVZCFBrfta8LzaDGkS8Egdiyk/smart-wallet.svg"});A(Te,"id",Z.smartWallet);const qd=Ai,Rp="0x5FF137D4b0FDCD49DcA30c7CF57E578a026d2789",Fd="0x02101dfB77FDE026414827Fdc604ddAF224F0921",Op=[{type:"constructor",name:"",inputs:[{type:"address",name:"_entrypoint",internalType:"contract IEntryPoint"},{type:"address",name:"_factory",internalType:"address"}],outputs:[],stateMutability:"nonpayable"},{type:"event",name:"AdminUpdated",inputs:[{type:"address",name:"signer",indexed:!0,internalType:"address"},{type:"bool",name:"isAdmin",indexed:!1,internalType:"bool"}],outputs:[],anonymous:!1},{type:"event",name:"ContractURIUpdated",inputs:[{type:"string",name:"prevURI",indexed:!1,internalType:"string"},{type:"string",name:"newURI",indexed:!1,internalType:"string"}],outputs:[],anonymous:!1},{type:"event",name:"Initialized",inputs:[{type:"uint8",name:"version",indexed:!1,internalType:"uint8"}],outputs:[],anonymous:!1},{type:"event",name:"SignerPermissionsUpdated",inputs:[{type:"address",name:"authorizingSigner",indexed:!0,internalType:"address"},{type:"address",name:"targetSigner",indexed:!0,internalType:"address"},{type:"tuple",name:"permissions",components:[{type:"address",name:"signer",internalType:"address"},{type:"address[]",name:"approvedTargets",internalType:"address[]"},{type:"uint256",name:"nativeTokenLimitPerTransaction",internalType:"uint256"},{type:"uint128",name:"permissionStartTimestamp",internalType:"uint128"},{type:"uint128",name:"permissionEndTimestamp",internalType:"uint128"},{type:"uint128",name:"reqValidityStartTimestamp",internalType:"uint128"},{type:"uint128",name:"reqValidityEndTimestamp",internalType:"uint128"},{type:"bytes32",name:"uid",internalType:"bytes32"}],indexed:!1,internalType:"struct IAccountPermissions.SignerPermissionRequest"}],outputs:[],anonymous:!1},{type:"function",name:"addDeposit",inputs:[],outputs:[],stateMutability:"payable"},{type:"function",name:"contractURI",inputs:[],outputs:[{type:"string",name:"",internalType:"string"}],stateMutability:"view"},{type:"function",name:"entryPoint",inputs:[],outputs:[{type:"address",name:"",internalType:"contract IEntryPoint"}],stateMutability:"view"},{type:"function",name:"execute",inputs:[{type:"address",name:"_target",internalType:"address"},{type:"uint256",name:"_value",internalType:"uint256"},{type:"bytes",name:"_calldata",internalType:"bytes"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"executeBatch",inputs:[{type:"address[]",name:"_target",internalType:"address[]"},{type:"uint256[]",name:"_value",internalType:"uint256[]"},{type:"bytes[]",name:"_calldata",internalType:"bytes[]"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"factory",inputs:[],outputs:[{type:"address",name:"",internalType:"address"}],stateMutability:"view"},{type:"function",name:"getAllActiveSigners",inputs:[],outputs:[{type:"tuple[]",name:"signers",components:[{type:"address",name:"signer",internalType:"address"},{type:"address[]",name:"approvedTargets",internalType:"address[]"},{type:"uint256",name:"nativeTokenLimitPerTransaction",internalType:"uint256"},{type:"uint128",name:"startTimestamp",internalType:"uint128"},{type:"uint128",name:"endTimestamp",internalType:"uint128"}],internalType:"struct IAccountPermissions.SignerPermissions[]"}],stateMutability:"view"},{type:"function",name:"getAllAdmins",inputs:[],outputs:[{type:"address[]",name:"",internalType:"address[]"}],stateMutability:"view"},{type:"function",name:"getAllSigners",inputs:[],outputs:[{type:"tuple[]",name:"signers",components:[{type:"address",name:"signer",internalType:"address"},{type:"address[]",name:"approvedTargets",internalType:"address[]"},{type:"uint256",name:"nativeTokenLimitPerTransaction",internalType:"uint256"},{type:"uint128",name:"startTimestamp",internalType:"uint128"},{type:"uint128",name:"endTimestamp",internalType:"uint128"}],internalType:"struct IAccountPermissions.SignerPermissions[]"}],stateMutability:"view"},{type:"function",name:"getDeposit",inputs:[],outputs:[{type:"uint256",name:"",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"getNonce",inputs:[],outputs:[{type:"uint256",name:"",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"getPermissionsForSigner",inputs:[{type:"address",name:"signer",internalType:"address"}],outputs:[{type:"tuple",name:"",components:[{type:"address",name:"signer",internalType:"address"},{type:"address[]",name:"approvedTargets",internalType:"address[]"},{type:"uint256",name:"nativeTokenLimitPerTransaction",internalType:"uint256"},{type:"uint128",name:"startTimestamp",internalType:"uint128"},{type:"uint128",name:"endTimestamp",internalType:"uint128"}],internalType:"struct IAccountPermissions.SignerPermissions"}],stateMutability:"view"},{type:"function",name:"initialize",inputs:[{type:"address",name:"_defaultAdmin",internalType:"address"},{type:"bytes",name:"",internalType:"bytes"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"isActiveSigner",inputs:[{type:"address",name:"signer",internalType:"address"}],outputs:[{type:"bool",name:"",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"isAdmin",inputs:[{type:"address",name:"_account",internalType:"address"}],outputs:[{type:"bool",name:"",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"isValidSignature",inputs:[{type:"bytes32",name:"_hash",internalType:"bytes32"},{type:"bytes",name:"_signature",internalType:"bytes"}],outputs:[{type:"bytes4",name:"magicValue",internalType:"bytes4"}],stateMutability:"view"},{type:"function",name:"isValidSigner",inputs:[{type:"address",name:"_signer",internalType:"address"},{type:"tuple",name:"_userOp",components:[{type:"address",name:"sender",internalType:"address"},{type:"uint256",name:"nonce",internalType:"uint256"},{type:"bytes",name:"initCode",internalType:"bytes"},{type:"bytes",name:"callData",internalType:"bytes"},{type:"uint256",name:"callGasLimit",internalType:"uint256"},{type:"uint256",name:"verificationGasLimit",internalType:"uint256"},{type:"uint256",name:"preVerificationGas",internalType:"uint256"},{type:"uint256",name:"maxFeePerGas",internalType:"uint256"},{type:"uint256",name:"maxPriorityFeePerGas",internalType:"uint256"},{type:"bytes",name:"paymasterAndData",internalType:"bytes"},{type:"bytes",name:"signature",internalType:"bytes"}],internalType:"struct UserOperation"}],outputs:[{type:"bool",name:"",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"multicall",inputs:[{type:"bytes[]",name:"data",internalType:"bytes[]"}],outputs:[{type:"bytes[]",name:"results",internalType:"bytes[]"}],stateMutability:"nonpayable"},{type:"function",name:"onERC1155BatchReceived",inputs:[{type:"address",name:"",internalType:"address"},{type:"address",name:"",internalType:"address"},{type:"uint256[]",name:"",internalType:"uint256[]"},{type:"uint256[]",name:"",internalType:"uint256[]"},{type:"bytes",name:"",internalType:"bytes"}],outputs:[{type:"bytes4",name:"",internalType:"bytes4"}],stateMutability:"nonpayable"},{type:"function",name:"onERC1155Received",inputs:[{type:"address",name:"",internalType:"address"},{type:"address",name:"",internalType:"address"},{type:"uint256",name:"",internalType:"uint256"},{type:"uint256",name:"",internalType:"uint256"},{type:"bytes",name:"",internalType:"bytes"}],outputs:[{type:"bytes4",name:"",internalType:"bytes4"}],stateMutability:"nonpayable"},{type:"function",name:"onERC721Received",inputs:[{type:"address",name:"",internalType:"address"},{type:"address",name:"",internalType:"address"},{type:"uint256",name:"",internalType:"uint256"},{type:"bytes",name:"",internalType:"bytes"}],outputs:[{type:"bytes4",name:"",internalType:"bytes4"}],stateMutability:"nonpayable"},{type:"function",name:"setAdmin",inputs:[{type:"address",name:"_account",internalType:"address"},{type:"bool",name:"_isAdmin",internalType:"bool"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setContractURI",inputs:[{type:"string",name:"_uri",internalType:"string"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"setPermissionsForSigner",inputs:[{type:"tuple",name:"_req",components:[{type:"address",name:"signer",internalType:"address"},{type:"address[]",name:"approvedTargets",internalType:"address[]"},{type:"uint256",name:"nativeTokenLimitPerTransaction",internalType:"uint256"},{type:"uint128",name:"permissionStartTimestamp",internalType:"uint128"},{type:"uint128",name:"permissionEndTimestamp",internalType:"uint128"},{type:"uint128",name:"reqValidityStartTimestamp",internalType:"uint128"},{type:"uint128",name:"reqValidityEndTimestamp",internalType:"uint128"},{type:"bytes32",name:"uid",internalType:"bytes32"}],internalType:"struct IAccountPermissions.SignerPermissionRequest"},{type:"bytes",name:"_signature",internalType:"bytes"}],outputs:[],stateMutability:"nonpayable"},{type:"function",name:"supportsInterface",inputs:[{type:"bytes4",name:"interfaceId",internalType:"bytes4"}],outputs:[{type:"bool",name:"",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"validateUserOp",inputs:[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender",internalType:"address"},{type:"uint256",name:"nonce",internalType:"uint256"},{type:"bytes",name:"initCode",internalType:"bytes"},{type:"bytes",name:"callData",internalType:"bytes"},{type:"uint256",name:"callGasLimit",internalType:"uint256"},{type:"uint256",name:"verificationGasLimit",internalType:"uint256"},{type:"uint256",name:"preVerificationGas",internalType:"uint256"},{type:"uint256",name:"maxFeePerGas",internalType:"uint256"},{type:"uint256",name:"maxPriorityFeePerGas",internalType:"uint256"},{type:"bytes",name:"paymasterAndData",internalType:"bytes"},{type:"bytes",name:"signature",internalType:"bytes"}],internalType:"struct UserOperation"},{type:"bytes32",name:"userOpHash",internalType:"bytes32"},{type:"uint256",name:"missingAccountFunds",internalType:"uint256"}],outputs:[{type:"uint256",name:"validationData",internalType:"uint256"}],stateMutability:"nonpayable"},{type:"function",name:"verifySignerPermissionRequest",inputs:[{type:"tuple",name:"req",components:[{type:"address",name:"signer",internalType:"address"},{type:"address[]",name:"approvedTargets",internalType:"address[]"},{type:"uint256",name:"nativeTokenLimitPerTransaction",internalType:"uint256"},{type:"uint128",name:"permissionStartTimestamp",internalType:"uint128"},{type:"uint128",name:"permissionEndTimestamp",internalType:"uint128"},{type:"uint128",name:"reqValidityStartTimestamp",internalType:"uint128"},{type:"uint128",name:"reqValidityEndTimestamp",internalType:"uint128"},{type:"bytes32",name:"uid",internalType:"bytes32"}],internalType:"struct IAccountPermissions.SignerPermissionRequest"},{type:"bytes",name:"signature",internalType:"bytes"}],outputs:[{type:"bool",name:"success",internalType:"bool"},{type:"address",name:"signer",internalType:"address"}],stateMutability:"view"},{type:"function",name:"withdrawDepositTo",inputs:[{type:"address",name:"withdrawAddress",internalType:"address payable"},{type:"uint256",name:"amount",internalType:"uint256"}],outputs:[],stateMutability:"nonpayable"},{type:"receive",name:"",inputs:[],outputs:[],stateMutability:"payable"}];class us extends Te{get walletName(){return"Token Bound Smart Wallet"}constructor(e){super({...e,factoryAddress:e.registryAddress||Fd}),this.tbaOptions=e}async getConnector(){if(!this.tbaConnector){const{TokenBoundSmartWalletConnector:e}=await W(()=>import("./thirdweb-dev-wallets-evm-connectors-token-bound-smart-wallet.browser.esm-9bUqYl9Z.js"),__vite__mapDeps([21,19,1,2,17,20,5,7,8,3,6]));this.tbaConnector=new e(this.tbaOptions)}return this.tbaConnector}}A(us,"meta",{name:"Token Bound Smart Wallet",iconURL:"ipfs://QmeAJVqn17aDNQhjEU3kcWVZCFBrfta8LzaDGkS8Egdiyk/smart-wallet.svg"});A(us,"id",Z.tokenBoundSmartWallet);const jd="/sdk/2022-08-12/embedded-wallet",at=()=>`${Nd().replace("withpaper.com","embedded-wallet.thirdweb.com")}`,kd=i=>`thirdwebEwsWalletUserDetails-${i}`,et=i=>`thirdwebEwsWalletUserId-${i}`,zd="walletToken",tt=i=>`${zd}-${i}`,Mn="a",st=(i,e)=>`${Mn}-${i}-${e}`,Vd=i=>`${Mn}-${i}`;let Wd=function(i){return i.USER_MANAGED="USER_MANAGED",i.CLOUD_MANAGED="AWS_MANAGED",i}({}),Ln=function(i){return i.COGNITO="Cognito",i.GOOGLE="Google",i.EMAIL_OTP="EmailOtp",i.CUSTOM_JWT="CustomJWT",i.FACEBOOK="Facebook",i.APPLE="Apple",i}({}),he=function(i){return i.LOGGED_OUT="Logged Out",i.LOGGED_IN_WALLET_UNINITIALIZED="Logged In, Wallet Uninitialized",i.LOGGED_IN_NEW_DEVICE="Logged In, New Device",i.LOGGED_IN_WALLET_INITIALIZED="Logged In, Wallet Initialized",i}({});const _i=new Map;let ds=class{constructor(e){let{clientId:t}=e;this.isSupported=!!window.localStorage,this.clientId=t}async getItem(e){return this.isSupported?window.localStorage.getItem(e):_i.get(e)??null}async setItem(e,t){if(this.isSupported)return window.localStorage.setItem(e,t);_i.set(e,t)}async removeItem(e){const t=await this.getItem(e);return this.isSupported&&t?(window.localStorage.removeItem(e),!0):!1}async saveAuthCookie(e){await this.setItem(tt(this.clientId),e)}async getAuthCookie(){return this.getItem(tt(this.clientId))}async removeAuthCookie(){return this.removeItem(tt(this.clientId))}async saveDeviceShare(e,t){await this.saveWalletUserId(t),await this.setItem(st(this.clientId,t),e)}async getDeviceShare(){const e=await this.getWalletUserId();return e?this.getItem(st(this.clientId,e)):null}async removeDeviceShare(){const e=await this.getWalletUserId();return e?this.removeItem(st(this.clientId,e)):!1}async getWalletUserId(){return this.getItem(et(this.clientId))}async saveWalletUserId(e){await this.setItem(et(this.clientId),e)}async removeWalletUserId(){return this.removeItem(et(this.clientId))}};function Mt(i){return new Promise(e=>{setTimeout(e,i*1e3)})}const Kd={height:"100%",width:"100%",border:"none",backgroundColor:"transparent",colorScheme:"light",position:"fixed",top:"0px",right:"0px",zIndex:"2147483646",display:"none"},Lt=new Map;class Gd{constructor(e){let{link:t,iframeId:s,container:n=document.body,iframeStyles:r,onIframeInitialize:a}=e;A(this,"POLLING_INTERVAL_SECONDS",1.4),this.iframeBaseUrl=at();let o=document.getElementById(s);const c=new URL(t),l="2.1.7";if(c.searchParams.set("sdkVersion",l),!o||o.src!==c.href){if(!o){o=document.createElement("iframe");const u={...Kd,...r};Object.assign(o.style,u),o.setAttribute("id",s),o.setAttribute("fetchpriority","high"),n.appendChild(o)}o.src=c.href,o.setAttribute("data-version",l);const h=u=>{if(u.data.eventType==="ewsIframeLoaded"){if(window.removeEventListener("message",h),!o){console.warn("thirdweb Iframe not found");return}this.onIframeLoadHandler(o,a)()}};window.addEventListener("message",h)}this.iframe=o}async onIframeLoadedInitVariables(){return{}}onIframeLoadHandler(e,t){return async()=>{await new Promise(async(n,r)=>{var c;const a=new MessageChannel;a.port1.onmessage=l=>{const{data:h}=l;return a.port1.close(),h.success?(Lt.set(e.src,!0),t&&t(),n(!0)):r(new Error(h.error))};const o="initIframe";(c=e==null?void 0:e.contentWindow)==null||c.postMessage({eventType:o,data:await this.onIframeLoadedInitVariables()},this.iframeBaseUrl,[a.port2])})}}async call(e){let{procedureName:t,params:s,showIframe:n=!1}=e;for(;!Lt.get(this.iframe.src);)await Mt(this.POLLING_INTERVAL_SECONDS);return n&&(this.iframe.style.display="block",await Mt(.005)),new Promise((a,o)=>{var l;const c=new MessageChannel;c.port1.onmessage=async h=>{const{data:u}=h;c.port1.close(),n&&(await Mt(.1),this.iframe.style.display="none"),u.success?a(u.data):o(new Error(u.error))},(l=this.iframe.contentWindow)==null||l.postMessage({eventType:t,data:s},this.iframeBaseUrl,[c.port2])})}destroy(){Lt.delete(this.iframe.src)}}class Bd extends Gd{constructor(e){let{clientId:t,customizationOptions:s}=e;super({iframeId:Hd,link:Qd({clientId:t,path:jd,queryParams:s}).href,container:document.body}),this.clientId=t}async onIframeLoadedInitVariables(){const e=new ds({clientId:this.clientId});return{authCookie:await e.getAuthCookie(),deviceShareStored:await e.getDeviceShare(),walletUserId:await e.getWalletUserId(),clientId:this.clientId}}}function Qd(i){var r;let{clientId:e,path:t,queryParams:s}=i;const n=new URL(`${t}`,at());if(s)for(const a of Object.keys(s))n.searchParams.set(a,((r=s[a])==null?void 0:r.toString())||"");return n.searchParams.set("clientId",e),n}const Hd="thirdweb-embedded-wallet-iframe";class Yd{constructor(e){let{querier:t,preLogin:s,postLogin:n,clientId:r}=e;this.LoginQuerier=t,this.preLogin=s,this.postLogin=n,this.clientId=r}async sendEmailLoginOtp(e){let{email:t}=e;return await this.preLogin(),await this.LoginQuerier.call({procedureName:"sendThirdwebEmailLoginOtp",params:{email:t}})}}class Jd extends Yd{constructor(){super(...arguments),A(this,"closeWindow",e=>{let{isWindowOpenedByFn:t,win:s,closeOpenedWindow:n}=e;t?s==null||s.close():s&&n?n(s):s&&s.close()})}async getOauthLoginUrl(e){return await this.LoginQuerier.call({procedureName:"getHeadlessOauthLoginLink",params:{authProvider:e}})}async loginWithModal(){await this.preLogin();const e=await this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:void 0,showIframe:!0});return this.postLogin(e)}async loginWithEmailOtp(e){let{email:t}=e;await this.preLogin();const s=await this.LoginQuerier.call({procedureName:"loginWithThirdwebModal",params:{email:t},showIframe:!0});return this.postLogin(s)}getOauthPopUpSizing(e){switch(e){case Ln.FACEBOOK:return"width=715, height=555";default:return"width=350, height=500"}}async loginWithOauth(e){let t=e==null?void 0:e.openedWindow,s=!1;if(t||(t=window.open("","Login",this.getOauthPopUpSizing(e.oauthProvider)),s=!0),!t)throw new Error("Something went wrong opening pop-up");const[{loginLink:n}]=await Promise.all([this.getOauthLoginUrl(e.oauthProvider),this.preLogin()]);t.location.href=n;const r=await new Promise((a,o)=>{const c=window.setInterval(async()=>{t&&t.closed&&(clearInterval(c),window.removeEventListener("message",l),o(new Error("User closed login window")))},1e3),l=async h=>{if(h.origin===at()){if(typeof h.data!="object"){o(new Error("Invalid event data"));return}switch(h.data.eventType){case"userLoginSuccess":{window.removeEventListener("message",l),clearInterval(c),this.closeWindow({isWindowOpenedByFn:s,win:t,closeOpenedWindow:e==null?void 0:e.closeOpenedWindow}),h.data.authResult&&a(h.data.authResult);break}case"userLoginFailed":{window.removeEventListener("message",l),clearInterval(c),this.closeWindow({isWindowOpenedByFn:s,win:t,closeOpenedWindow:e==null?void 0:e.closeOpenedWindow}),o(new Error(h.data.error));break}case"injectDeveloperClientId":{t==null||t.postMessage({eventType:"injectDeveloperClientIdResult",developerClientId:this.clientId,authOption:e.oauthProvider},at());break}}}};window.addEventListener("message",l)});return this.postLogin({storedToken:{...r.storedToken,shouldStoreCookieString:!0},walletDetails:{...r.walletDetails,isIframeStorageEnabled:!1}})}async loginWithCustomJwt(e){let{encryptionKey:t,jwt:s}=e;const n=await this.LoginQuerier.call({procedureName:"loginWithCustomJwt",params:{encryptionKey:t,jwt:s}});return this.postLogin(n)}async verifyEmailLoginOtp(e){let{email:t,otp:s,recoveryCode:n}=e;const r=await this.LoginQuerier.call({procedureName:"verifyThirdwebEmailLoginOtp",params:{email:t,otp:s,recoveryCode:n}});return this.postLogin(r)}}class Zd{constructor(e){let{clientId:t,querier:s,onAuthSuccess:n}=e;this.clientId=t,this.AuthQuerier=s,this.localStorage=new ds({clientId:t}),this.onAuthSuccess=n,this.BaseLogin=new Jd({postLogin:async r=>this.postLogin(r),preLogin:async()=>{await this.preLogin()},querier:s,clientId:t})}async preLogin(){await this.logout()}async postLogin(e){let{storedToken:t,walletDetails:s}=e;return t.shouldStoreCookieString&&await this.localStorage.saveAuthCookie(t.cookieString),await this.onAuthSuccess({storedToken:t,walletDetails:s})}async loginWithModal(){return await this.preLogin(),this.BaseLogin.loginWithModal()}async loginWithEmailOtp(e){return this.BaseLogin.loginWithEmailOtp(e)}async loginWithCustomJwt(e){return this.BaseLogin.loginWithCustomJwt(e)}async loginWithOauth(e){return this.BaseLogin.loginWithOauth(e)}async sendEmailLoginOtp(e){let{email:t}=e;return this.BaseLogin.sendEmailLoginOtp({email:t})}async verifyEmailLoginOtp(e){return this.BaseLogin.verifyEmailLoginOtp(e)}async logout(){const{success:e}=await this.AuthQuerier.call({procedureName:"logout",params:void 0}),t=await this.localStorage.removeAuthCookie(),s=await this.localStorage.removeWalletUserId();return{success:e||t||s}}}class ps extends Ci{constructor(e){var r;let{provider:t,clientId:s,querier:n}=e;super(),A(this,"DEFAULT_ETHEREUM_CHAIN_ID",5),this.clientId=s,this.querier=n,this.endpoint=(r=t.connection)==null?void 0:r.url,Zn.defineReadOnly(this,"provider",t)}async getAddress(){const{address:e}=await this.querier.call({procedureName:"getAddress",params:void 0});return e}async signMessage(e){var s,n;const{signedMessage:t}=await this.querier.call({procedureName:"signMessage",params:{message:e,chainId:((n=await((s=this.provider)==null?void 0:s.getNetwork()))==null?void 0:n.chainId)??this.DEFAULT_ETHEREUM_CHAIN_ID,rpcEndpoint:this.endpoint}});return t}async signTransaction(e){var s,n;const{signedTransaction:t}=await this.querier.call({procedureName:"signTransaction",params:{transaction:e,chainId:((n=await((s=this.provider)==null?void 0:s.getNetwork()))==null?void 0:n.chainId)??this.DEFAULT_ETHEREUM_CHAIN_ID,rpcEndpoint:this.endpoint}});return t}async _signTypedData(e,t,s){var r,a;const{signedTypedData:n}=await this.querier.call({procedureName:"signTypedDataV4",params:{domain:e,types:t,message:s,chainId:((a=await((r=this.provider)==null?void 0:r.getNetwork()))==null?void 0:a.chainId)??this.DEFAULT_ETHEREUM_CHAIN_ID,rpcEndpoint:this.endpoint}});return n}connect(e){return new ps({clientId:this.clientId,provider:e,querier:this.querier})}}class Xd{constructor(e){let{clientId:t,chain:s,querier:n}=e;this.clientId=t,this.chain=s,this.walletManagerQuerier=n,this.localStorage=new ds({clientId:t})}async postWalletSetUp(e){let{deviceShareStored:t,walletAddress:s,isIframeStorageEnabled:n,walletUserId:r}=e;return n||await this.localStorage.saveDeviceShare(t,r),{walletAddress:s}}async getUserWalletStatus(){const e=await this.walletManagerQuerier.call({procedureName:"getUserStatus",params:void 0});return e.status===he.LOGGED_IN_WALLET_INITIALIZED?{status:he.LOGGED_IN_WALLET_INITIALIZED,...e.user,wallet:this}:e.status===he.LOGGED_IN_NEW_DEVICE?{status:he.LOGGED_IN_WALLET_UNINITIALIZED,...e.user}:e.status===he.LOGGED_IN_WALLET_UNINITIALIZED?{status:he.LOGGED_IN_WALLET_UNINITIALIZED,...e.user}:{status:e.status}}async setChain(e){let{chain:t}=e;this.chain=t}async getEthersJsSigner(e){return new ps({clientId:this.clientId,provider:Jn((e==null?void 0:e.rpcEndpoint)??Pd[this.chain]),querier:this.walletManagerQuerier})}}class ep{isClientIdLegacyPaper(e){return e.indexOf("-")>0&&e.length===36}constructor(e){let{clientId:t,chain:s,styles:n,onAuthSuccess:r}=e;if(this.isClientIdLegacyPaper(t))throw new Error("You are using a legacy clientId. Please use the clientId found on the thirdweb dashboard settings page");this.clientId=t,this.querier=new Bd({clientId:t,customizationOptions:n}),this.wallet=new Xd({clientId:t,chain:s,querier:this.querier}),this.auth=new Zd({clientId:t,querier:this.querier,onAuthSuccess:async a=>(r==null||r(a),await this.wallet.postWalletSetUp({...a.walletDetails,walletUserId:a.storedToken.authDetails.userWalletId}),await this.querier.call({procedureName:"initIframe",params:{deviceShareStored:a.walletDetails.deviceShareStored,clientId:this.clientId,walletUserId:a.storedToken.authDetails.userWalletId,authCookie:a.storedToken.cookieString}}),{user:{status:he.LOGGED_IN_WALLET_INITIALIZED,authDetails:a.storedToken.authDetails,wallet:this.wallet,walletAddress:a.walletDetails.walletAddress}})})}async getUser(){return this.wallet.getUserWalletStatus()}}const $t="__TW__";class $n{constructor(e){this.name=e}getItem(e){return localStorage.getItem(`${$t}/${this.name}/${e}`)}setItem(e,t){return localStorage.setItem(`${$t}/${this.name}/${e}`,t)}removeItem(e){return localStorage.removeItem(`${$t}/${this.name}/${e}`)}}function tp(i){return new $n(i)}class sp{async getItem(){const e=await navigator.credentials.get({password:!0,unmediated:!0});return e&&"password"in e?e.password:null}async setItem(e,t){const s=await navigator.credentials.create({password:{id:e,name:e,password:t}});if(!s)throw new Error("Credential not created");await navigator.credentials.store(s)}async removeItem(){await navigator.credentials.get({password:!0,unmediated:!0})&&await navigator.credentials.preventSilentAccess()}}class Dn extends Xn{constructor(e){super(),this.wallet=e}}var Dt=new WeakMap,R=new WeakMap,H=new WeakMap,Ut=new WeakMap,de=new WeakMap,pe=new WeakMap,Ti=new WeakSet,Pi=new WeakSet;class ip extends Dn{constructor(e,t){super(t),fs(this,Pi),fs(this,Ti),re(this,Dt,{writable:!0,value:void 0}),re(this,R,{writable:!0,value:void 0}),re(this,H,{writable:!0,value:void 0}),re(this,Ut,{writable:!0,value:void 0}),re(this,de,{writable:!0,value:void 0}),re(this,pe,{writable:!0,value:void 0});const s={walletConnectWalletMetadata:{name:"Thirdweb Smart Wallet",description:"Thirdweb Smart Wallet",url:"https://thirdweb.com",icons:["https://thirdweb.com/favicon.ico"]},walletConnectV2ProjectId:Jt,walletConnectV2RelayUrl:er,...(e==null?void 0:e.walletConnectReceiver)===!0?{}:e==null?void 0:e.walletConnectReceiver};z(this,Ut,s.walletConnectWalletMetadata),z(this,Dt,new Ni({projectId:s.walletConnectV2ProjectId,relayUrl:s.walletConnectV2RelayUrl}))}async init(){z(this,R,await Td.init({core:f(this,Dt),metadata:f(this,Ut)}));const e=f(this,R).getActiveSessions(),t=Object.keys(e);t[0]&&z(this,H,e[t[0]]),ws(this,Ti,np).call(this)}async connectApp(e){if(!f(this,R))throw new Error("Please, init the wallet before connecting an app.");await f(this,R).core.pairing.pair({uri:e})}async approveSession(){var o;if(!f(this,R))throw new Error("Please, init the wallet before making session requests.");if(!f(this,de))throw new Error("Please, pass a valid proposal.");const e=await this.wallet.getAddress(),{id:t,params:s}=f(this,de),{requiredNamespaces:n,relays:r}=s,a={};Object.keys(n).forEach(c=>{var u;const l=[],h=n[c];h&&((u=h.chains)==null||u.map(g=>{l.push(`${g}:${e}`)}),a[c]={accounts:l,methods:h.methods,events:h.events})}),z(this,H,await f(this,R).approveSession({id:t,relayProtocol:(o=r[0])==null?void 0:o.protocol,namespaces:a})),this.emit("session_approved")}async rejectSession(){if(!f(this,R))throw new Error("Please, init the wallet before making session requests.");if(!f(this,de))throw new Error("Please, pass a valid proposal.");const{id:e}=f(this,de);await f(this,R).rejectSession({id:e,reason:{message:"User rejected methods.",code:5002}})}async approveEIP155Request(){var a,o;if(!f(this,pe))return;const{topic:e,params:t,id:s}=f(this,pe),{request:n}=t;let r;switch(n.method){case ae.PERSONAL_SIGN:case ae.ETH_SIGN:const c=ws(this,Pi,rp).call(this,n.params),l=await this.wallet.signMessage(c||"");r=ye(s,l);break;case ae.ETH_SEND_TRANSACTION:const h=await this.wallet.getSigner(),u=n.params[0],g=await h.sendTransaction(u),{transactionHash:S}=await g.wait();r=ye(s,S);break;case ae.ETH_SIGN_TRANSACTION:const d=await this.wallet.getSigner(),m=n.params[0],T=await d.signTransaction(m);r=ye(s,T);break;default:const v={id:s,jsonrpc:"2.0",error:{message:"Invalid event.",code:1002}};return(a=f(this,R))==null?void 0:a.respondSessionRequest({topic:e,response:v})}return(o=f(this,R))==null?void 0:o.respondSessionRequest({topic:e,response:r})}async rejectEIP155Request(){var n;if(!f(this,pe))return;const{topic:e,id:t}=f(this,pe),s={id:t,jsonrpc:"2.0",error:{message:"User rejected methods.",code:5002}};return(n=f(this,R))==null?void 0:n.respondSessionRequest({topic:e,response:s})}getActiveSessions(){if(!f(this,R))throw new Error("Please, init the wallet before getting sessions.");const e=f(this,R).getActiveSessions(),t=Object.keys(e);if(!e||t.length===0)return[];const s=[];for(const n of t){const r=e[n];if(r){const a=r.topic,o=r.peer.metadata;s.push({topic:a,peer:{metadata:o}})}}return s}disconnectSession(){var t;if(!f(this,R))throw new Error("Please, init the wallet before disconnecting sessions.");if(!f(this,H))return Promise.resolve();const e={topic:f(this,H).topic,reason:{message:"User disconnected.",code:6e3}};return(t=f(this,R))==null?void 0:t.disconnectSession(e)}}function np(){if(!f(this,R))throw new Error("Please, init the wallet before making session requests.");f(this,R).on("session_proposal",i=>{z(this,de,i),this.emit("session_proposal",{proposer:{metadata:i.params.proposer.metadata}})}),f(this,R).on("session_delete",i=>{z(this,H,void 0),z(this,de,void 0),this.emit("session_delete",{topic:i.topic})}),f(this,R).on("session_request",async i=>{if(!f(this,H))return;const{params:e}=i,{request:t}=e,{params:s}=t;switch(t.method){case ae.ETH_SIGN:case ae.PERSONAL_SIGN:z(this,pe,i);const n=s[0],r=new TextDecoder().decode(tr(n)),a=[...s];a[0]=r,this.emit("session_request",{topic:f(this,H).topic,params:a,peer:{metadata:f(this,H).peer.metadata},method:t.method});return;case ae.ETH_SEND_TRANSACTION:case ae.ETH_SIGN_TRANSACTION:z(this,pe,i),this.emit("session_request",{topic:f(this,H).topic,params:i.params.request.params,peer:{metadata:f(this,H).peer.metadata},method:t.method});return;default:throw new Error(`WCV2.Method not supported: ${t.method}`)}})}function rp(i){const e=i.filter(t=>!sr(t))[0]||"";return ir(e)?nr(e):e}const Mp=Object.freeze(Object.defineProperty({__proto__:null,AUTH_TOKEN_LOCAL_STORAGE_NAME:tt,AbstractClientWallet:J,AddChainError:Gr,AsyncLocalStorage:rr,AuthProvider:Ln,BloctoWallet:Ve,ChainNotConfiguredError:Br,CoinbaseWallet:yr,Connector:hr,CoreWallet:yt,CredentialsStorage:sp,DEFAULT_DAPP_META:ar,DEVICE_SHARE_LOCAL_STORAGE_NAME:st,DEVICE_SHARE_LOCAL_STORAGE_NAME_DEPRECATED:Vd,EIP155_SIGNING_METHODS:ae,EmbeddedWallet:hs,EmbeddedWalletSdk:ep,EngineSigner:mt,EngineWallet:Rd,EthersWallet:Od,FrameWallet:ft,InjectedWallet:wt,LocalStorage:$n,LocalWallet:mr,MagicLink:We,MetaMaskWallet:br,OKXWallet:gt,PaperWallet:ze,PhantomWallet:vr,PrivateKeyWallet:xd,ProviderRpcError:Qr,RainbowWallet:Er,RecoveryShareManagement:Wd,SafeSupportedChainsSet:Ld,SafeWallet:Ke,SignerWallet:wr,SmartWallet:Te,SwitchChainError:Hr,TokenBoundSmartWallet:us,TrustWallet:Ir,UserRejectedRequestError:Yr,UserWalletStatus:he,WALLET_USER_DETAILS_LOCAL_STORAGE_NAME:kd,WALLET_USER_ID_LOCAL_STORAGE_NAME:et,WagmiAdapter:oe,WagmiConnector:Kr,WalletConnect:Ai,WalletConnectHandler:Dn,WalletConnectV1:qd,WalletConnectV2Handler:ip,ZerionWallet:Sr,assertWindowEthereum:Yt,createAsyncLocalStorage:or,createLocalStorage:tp,getAllSigners:$d,getAllSmartWallets:Dd,getInjectedCoinbaseProvider:gr,getInjectedCoreWalletProvider:On,getInjectedMetamaskProvider:ur,getInjectedOKXProvider:Rn,getInjectedPhantomProvider:dr,getInjectedRainbowProvider:pr,getSmartWalletAddress:xn,isSmartWalletDeployed:Ud,isValidPrivateKey:fr,isWalletAnalyticsEnabled:cr,normalizeChainId:Jr,setWalletAnalyticsEnabled:lr,walletIds:Z},Symbol.toStringTag,{value:"Module"}));export{Ln as A,Md as C,ep as E,he as U,On as a,Rp as b,Op as c,Fd as d,Pd as e,Rn as g,Nd as i,Mp as t};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/thirdweb-dev-wallets-evm-connectors-okx.browser.esm-UL6b3woO.js","assets/index-OE56k1X-.js","assets/index-Zpn9ZsWz.css","assets/errors-3055a99c.browser.esm-nv5LXain.js","assets/thirdweb-dev-wallets-evm-connectors-injected.browser.esm-yG-y9jf8.js","assets/url-bc88b2b6.browser.esm-bQ071zCC.js","assets/normalizeChainId-e4cc0175.browser.esm-3qrEAm98.js","assets/index.es-c5c7QnKt.js","assets/tslib.es6-GVow8CXj.js","assets/thirdweb-dev-wallets-evm-connectors-wallet-connect.browser.esm-bOO3calr.js","assets/thirdweb-dev-wallets-evm-connectors-core-wallet.browser.esm-UtegL-Nh.js","assets/thirdweb-dev-wallets-evm-connectors-paper.browser.esm-zA63Tt_l.js","assets/thirdweb-dev-wallets-evm-connectors-blocto.browser.esm-jsRgAUhv.js","assets/thirdweb-dev-wallets-evm-connectors-embedded-wallet.browser.esm-QHTKDgtu.js","assets/thirdweb-dev-wallets-evm-connectors-frame.browser.esm-lIBX0_XT.js","assets/thirdweb-dev-wallets-evm-connectors-magic.browser.esm-_X3bHoF0.js","assets/thirdweb-dev-wallets-evm-connectors-safe.browser.esm-TOSJqRN2.js","assets/index-Rk3_rD1A.js","assets/index-inV18KQJ.js","assets/thirdweb-dev-wallets-evm-connectors-smart-wallet.browser.esm-rpvDMaTO.js","assets/browser-7ACNNLw6.js","assets/thirdweb-dev-wallets-evm-connectors-token-bound-smart-wallet.browser.esm-9bUqYl9Z.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}