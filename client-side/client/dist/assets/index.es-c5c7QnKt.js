import{t as no,e as Nt,$ as so}from"./tslib.es6-GVow8CXj.js";import{g as ls,aX as ao,f as nt,t as tt,c as di,d as oo,aY as vt,a as co}from"./index-OE56k1X-.js";const ho=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,fo=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,uo=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function lo(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){go(t);return}return e}function go(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function Tr(t,e={}){if(typeof t!="string")return t;const r=t.trim();if(t[0]==='"'&&t.at(-1)==='"'&&!t.includes("\\"))return r.slice(1,-1);if(r.length<=9){const i=r.toLowerCase();if(i==="true")return!0;if(i==="false")return!1;if(i==="undefined")return;if(i==="null")return null;if(i==="nan")return Number.NaN;if(i==="infinity")return Number.POSITIVE_INFINITY;if(i==="-infinity")return Number.NEGATIVE_INFINITY}if(!uo.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(ho.test(t)||fo.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,lo)}return JSON.parse(t)}catch(i){if(e.strict)throw i;return t}}function po(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function Ve(t,...e){try{return po(t(...e))}catch(r){return Promise.reject(r)}}function yo(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function bo(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Ar(t){if(yo(t))return String(t);if(bo(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Ar(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function ds(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const gi="base64:";function mo(t){if(typeof t=="string")return t;ds();const e=Buffer.from(t).toString("base64");return gi+e}function _o(t){return typeof t!="string"||!t.startsWith(gi)?t:(ds(),Buffer.from(t.slice(gi.length),"base64"))}function rt(t){return t?t.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function vo(...t){return rt(t.join(":"))}function Nr(t){return t=rt(t),t?t+":":""}const wo="memory",Eo=()=>{const t=new Map;return{name:wo,options:{},hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return Array.from(t.keys())},clear(){t.clear()},dispose(){t.clear()}}};function xo(t={}){const e={mounts:{"":t.driver||Eo()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=h=>{for(const g of e.mountpoints)if(h.startsWith(g))return{base:g,relativeKey:h.slice(g.length),driver:e.mounts[g]};return{base:"",relativeKey:h,driver:e.mounts[""]}},i=(h,g)=>e.mountpoints.filter(y=>y.startsWith(h)||g&&h.startsWith(y)).map(y=>({relativeBase:h.length>y.length?h.slice(y.length):void 0,mountpoint:y,driver:e.mounts[y]})),s=(h,g)=>{if(e.watching){g=rt(g);for(const y of e.watchListeners)y(h,g)}},c=async()=>{if(!e.watching){e.watching=!0;for(const h in e.mounts)e.unwatch[h]=await Zi(e.mounts[h],s,h)}},p=async()=>{if(e.watching){for(const h in e.unwatch)await e.unwatch[h]();e.unwatch={},e.watching=!1}},o=(h,g,y)=>{const w=new Map,v=O=>{let R=w.get(O.base);return R||(R={driver:O.driver,base:O.base,items:[]},w.set(O.base,R)),R};for(const O of h){const R=typeof O=="string",C=rt(R?O:O.key),q=R?void 0:O.value,E=R||!O.options?g:{...g,...O.options},P=r(C);v(P).items.push({key:C,value:q,relativeKey:P.relativeKey,options:E})}return Promise.all([...w.values()].map(O=>y(O))).then(O=>O.flat())},l={hasItem(h,g={}){h=rt(h);const{relativeKey:y,driver:w}=r(h);return Ve(w.hasItem,y,g)},getItem(h,g={}){h=rt(h);const{relativeKey:y,driver:w}=r(h);return Ve(w.getItem,y,g).then(v=>Tr(v))},getItems(h,g){return o(h,g,y=>y.driver.getItems?Ve(y.driver.getItems,y.items.map(w=>({key:w.relativeKey,options:w.options})),g).then(w=>w.map(v=>({key:vo(y.base,v.key),value:Tr(v.value)}))):Promise.all(y.items.map(w=>Ve(y.driver.getItem,w.relativeKey,w.options).then(v=>({key:w.key,value:Tr(v)})))))},getItemRaw(h,g={}){h=rt(h);const{relativeKey:y,driver:w}=r(h);return w.getItemRaw?Ve(w.getItemRaw,y,g):Ve(w.getItem,y,g).then(v=>_o(v))},async setItem(h,g,y={}){if(g===void 0)return l.removeItem(h);h=rt(h);const{relativeKey:w,driver:v}=r(h);v.setItem&&(await Ve(v.setItem,w,Ar(g),y),v.watch||s("update",h))},async setItems(h,g){await o(h,g,async y=>{y.driver.setItems&&await Ve(y.driver.setItems,y.items.map(w=>({key:w.relativeKey,value:Ar(w.value),options:w.options})),g),y.driver.setItem&&await Promise.all(y.items.map(w=>Ve(y.driver.setItem,w.relativeKey,Ar(w.value),w.options)))})},async setItemRaw(h,g,y={}){if(g===void 0)return l.removeItem(h,y);h=rt(h);const{relativeKey:w,driver:v}=r(h);if(v.setItemRaw)await Ve(v.setItemRaw,w,g,y);else if(v.setItem)await Ve(v.setItem,w,mo(g),y);else return;v.watch||s("update",h)},async removeItem(h,g={}){typeof g=="boolean"&&(g={removeMeta:g}),h=rt(h);const{relativeKey:y,driver:w}=r(h);w.removeItem&&(await Ve(w.removeItem,y,g),(g.removeMeta||g.removeMata)&&await Ve(w.removeItem,y+"$",g),w.watch||s("remove",h))},async getMeta(h,g={}){typeof g=="boolean"&&(g={nativeOnly:g}),h=rt(h);const{relativeKey:y,driver:w}=r(h),v=Object.create(null);if(w.getMeta&&Object.assign(v,await Ve(w.getMeta,y,g)),!g.nativeOnly){const O=await Ve(w.getItem,y+"$",g).then(R=>Tr(R));O&&typeof O=="object"&&(typeof O.atime=="string"&&(O.atime=new Date(O.atime)),typeof O.mtime=="string"&&(O.mtime=new Date(O.mtime)),Object.assign(v,O))}return v},setMeta(h,g,y={}){return this.setItem(h+"$",g,y)},removeMeta(h,g={}){return this.removeItem(h+"$",g)},async getKeys(h,g={}){h=Nr(h);const y=i(h,!0);let w=[];const v=[];for(const O of y){const C=(await Ve(O.driver.getKeys,O.relativeBase,g)).map(q=>O.mountpoint+rt(q)).filter(q=>!w.some(E=>q.startsWith(E)));v.push(...C),w=[O.mountpoint,...w.filter(q=>!q.startsWith(O.mountpoint))]}return h?v.filter(O=>O.startsWith(h)&&!O.endsWith("$")):v.filter(O=>!O.endsWith("$"))},async clear(h,g={}){h=Nr(h),await Promise.all(i(h,!1).map(async y=>{if(y.driver.clear)return Ve(y.driver.clear,y.relativeBase,g);if(y.driver.removeItem){const w=await y.driver.getKeys(y.relativeBase||"",g);return Promise.all(w.map(v=>y.driver.removeItem(v,g)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(h=>en(h)))},async watch(h){return await c(),e.watchListeners.push(h),async()=>{e.watchListeners=e.watchListeners.filter(g=>g!==h),e.watchListeners.length===0&&await p()}},async unwatch(){e.watchListeners=[],await p()},mount(h,g){if(h=Nr(h),h&&e.mounts[h])throw new Error(`already mounted at ${h}`);return h&&(e.mountpoints.push(h),e.mountpoints.sort((y,w)=>w.length-y.length)),e.mounts[h]=g,e.watching&&Promise.resolve(Zi(g,s,h)).then(y=>{e.unwatch[h]=y}).catch(console.error),l},async unmount(h,g=!0){h=Nr(h),!(!h||!e.mounts[h])&&(e.watching&&h in e.unwatch&&(e.unwatch[h](),delete e.unwatch[h]),g&&await en(e.mounts[h]),e.mountpoints=e.mountpoints.filter(y=>y!==h),delete e.mounts[h])},getMount(h=""){h=rt(h)+":";const g=r(h);return{driver:g.driver,base:g.base}},getMounts(h="",g={}){return h=rt(h),i(h,g.parents).map(w=>({driver:w.driver,base:w.mountpoint}))}};return l}function Zi(t,e,r){return t.watch?t.watch((i,s)=>e(i,r+s)):()=>{}}async function en(t){typeof t.dispose=="function"&&await Ve(t.dispose)}function qt(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function gs(t,e){const r=indexedDB.open(t);r.onupgradeneeded=()=>r.result.createObjectStore(e);const i=qt(r);return(s,c)=>i.then(p=>c(p.transaction(e,s).objectStore(e)))}let Jr;function lr(){return Jr||(Jr=gs("keyval-store","keyval")),Jr}function tn(t,e=lr()){return e("readonly",r=>qt(r.get(t)))}function So(t,e,r=lr()){return r("readwrite",i=>(i.put(e,t),qt(i.transaction)))}function Io(t,e=lr()){return e("readwrite",r=>(r.delete(t),qt(r.transaction)))}function Oo(t=lr()){return t("readwrite",e=>(e.clear(),qt(e.transaction)))}function To(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},qt(t.transaction)}function No(t=lr()){return t("readonly",e=>{if(e.getAllKeys)return qt(e.getAllKeys());const r=[];return To(e,i=>r.push(i.key)).then(()=>r)})}const Po=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),Ao=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function Kr(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Ao(t)}catch{return t}}function dr(t){return typeof t=="string"?t:Po(t)||""}const Ro="idb-keyval";var Lo=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=s=>e+s;let i;return t.dbName&&t.storeName&&(i=gs(t.dbName,t.storeName)),{name:Ro,options:t,async hasItem(s){return!(typeof await tn(r(s),i)>"u")},async getItem(s){return await tn(r(s),i)??null},setItem(s,c){return So(r(s),c,i)},removeItem(s){return Io(r(s),i)},getKeys(){return No(i)},clear(){return Oo(i)}}};const Uo="WALLET_CONNECT_V2_INDEXED_DB",Co="keyvaluestorage";let Mo=class{constructor(){this.indexedDb=xo({driver:Lo({dbName:Uo,storeName:Co})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,dr(r))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Xr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Rr={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Xr<"u"&&Xr.localStorage?Rr.exports=Xr.localStorage:typeof window<"u"&&window.localStorage?Rr.exports=window.localStorage:Rr.exports=new e})();function Do(t){var e;return[t[0],Kr((e=t[1])!=null?e:"")]}let $o=class{constructor(){this.localStorage=Rr.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Do)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return Kr(r)}async setItem(e,r){this.localStorage.setItem(e,dr(r))}async removeItem(e){this.localStorage.removeItem(e)}};const jo="wc_storage_version",rn=1,zo=async(t,e,r)=>{const i=jo,s=await e.getItem(i);if(s&&s>=rn){r(e);return}const c=await t.getKeys();if(!c.length){r(e);return}const p=[];for(;c.length;){const o=c.shift();if(!o)continue;const l=o.toLowerCase();if(l.includes("wc@")||l.includes("walletconnect")||l.includes("wc_")||l.includes("wallet_connect")){const h=await t.getItem(o);await e.setItem(o,h),p.push(o)}}await e.setItem(i,rn),r(e),Ko(t,p)},Ko=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};let Ho=class{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new $o;this.storage=e;try{const r=new Mo;zo(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}};var Yt={};const Et=ls(no);var ir={},ye={},Qr={},nr={},nn;function Fo(){if(nn)return nr;nn=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return nr.delay=t,nr}var zt={},Zr={},Kt={},sn;function Bo(){return sn||(sn=1,Object.defineProperty(Kt,"__esModule",{value:!0}),Kt.ONE_THOUSAND=Kt.ONE_HUNDRED=void 0,Kt.ONE_HUNDRED=100,Kt.ONE_THOUSAND=1e3),Kt}var ei={},an;function qo(){return an||(an=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(ei)),ei}var on;function ps(){return on||(on=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Et;e.__exportStar(Bo(),t),e.__exportStar(qo(),t)}(Zr)),Zr}var cn;function ko(){if(cn)return zt;cn=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.fromMiliseconds=zt.toMiliseconds=void 0;const t=ps();function e(i){return i*t.ONE_THOUSAND}zt.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return zt.fromMiliseconds=r,zt}var hn;function Go(){return hn||(hn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Et;e.__exportStar(Fo(),t),e.__exportStar(ko(),t)}(Qr)),Qr}var Vt={},fn;function Wo(){if(fn)return Vt;fn=1,Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const s=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:s})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return Vt.Watch=t,Vt.default=t,Vt}var ti={},sr={},un;function Vo(){if(un)return sr;un=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.IWatch=void 0;class t{}return sr.IWatch=t,sr}var ln;function Yo(){return ln||(ln=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Et.__exportStar(Vo(),t)}(ti)),ti}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Et;e.__exportStar(Go(),t),e.__exportStar(Wo(),t),e.__exportStar(Yo(),t),e.__exportStar(ps(),t)})(ye);var ri={},ar={};let kt=class{};const Jo=Object.freeze(Object.defineProperty({__proto__:null,IEvents:kt},Symbol.toStringTag,{value:"Module"})),Xo=ls(Jo);var dn;function Qo(){if(dn)return ar;dn=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.IHeartBeat=void 0;const t=Xo;class e extends t.IEvents{constructor(i){super()}}return ar.IHeartBeat=e,ar}var gn;function ys(){return gn||(gn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Et.__exportStar(Qo(),t)}(ri)),ri}var ii={},Ht={},pn;function Zo(){if(pn)return Ht;pn=1,Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.HEARTBEAT_EVENTS=Ht.HEARTBEAT_INTERVAL=void 0;const t=ye;return Ht.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,Ht.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Ht}var yn;function bs(){return yn||(yn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Et.__exportStar(Zo(),t)}(ii)),ii}var bn;function ec(){if(bn)return ir;bn=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.HeartBeat=void 0;const t=Et,e=Nt,r=ye,i=ys(),s=bs();class c extends i.IHeartBeat{constructor(o){super(o),this.events=new e.EventEmitter,this.interval=s.HEARTBEAT_INTERVAL,this.interval=(o==null?void 0:o.interval)||s.HEARTBEAT_INTERVAL}static init(o){return t.__awaiter(this,void 0,void 0,function*(){const l=new c(o);return yield l.init(),l})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(o,l){this.events.on(o,l)}once(o,l){this.events.once(o,l)}off(o,l){this.events.off(o,l)}removeListener(o,l){this.events.removeListener(o,l)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(s.HEARTBEAT_EVENTS.pulse)}}return ir.HeartBeat=c,ir}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Et;e.__exportStar(ec(),t),e.__exportStar(ys(),t),e.__exportStar(bs(),t)})(Yt);var Se={},ni,mn;function tc(){if(mn)return ni;mn=1;function t(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}ni=e;function e(r,i,s){var c=s&&s.stringify||t,p=1;if(typeof r=="object"&&r!==null){var o=i.length+p;if(o===1)return r;var l=new Array(o);l[0]=c(r);for(var h=1;h<o;h++)l[h]=c(i[h]);return l.join(" ")}if(typeof r!="string")return r;var g=i.length;if(g===0)return r;for(var y="",w=1-p,v=-1,O=r&&r.length||0,R=0;R<O;){if(r.charCodeAt(R)===37&&R+1<O){switch(v=v>-1?v:0,r.charCodeAt(R+1)){case 100:case 102:if(w>=g||i[w]==null)break;v<R&&(y+=r.slice(v,R)),y+=Number(i[w]),v=R+2,R++;break;case 105:if(w>=g||i[w]==null)break;v<R&&(y+=r.slice(v,R)),y+=Math.floor(Number(i[w])),v=R+2,R++;break;case 79:case 111:case 106:if(w>=g||i[w]===void 0)break;v<R&&(y+=r.slice(v,R));var C=typeof i[w];if(C==="string"){y+="'"+i[w]+"'",v=R+2,R++;break}if(C==="function"){y+=i[w].name||"<anonymous>",v=R+2,R++;break}y+=c(i[w]),v=R+2,R++;break;case 115:if(w>=g)break;v<R&&(y+=r.slice(v,R)),y+=String(i[w]),v=R+2,R++;break;case 37:v<R&&(y+=r.slice(v,R)),y+="%",v=R+2,R++,w--;break}++w}++R}return v===-1?r:(v<O&&(y+=r.slice(v)),y)}return ni}var si,_n;function rc(){if(_n)return si;_n=1;const t=tc();si=s;const e=_().console||{},r={mapHttpRequest:O,mapHttpResponse:O,wrapRequestSerializer:R,wrapResponseSerializer:R,wrapErrorSerializer:R,req:O,res:O,err:w};function i(u,n){return Array.isArray(u)?u.filter(function(U){return U!=="!stdSerializers.err"}):u===!0?Object.keys(n):!1}function s(u){u=u||{},u.browser=u.browser||{};const n=u.browser.transmit;if(n&&typeof n.send!="function")throw Error("pino: transmit option must have a send function");const f=u.browser.write||e;u.browser.write&&(u.browser.asObject=!0);const U=u.serializers||{},L=i(u.browser.serialize,U);let F=u.browser.serialize;Array.isArray(u.browser.serialize)&&u.browser.serialize.indexOf("!stdSerializers.err")>-1&&(F=!1);const k=["error","fatal","warn","info","debug","trace"];typeof f=="function"&&(f.error=f.fatal=f.warn=f.info=f.debug=f.trace=f),u.enabled===!1&&(u.level="silent");const J=u.level||"info",I=Object.create(f);I.log||(I.log=C),Object.defineProperty(I,"levelVal",{get:G}),Object.defineProperty(I,"level",{get:z,set:D});const A={transmit:n,serialize:L,asObject:u.browser.asObject,levels:k,timestamp:v(u)};I.levels=s.levels,I.level=J,I.setMaxListeners=I.getMaxListeners=I.emit=I.addListener=I.on=I.prependListener=I.once=I.prependOnceListener=I.removeListener=I.removeAllListeners=I.listeners=I.listenerCount=I.eventNames=I.write=I.flush=C,I.serializers=U,I._serialize=L,I._stdErrSerialize=F,I.child=j,n&&(I._logEvent=y());function G(){return this.level==="silent"?1/0:this.levels.values[this.level]}function z(){return this._level}function D(M){if(M!=="silent"&&!this.levels.values[M])throw Error("unknown level "+M);this._level=M,c(A,I,"error","log"),c(A,I,"fatal","error"),c(A,I,"warn","error"),c(A,I,"info","log"),c(A,I,"debug","log"),c(A,I,"trace","log")}function j(M,K){if(!M)throw new Error("missing bindings for child Pino");K=K||{},L&&M.serializers&&(K.serializers=M.serializers);const Z=K.serializers;if(L&&Z){var H=Object.assign({},U,Z),X=u.browser.serialize===!0?Object.keys(H):L;delete M.serializers,l([M],X,H,this._stdErrSerialize)}function V(Q){this._childLevel=(Q._childLevel|0)+1,this.error=h(Q,M,"error"),this.fatal=h(Q,M,"fatal"),this.warn=h(Q,M,"warn"),this.info=h(Q,M,"info"),this.debug=h(Q,M,"debug"),this.trace=h(Q,M,"trace"),H&&(this.serializers=H,this._serialize=X),n&&(this._logEvent=y([].concat(Q._logEvent.bindings,M)))}return V.prototype=this,new V(this)}return I}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=r,s.stdTimeFunctions=Object.assign({},{nullTime:q,epochTime:E,unixTime:P,isoTime:m});function c(u,n,f,U){const L=Object.getPrototypeOf(n);n[f]=n.levelVal>n.levels.values[f]?C:L[f]?L[f]:e[f]||e[U]||C,p(u,n,f)}function p(u,n,f){!u.transmit&&n[f]===C||(n[f]=function(U){return function(){const F=u.timestamp(),k=new Array(arguments.length),J=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var I=0;I<k.length;I++)k[I]=arguments[I];if(u.serialize&&!u.asObject&&l(k,this._serialize,this.serializers,this._stdErrSerialize),u.asObject?U.call(J,o(this,f,k,F)):U.apply(J,k),u.transmit){const A=u.transmit.level||n.level,G=s.levels.values[A],z=s.levels.values[f];if(z<G)return;g(this,{ts:F,methodLevel:f,methodValue:z,transmitLevel:A,transmitValue:s.levels.values[u.transmit.level||n.level],send:u.transmit.send,val:n.levelVal},k)}}}(n[f]))}function o(u,n,f,U){u._serialize&&l(f,u._serialize,u.serializers,u._stdErrSerialize);const L=f.slice();let F=L[0];const k={};U&&(k.time=U),k.level=s.levels.values[n];let J=(u._childLevel|0)+1;if(J<1&&(J=1),F!==null&&typeof F=="object"){for(;J--&&typeof L[0]=="object";)Object.assign(k,L.shift());F=L.length?t(L.shift(),L):void 0}else typeof F=="string"&&(F=t(L.shift(),L));return F!==void 0&&(k.msg=F),k}function l(u,n,f,U){for(const L in u)if(U&&u[L]instanceof Error)u[L]=s.stdSerializers.err(u[L]);else if(typeof u[L]=="object"&&!Array.isArray(u[L]))for(const F in u[L])n&&n.indexOf(F)>-1&&F in f&&(u[L][F]=f[F](u[L][F]))}function h(u,n,f){return function(){const U=new Array(1+arguments.length);U[0]=n;for(var L=1;L<U.length;L++)U[L]=arguments[L-1];return u[f].apply(this,U)}}function g(u,n,f){const U=n.send,L=n.ts,F=n.methodLevel,k=n.methodValue,J=n.val,I=u._logEvent.bindings;l(f,u._serialize||Object.keys(u.serializers),u.serializers,u._stdErrSerialize===void 0?!0:u._stdErrSerialize),u._logEvent.ts=L,u._logEvent.messages=f.filter(function(A){return I.indexOf(A)===-1}),u._logEvent.level.label=F,u._logEvent.level.value=k,U(F,u._logEvent,J),u._logEvent=y(I)}function y(u){return{ts:0,messages:[],bindings:u||[],level:{label:"",value:0}}}function w(u){const n={type:u.constructor.name,msg:u.message,stack:u.stack};for(const f in u)n[f]===void 0&&(n[f]=u[f]);return n}function v(u){return typeof u.timestamp=="function"?u.timestamp:u.timestamp===!1?q:E}function O(){return{}}function R(u){return u}function C(){}function q(){return!1}function E(){return Date.now()}function P(){return Math.round(Date.now()/1e3)}function m(){return new Date(Date.now()).toISOString()}function _(){function u(n){return typeof n<"u"&&n}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return u(self)||u(window)||u(this)||{}}}return si}var Ft={},vn;function ms(){return vn||(vn=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.PINO_CUSTOM_CONTEXT_KEY=Ft.PINO_LOGGER_DEFAULTS=void 0,Ft.PINO_LOGGER_DEFAULTS={level:"info"},Ft.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Ft}var Ze={},wn;function ic(){if(wn)return Ze;wn=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.generateChildLogger=Ze.formatChildLoggerContext=Ze.getLoggerContext=Ze.setBrowserLoggerContext=Ze.getBrowserLoggerContext=Ze.getDefaultLoggerOptions=void 0;const t=ms();function e(o){return Object.assign(Object.assign({},o),{level:(o==null?void 0:o.level)||t.PINO_LOGGER_DEFAULTS.level})}Ze.getDefaultLoggerOptions=e;function r(o,l=t.PINO_CUSTOM_CONTEXT_KEY){return o[l]||""}Ze.getBrowserLoggerContext=r;function i(o,l,h=t.PINO_CUSTOM_CONTEXT_KEY){return o[h]=l,o}Ze.setBrowserLoggerContext=i;function s(o,l=t.PINO_CUSTOM_CONTEXT_KEY){let h="";return typeof o.bindings>"u"?h=r(o,l):h=o.bindings().context||"",h}Ze.getLoggerContext=s;function c(o,l,h=t.PINO_CUSTOM_CONTEXT_KEY){const g=s(o,h);return g.trim()?`${g}/${l}`:l}Ze.formatChildLoggerContext=c;function p(o,l,h=t.PINO_CUSTOM_CONTEXT_KEY){const g=c(o,l,h),y=o.child({context:g});return i(y,g,h)}return Ze.generateChildLogger=p,Ze}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=Et,r=e.__importDefault(rc());Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return r.default}}),e.__exportStar(ms(),t),e.__exportStar(ic(),t)})(Se);class nc extends kt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}let sc=class extends kt{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}};class ac{constructor(e,r){this.logger=e,this.core=r}}class oc extends kt{constructor(e,r){super(),this.relayer=e,this.logger=r}}let cc=class extends kt{constructor(e){super()}},hc=class{constructor(e,r,i,s){this.core=e,this.logger=r,this.name=i}};class fc extends kt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class uc extends kt{constructor(e,r){super(),this.core=e,this.logger=r}}class lc{constructor(e,r){this.projectId=e,this.logger=r}}class kd{constructor(e){this.opts=e,this.protocol="wc",this.version=2}}let Gd=class{constructor(e){this.client=e}};var Ni={},Jt={},Hr={},Fr={};Object.defineProperty(Fr,"__esModule",{value:!0});Fr.BrowserRandomSource=void 0;const En=65536;class dc{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(e);for(let i=0;i<r.length;i+=En)this._crypto.getRandomValues(r.subarray(i,i+Math.min(r.length-i,En)));return r}}Fr.BrowserRandomSource=dc;function gc(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Br={},ct={};Object.defineProperty(ct,"__esModule",{value:!0});function pc(t){for(var e=0;e<t.length;e++)t[e]=0;return t}ct.wipe=pc;Object.defineProperty(Br,"__esModule",{value:!0});Br.NodeRandomSource=void 0;const yc=ct;class bc{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof gc<"u"){const e=ao;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let s=0;s<i.length;s++)i[s]=r[s];return(0,yc.wipe)(r),i}}Br.NodeRandomSource=bc;Object.defineProperty(Hr,"__esModule",{value:!0});Hr.SystemRandomSource=void 0;const mc=Fr,_c=Br;class vc{constructor(){if(this.isAvailable=!1,this.name="",this._source=new mc.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new _c.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Hr.SystemRandomSource=vc;var re={},_s={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(o,l){var h=o>>>16&65535,g=o&65535,y=l>>>16&65535,w=l&65535;return g*w+(h*w+g*y<<16>>>0)|0}t.mul=Math.imul||e;function r(o,l){return o+l|0}t.add=r;function i(o,l){return o-l|0}t.sub=i;function s(o,l){return o<<l|o>>>32-l}t.rotl=s;function c(o,l){return o<<32-l|o>>>l}t.rotr=c;function p(o){return typeof o=="number"&&isFinite(o)&&Math.floor(o)===o}t.isInteger=Number.isInteger||p,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(o){return t.isInteger(o)&&o>=-t.MAX_SAFE_INTEGER&&o<=t.MAX_SAFE_INTEGER}})(_s);Object.defineProperty(re,"__esModule",{value:!0});var vs=_s;function wc(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}re.readInt16BE=wc;function Ec(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}re.readUint16BE=Ec;function xc(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}re.readInt16LE=xc;function Sc(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}re.readUint16LE=Sc;function ws(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>8,e[r+1]=t>>>0,e}re.writeUint16BE=ws;re.writeInt16BE=ws;function Es(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e}re.writeUint16LE=Es;re.writeInt16LE=Es;function pi(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}re.readInt32BE=pi;function yi(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}re.readUint32BE=yi;function bi(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}re.readInt32LE=bi;function mi(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}re.readUint32LE=mi;function Cr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>24,e[r+1]=t>>>16,e[r+2]=t>>>8,e[r+3]=t>>>0,e}re.writeUint32BE=Cr;re.writeInt32BE=Cr;function Mr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24,e}re.writeUint32LE=Mr;re.writeInt32LE=Mr;function Ic(t,e){e===void 0&&(e=0);var r=pi(t,e),i=pi(t,e+4);return r*4294967296+i-(i>>31)*4294967296}re.readInt64BE=Ic;function Oc(t,e){e===void 0&&(e=0);var r=yi(t,e),i=yi(t,e+4);return r*4294967296+i}re.readUint64BE=Oc;function Tc(t,e){e===void 0&&(e=0);var r=bi(t,e),i=bi(t,e+4);return i*4294967296+r-(r>>31)*4294967296}re.readInt64LE=Tc;function Nc(t,e){e===void 0&&(e=0);var r=mi(t,e),i=mi(t,e+4);return i*4294967296+r}re.readUint64LE=Nc;function xs(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),Cr(t/4294967296>>>0,e,r),Cr(t>>>0,e,r+4),e}re.writeUint64BE=xs;re.writeInt64BE=xs;function Ss(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),Mr(t>>>0,e,r),Mr(t/4294967296>>>0,e,r+4),e}re.writeUint64LE=Ss;re.writeInt64LE=Ss;function Pc(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,s=1,c=t/8+r-1;c>=r;c--)i+=e[c]*s,s*=256;return i}re.readUintBE=Pc;function Ac(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,s=1,c=r;c<r+t/8;c++)i+=e[c]*s,s*=256;return i}re.readUintLE=Ac;function Rc(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!vs.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var s=1,c=t/8+i-1;c>=i;c--)r[c]=e/s&255,s*=256;return r}re.writeUintBE=Rc;function Lc(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!vs.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var s=1,c=i;c<i+t/8;c++)r[c]=e/s&255,s*=256;return r}re.writeUintLE=Lc;function Uc(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e)}re.readFloat32BE=Uc;function Cc(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e,!0)}re.readFloat32LE=Cc;function Mc(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e)}re.readFloat64BE=Mc;function Dc(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e,!0)}re.readFloat64LE=Dc;function $c(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t),e}re.writeFloat32BE=$c;function jc(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t,!0),e}re.writeFloat32LE=jc;function zc(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t),e}re.writeFloat64BE=zc;function Kc(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t,!0),e}re.writeFloat64LE=Kc;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=Hr,r=re,i=ct;t.defaultRandomSource=new e.SystemRandomSource;function s(h,g=t.defaultRandomSource){return g.randomBytes(h)}t.randomBytes=s;function c(h=t.defaultRandomSource){const g=s(4,h),y=(0,r.readUint32LE)(g);return(0,i.wipe)(g),y}t.randomUint32=c;const p="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function o(h,g=p,y=t.defaultRandomSource){if(g.length<2)throw new Error("randomString charset is too short");if(g.length>256)throw new Error("randomString charset is too long");let w="";const v=g.length,O=256-256%v;for(;h>0;){const R=s(Math.ceil(h*256/O),y);for(let C=0;C<R.length&&h>0;C++){const q=R[C];q<O&&(w+=g.charAt(q%v),h--)}(0,i.wipe)(R)}return w}t.randomString=o;function l(h,g=p,y=t.defaultRandomSource){const w=Math.ceil(h/(Math.log(g.length)/Math.LN2));return o(w,g,y)}t.randomStringForEntropy=l})(Jt);var Is={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=re,r=ct;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var i=function(){function o(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return o.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},o.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},o.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},o.prototype.update=function(l,h){if(h===void 0&&(h=l.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var g=0;if(this._bytesHashed+=h,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&h>0;)this._buffer[this._bufferLength++]=l[g++],h--;this._bufferLength===this.blockSize&&(c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(h>=this.blockSize&&(g=c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,l,g,h),h%=this.blockSize);h>0;)this._buffer[this._bufferLength++]=l[g++],h--;return this},o.prototype.finish=function(l){if(!this._finished){var h=this._bytesHashed,g=this._bufferLength,y=h/536870912|0,w=h<<3,v=h%128<112?128:256;this._buffer[g]=128;for(var O=g+1;O<v-8;O++)this._buffer[O]=0;e.writeUint32BE(y,this._buffer,v-8),e.writeUint32BE(w,this._buffer,v-4),c(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,v),this._finished=!0}for(var O=0;O<this.digestLength/8;O++)e.writeUint32BE(this._stateHi[O],l,O*8),e.writeUint32BE(this._stateLo[O],l,O*8+4);return this},o.prototype.digest=function(){var l=new Uint8Array(this.digestLength);return this.finish(l),l},o.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},o.prototype.restoreState=function(l){return this._stateHi.set(l.stateHi),this._stateLo.set(l.stateLo),this._bufferLength=l.bufferLength,l.buffer&&this._buffer.set(l.buffer),this._bytesHashed=l.bytesHashed,this._finished=!1,this},o.prototype.cleanSavedState=function(l){r.wipe(l.stateHi),r.wipe(l.stateLo),l.buffer&&r.wipe(l.buffer),l.bufferLength=0,l.bytesHashed=0},o}();t.SHA512=i;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function c(o,l,h,g,y,w,v){for(var O=h[0],R=h[1],C=h[2],q=h[3],E=h[4],P=h[5],m=h[6],_=h[7],u=g[0],n=g[1],f=g[2],U=g[3],L=g[4],F=g[5],k=g[6],J=g[7],I,A,G,z,D,j,M,K;v>=128;){for(var Z=0;Z<16;Z++){var H=8*Z+w;o[Z]=e.readUint32BE(y,H),l[Z]=e.readUint32BE(y,H+4)}for(var Z=0;Z<80;Z++){var X=O,V=R,Q=C,N=q,T=E,x=P,a=m,b=_,B=u,W=n,he=f,be=U,ue=L,ve=F,Ue=k,Pe=J;if(I=_,A=J,D=A&65535,j=A>>>16,M=I&65535,K=I>>>16,I=(E>>>14|L<<18)^(E>>>18|L<<14)^(L>>>9|E<<23),A=(L>>>14|E<<18)^(L>>>18|E<<14)^(E>>>9|L<<23),D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,I=E&P^~E&m,A=L&F^~L&k,D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,I=s[Z*2],A=s[Z*2+1],D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,I=o[Z%16],A=l[Z%16],D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,j+=D>>>16,M+=j>>>16,K+=M>>>16,G=M&65535|K<<16,z=D&65535|j<<16,I=G,A=z,D=A&65535,j=A>>>16,M=I&65535,K=I>>>16,I=(O>>>28|u<<4)^(u>>>2|O<<30)^(u>>>7|O<<25),A=(u>>>28|O<<4)^(O>>>2|u<<30)^(O>>>7|u<<25),D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,I=O&R^O&C^R&C,A=u&n^u&f^n&f,D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,j+=D>>>16,M+=j>>>16,K+=M>>>16,b=M&65535|K<<16,Pe=D&65535|j<<16,I=N,A=be,D=A&65535,j=A>>>16,M=I&65535,K=I>>>16,I=G,A=z,D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,j+=D>>>16,M+=j>>>16,K+=M>>>16,N=M&65535|K<<16,be=D&65535|j<<16,R=X,C=V,q=Q,E=N,P=T,m=x,_=a,O=b,n=B,f=W,U=he,L=be,F=ue,k=ve,J=Ue,u=Pe,Z%16===15)for(var H=0;H<16;H++)I=o[H],A=l[H],D=A&65535,j=A>>>16,M=I&65535,K=I>>>16,I=o[(H+9)%16],A=l[(H+9)%16],D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,G=o[(H+1)%16],z=l[(H+1)%16],I=(G>>>1|z<<31)^(G>>>8|z<<24)^G>>>7,A=(z>>>1|G<<31)^(z>>>8|G<<24)^(z>>>7|G<<25),D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,G=o[(H+14)%16],z=l[(H+14)%16],I=(G>>>19|z<<13)^(z>>>29|G<<3)^G>>>6,A=(z>>>19|G<<13)^(G>>>29|z<<3)^(z>>>6|G<<26),D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,j+=D>>>16,M+=j>>>16,K+=M>>>16,o[H]=M&65535|K<<16,l[H]=D&65535|j<<16}I=O,A=u,D=A&65535,j=A>>>16,M=I&65535,K=I>>>16,I=h[0],A=g[0],D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,j+=D>>>16,M+=j>>>16,K+=M>>>16,h[0]=O=M&65535|K<<16,g[0]=u=D&65535|j<<16,I=R,A=n,D=A&65535,j=A>>>16,M=I&65535,K=I>>>16,I=h[1],A=g[1],D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,j+=D>>>16,M+=j>>>16,K+=M>>>16,h[1]=R=M&65535|K<<16,g[1]=n=D&65535|j<<16,I=C,A=f,D=A&65535,j=A>>>16,M=I&65535,K=I>>>16,I=h[2],A=g[2],D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,j+=D>>>16,M+=j>>>16,K+=M>>>16,h[2]=C=M&65535|K<<16,g[2]=f=D&65535|j<<16,I=q,A=U,D=A&65535,j=A>>>16,M=I&65535,K=I>>>16,I=h[3],A=g[3],D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,j+=D>>>16,M+=j>>>16,K+=M>>>16,h[3]=q=M&65535|K<<16,g[3]=U=D&65535|j<<16,I=E,A=L,D=A&65535,j=A>>>16,M=I&65535,K=I>>>16,I=h[4],A=g[4],D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,j+=D>>>16,M+=j>>>16,K+=M>>>16,h[4]=E=M&65535|K<<16,g[4]=L=D&65535|j<<16,I=P,A=F,D=A&65535,j=A>>>16,M=I&65535,K=I>>>16,I=h[5],A=g[5],D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,j+=D>>>16,M+=j>>>16,K+=M>>>16,h[5]=P=M&65535|K<<16,g[5]=F=D&65535|j<<16,I=m,A=k,D=A&65535,j=A>>>16,M=I&65535,K=I>>>16,I=h[6],A=g[6],D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,j+=D>>>16,M+=j>>>16,K+=M>>>16,h[6]=m=M&65535|K<<16,g[6]=k=D&65535|j<<16,I=_,A=J,D=A&65535,j=A>>>16,M=I&65535,K=I>>>16,I=h[7],A=g[7],D+=A&65535,j+=A>>>16,M+=I&65535,K+=I>>>16,j+=D>>>16,M+=j>>>16,K+=M>>>16,h[7]=_=M&65535|K<<16,g[7]=J=D&65535|j<<16,w+=128,v-=128}return w}function p(o){var l=new i;l.update(o);var h=l.digest();return l.clean(),h}t.hash=p})(Is);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=Jt,r=Is,i=ct;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function s(N){const T=new Float64Array(16);if(N)for(let x=0;x<N.length;x++)T[x]=N[x];return T}const c=new Uint8Array(32);c[0]=9;const p=s(),o=s([1]),l=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),h=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),g=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),y=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),w=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function v(N,T){for(let x=0;x<16;x++)N[x]=T[x]|0}function O(N){let T=1;for(let x=0;x<16;x++){let a=N[x]+T+65535;T=Math.floor(a/65536),N[x]=a-T*65536}N[0]+=T-1+37*(T-1)}function R(N,T,x){const a=~(x-1);for(let b=0;b<16;b++){const B=a&(N[b]^T[b]);N[b]^=B,T[b]^=B}}function C(N,T){const x=s(),a=s();for(let b=0;b<16;b++)a[b]=T[b];O(a),O(a),O(a);for(let b=0;b<2;b++){x[0]=a[0]-65517;for(let W=1;W<15;W++)x[W]=a[W]-65535-(x[W-1]>>16&1),x[W-1]&=65535;x[15]=a[15]-32767-(x[14]>>16&1);const B=x[15]>>16&1;x[14]&=65535,R(a,x,1-B)}for(let b=0;b<16;b++)N[2*b]=a[b]&255,N[2*b+1]=a[b]>>8}function q(N,T){let x=0;for(let a=0;a<32;a++)x|=N[a]^T[a];return(1&x-1>>>8)-1}function E(N,T){const x=new Uint8Array(32),a=new Uint8Array(32);return C(x,N),C(a,T),q(x,a)}function P(N){const T=new Uint8Array(32);return C(T,N),T[0]&1}function m(N,T){for(let x=0;x<16;x++)N[x]=T[2*x]+(T[2*x+1]<<8);N[15]&=32767}function _(N,T,x){for(let a=0;a<16;a++)N[a]=T[a]+x[a]}function u(N,T,x){for(let a=0;a<16;a++)N[a]=T[a]-x[a]}function n(N,T,x){let a,b,B=0,W=0,he=0,be=0,ue=0,ve=0,Ue=0,Pe=0,ge=0,le=0,fe=0,oe=0,ae=0,se=0,ne=0,ee=0,ce=0,de=0,te=0,me=0,_e=0,Ee=0,xe=0,we=0,lt=0,bt=0,Pt=0,st=0,Mt=0,er=0,vr=0,Ce=x[0],Ae=x[1],Me=x[2],De=x[3],$e=x[4],Re=x[5],Ke=x[6],He=x[7],Fe=x[8],Be=x[9],qe=x[10],ze=x[11],je=x[12],Te=x[13],ke=x[14],Ge=x[15];a=T[0],B+=a*Ce,W+=a*Ae,he+=a*Me,be+=a*De,ue+=a*$e,ve+=a*Re,Ue+=a*Ke,Pe+=a*He,ge+=a*Fe,le+=a*Be,fe+=a*qe,oe+=a*ze,ae+=a*je,se+=a*Te,ne+=a*ke,ee+=a*Ge,a=T[1],W+=a*Ce,he+=a*Ae,be+=a*Me,ue+=a*De,ve+=a*$e,Ue+=a*Re,Pe+=a*Ke,ge+=a*He,le+=a*Fe,fe+=a*Be,oe+=a*qe,ae+=a*ze,se+=a*je,ne+=a*Te,ee+=a*ke,ce+=a*Ge,a=T[2],he+=a*Ce,be+=a*Ae,ue+=a*Me,ve+=a*De,Ue+=a*$e,Pe+=a*Re,ge+=a*Ke,le+=a*He,fe+=a*Fe,oe+=a*Be,ae+=a*qe,se+=a*ze,ne+=a*je,ee+=a*Te,ce+=a*ke,de+=a*Ge,a=T[3],be+=a*Ce,ue+=a*Ae,ve+=a*Me,Ue+=a*De,Pe+=a*$e,ge+=a*Re,le+=a*Ke,fe+=a*He,oe+=a*Fe,ae+=a*Be,se+=a*qe,ne+=a*ze,ee+=a*je,ce+=a*Te,de+=a*ke,te+=a*Ge,a=T[4],ue+=a*Ce,ve+=a*Ae,Ue+=a*Me,Pe+=a*De,ge+=a*$e,le+=a*Re,fe+=a*Ke,oe+=a*He,ae+=a*Fe,se+=a*Be,ne+=a*qe,ee+=a*ze,ce+=a*je,de+=a*Te,te+=a*ke,me+=a*Ge,a=T[5],ve+=a*Ce,Ue+=a*Ae,Pe+=a*Me,ge+=a*De,le+=a*$e,fe+=a*Re,oe+=a*Ke,ae+=a*He,se+=a*Fe,ne+=a*Be,ee+=a*qe,ce+=a*ze,de+=a*je,te+=a*Te,me+=a*ke,_e+=a*Ge,a=T[6],Ue+=a*Ce,Pe+=a*Ae,ge+=a*Me,le+=a*De,fe+=a*$e,oe+=a*Re,ae+=a*Ke,se+=a*He,ne+=a*Fe,ee+=a*Be,ce+=a*qe,de+=a*ze,te+=a*je,me+=a*Te,_e+=a*ke,Ee+=a*Ge,a=T[7],Pe+=a*Ce,ge+=a*Ae,le+=a*Me,fe+=a*De,oe+=a*$e,ae+=a*Re,se+=a*Ke,ne+=a*He,ee+=a*Fe,ce+=a*Be,de+=a*qe,te+=a*ze,me+=a*je,_e+=a*Te,Ee+=a*ke,xe+=a*Ge,a=T[8],ge+=a*Ce,le+=a*Ae,fe+=a*Me,oe+=a*De,ae+=a*$e,se+=a*Re,ne+=a*Ke,ee+=a*He,ce+=a*Fe,de+=a*Be,te+=a*qe,me+=a*ze,_e+=a*je,Ee+=a*Te,xe+=a*ke,we+=a*Ge,a=T[9],le+=a*Ce,fe+=a*Ae,oe+=a*Me,ae+=a*De,se+=a*$e,ne+=a*Re,ee+=a*Ke,ce+=a*He,de+=a*Fe,te+=a*Be,me+=a*qe,_e+=a*ze,Ee+=a*je,xe+=a*Te,we+=a*ke,lt+=a*Ge,a=T[10],fe+=a*Ce,oe+=a*Ae,ae+=a*Me,se+=a*De,ne+=a*$e,ee+=a*Re,ce+=a*Ke,de+=a*He,te+=a*Fe,me+=a*Be,_e+=a*qe,Ee+=a*ze,xe+=a*je,we+=a*Te,lt+=a*ke,bt+=a*Ge,a=T[11],oe+=a*Ce,ae+=a*Ae,se+=a*Me,ne+=a*De,ee+=a*$e,ce+=a*Re,de+=a*Ke,te+=a*He,me+=a*Fe,_e+=a*Be,Ee+=a*qe,xe+=a*ze,we+=a*je,lt+=a*Te,bt+=a*ke,Pt+=a*Ge,a=T[12],ae+=a*Ce,se+=a*Ae,ne+=a*Me,ee+=a*De,ce+=a*$e,de+=a*Re,te+=a*Ke,me+=a*He,_e+=a*Fe,Ee+=a*Be,xe+=a*qe,we+=a*ze,lt+=a*je,bt+=a*Te,Pt+=a*ke,st+=a*Ge,a=T[13],se+=a*Ce,ne+=a*Ae,ee+=a*Me,ce+=a*De,de+=a*$e,te+=a*Re,me+=a*Ke,_e+=a*He,Ee+=a*Fe,xe+=a*Be,we+=a*qe,lt+=a*ze,bt+=a*je,Pt+=a*Te,st+=a*ke,Mt+=a*Ge,a=T[14],ne+=a*Ce,ee+=a*Ae,ce+=a*Me,de+=a*De,te+=a*$e,me+=a*Re,_e+=a*Ke,Ee+=a*He,xe+=a*Fe,we+=a*Be,lt+=a*qe,bt+=a*ze,Pt+=a*je,st+=a*Te,Mt+=a*ke,er+=a*Ge,a=T[15],ee+=a*Ce,ce+=a*Ae,de+=a*Me,te+=a*De,me+=a*$e,_e+=a*Re,Ee+=a*Ke,xe+=a*He,we+=a*Fe,lt+=a*Be,bt+=a*qe,Pt+=a*ze,st+=a*je,Mt+=a*Te,er+=a*ke,vr+=a*Ge,B+=38*ce,W+=38*de,he+=38*te,be+=38*me,ue+=38*_e,ve+=38*Ee,Ue+=38*xe,Pe+=38*we,ge+=38*lt,le+=38*bt,fe+=38*Pt,oe+=38*st,ae+=38*Mt,se+=38*er,ne+=38*vr,b=1,a=B+b+65535,b=Math.floor(a/65536),B=a-b*65536,a=W+b+65535,b=Math.floor(a/65536),W=a-b*65536,a=he+b+65535,b=Math.floor(a/65536),he=a-b*65536,a=be+b+65535,b=Math.floor(a/65536),be=a-b*65536,a=ue+b+65535,b=Math.floor(a/65536),ue=a-b*65536,a=ve+b+65535,b=Math.floor(a/65536),ve=a-b*65536,a=Ue+b+65535,b=Math.floor(a/65536),Ue=a-b*65536,a=Pe+b+65535,b=Math.floor(a/65536),Pe=a-b*65536,a=ge+b+65535,b=Math.floor(a/65536),ge=a-b*65536,a=le+b+65535,b=Math.floor(a/65536),le=a-b*65536,a=fe+b+65535,b=Math.floor(a/65536),fe=a-b*65536,a=oe+b+65535,b=Math.floor(a/65536),oe=a-b*65536,a=ae+b+65535,b=Math.floor(a/65536),ae=a-b*65536,a=se+b+65535,b=Math.floor(a/65536),se=a-b*65536,a=ne+b+65535,b=Math.floor(a/65536),ne=a-b*65536,a=ee+b+65535,b=Math.floor(a/65536),ee=a-b*65536,B+=b-1+37*(b-1),b=1,a=B+b+65535,b=Math.floor(a/65536),B=a-b*65536,a=W+b+65535,b=Math.floor(a/65536),W=a-b*65536,a=he+b+65535,b=Math.floor(a/65536),he=a-b*65536,a=be+b+65535,b=Math.floor(a/65536),be=a-b*65536,a=ue+b+65535,b=Math.floor(a/65536),ue=a-b*65536,a=ve+b+65535,b=Math.floor(a/65536),ve=a-b*65536,a=Ue+b+65535,b=Math.floor(a/65536),Ue=a-b*65536,a=Pe+b+65535,b=Math.floor(a/65536),Pe=a-b*65536,a=ge+b+65535,b=Math.floor(a/65536),ge=a-b*65536,a=le+b+65535,b=Math.floor(a/65536),le=a-b*65536,a=fe+b+65535,b=Math.floor(a/65536),fe=a-b*65536,a=oe+b+65535,b=Math.floor(a/65536),oe=a-b*65536,a=ae+b+65535,b=Math.floor(a/65536),ae=a-b*65536,a=se+b+65535,b=Math.floor(a/65536),se=a-b*65536,a=ne+b+65535,b=Math.floor(a/65536),ne=a-b*65536,a=ee+b+65535,b=Math.floor(a/65536),ee=a-b*65536,B+=b-1+37*(b-1),N[0]=B,N[1]=W,N[2]=he,N[3]=be,N[4]=ue,N[5]=ve,N[6]=Ue,N[7]=Pe,N[8]=ge,N[9]=le,N[10]=fe,N[11]=oe,N[12]=ae,N[13]=se,N[14]=ne,N[15]=ee}function f(N,T){n(N,T,T)}function U(N,T){const x=s();let a;for(a=0;a<16;a++)x[a]=T[a];for(a=253;a>=0;a--)f(x,x),a!==2&&a!==4&&n(x,x,T);for(a=0;a<16;a++)N[a]=x[a]}function L(N,T){const x=s();let a;for(a=0;a<16;a++)x[a]=T[a];for(a=250;a>=0;a--)f(x,x),a!==1&&n(x,x,T);for(a=0;a<16;a++)N[a]=x[a]}function F(N,T){const x=s(),a=s(),b=s(),B=s(),W=s(),he=s(),be=s(),ue=s(),ve=s();u(x,N[1],N[0]),u(ve,T[1],T[0]),n(x,x,ve),_(a,N[0],N[1]),_(ve,T[0],T[1]),n(a,a,ve),n(b,N[3],T[3]),n(b,b,h),n(B,N[2],T[2]),_(B,B,B),u(W,a,x),u(he,B,b),_(be,B,b),_(ue,a,x),n(N[0],W,he),n(N[1],ue,be),n(N[2],be,he),n(N[3],W,ue)}function k(N,T,x){for(let a=0;a<4;a++)R(N[a],T[a],x)}function J(N,T){const x=s(),a=s(),b=s();U(b,T[2]),n(x,T[0],b),n(a,T[1],b),C(N,a),N[31]^=P(x)<<7}function I(N,T,x){v(N[0],p),v(N[1],o),v(N[2],o),v(N[3],p);for(let a=255;a>=0;--a){const b=x[a/8|0]>>(a&7)&1;k(N,T,b),F(T,N),F(N,N),k(N,T,b)}}function A(N,T){const x=[s(),s(),s(),s()];v(x[0],g),v(x[1],y),v(x[2],o),n(x[3],g,y),I(N,x,T)}function G(N){if(N.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const T=(0,r.hash)(N);T[0]&=248,T[31]&=127,T[31]|=64;const x=new Uint8Array(32),a=[s(),s(),s(),s()];A(a,T),J(x,a);const b=new Uint8Array(64);return b.set(N),b.set(x,32),{publicKey:x,secretKey:b}}t.generateKeyPairFromSeed=G;function z(N){const T=(0,e.randomBytes)(32,N),x=G(T);return(0,i.wipe)(T),x}t.generateKeyPair=z;function D(N){if(N.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(N.subarray(32))}t.extractPublicKeyFromSecretKey=D;const j=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function M(N,T){let x,a,b,B;for(a=63;a>=32;--a){for(x=0,b=a-32,B=a-12;b<B;++b)T[b]+=x-16*T[a]*j[b-(a-32)],x=Math.floor((T[b]+128)/256),T[b]-=x*256;T[b]+=x,T[a]=0}for(x=0,b=0;b<32;b++)T[b]+=x-(T[31]>>4)*j[b],x=T[b]>>8,T[b]&=255;for(b=0;b<32;b++)T[b]-=x*j[b];for(a=0;a<32;a++)T[a+1]+=T[a]>>8,N[a]=T[a]&255}function K(N){const T=new Float64Array(64);for(let x=0;x<64;x++)T[x]=N[x];for(let x=0;x<64;x++)N[x]=0;M(N,T)}function Z(N,T){const x=new Float64Array(64),a=[s(),s(),s(),s()],b=(0,r.hash)(N.subarray(0,32));b[0]&=248,b[31]&=127,b[31]|=64;const B=new Uint8Array(64);B.set(b.subarray(32),32);const W=new r.SHA512;W.update(B.subarray(32)),W.update(T);const he=W.digest();W.clean(),K(he),A(a,he),J(B,a),W.reset(),W.update(B.subarray(0,32)),W.update(N.subarray(32)),W.update(T);const be=W.digest();K(be);for(let ue=0;ue<32;ue++)x[ue]=he[ue];for(let ue=0;ue<32;ue++)for(let ve=0;ve<32;ve++)x[ue+ve]+=be[ue]*b[ve];return M(B.subarray(32),x),B}t.sign=Z;function H(N,T){const x=s(),a=s(),b=s(),B=s(),W=s(),he=s(),be=s();return v(N[2],o),m(N[1],T),f(b,N[1]),n(B,b,l),u(b,b,N[2]),_(B,N[2],B),f(W,B),f(he,W),n(be,he,W),n(x,be,b),n(x,x,B),L(x,x),n(x,x,b),n(x,x,B),n(x,x,B),n(N[0],x,B),f(a,N[0]),n(a,a,B),E(a,b)&&n(N[0],N[0],w),f(a,N[0]),n(a,a,B),E(a,b)?-1:(P(N[0])===T[31]>>7&&u(N[0],p,N[0]),n(N[3],N[0],N[1]),0)}function X(N,T,x){const a=new Uint8Array(32),b=[s(),s(),s(),s()],B=[s(),s(),s(),s()];if(x.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(H(B,N))return!1;const W=new r.SHA512;W.update(x.subarray(0,32)),W.update(N),W.update(T);const he=W.digest();return K(he),I(b,B,he),A(B,x.subarray(32)),F(b,B),J(a,b),!q(x,a)}t.verify=X;function V(N){let T=[s(),s(),s(),s()];if(H(T,N))throw new Error("Ed25519: invalid public key");let x=s(),a=s(),b=T[1];_(x,o,b),u(a,o,b),U(a,a),n(x,x,a);let B=new Uint8Array(32);return C(B,x),B}t.convertPublicKeyToX25519=V;function Q(N){const T=(0,r.hash)(N.subarray(0,32));T[0]&=248,T[31]&=127,T[31]|=64;const x=new Uint8Array(T.subarray(0,32));return(0,i.wipe)(T),x}t.convertSecretKeyToX25519=Q})(Ni);const Hc="EdDSA",Fc="JWT",Os=".",Ts="base64url",Bc="utf8",qc="utf8",kc=":",Gc="did",Wc="key",xn="base58btc",Vc="z",Yc="K36",Jc=32;function Dr(t){return tt(nt(dr(t),Bc),Ts)}function Ns(t){const e=nt(Yc,xn),r=Vc+tt(di([e,t]),xn);return[Gc,Wc,r].join(kc)}function Xc(t){return tt(t,Ts)}function Qc(t){return nt([Dr(t.header),Dr(t.payload)].join(Os),qc)}function Zc(t){return[Dr(t.header),Dr(t.payload),Xc(t.signature)].join(Os)}function Sn(t=Jt.randomBytes(Jc)){return Ni.generateKeyPairFromSeed(t)}async function eh(t,e,r,i,s=ye.fromMiliseconds(Date.now())){const c={alg:Hc,typ:Fc},p=Ns(i.publicKey),o=s+r,l={iss:p,sub:t,aud:e,iat:s,exp:o},h=Qc({header:c,payload:l}),g=Ni.sign(i.secretKey,h);return Zc({header:c,payload:l,signature:g})}var Pi={},qr={};Object.defineProperty(qr,"__esModule",{value:!0});var Qe=re,_i=ct,th=20;function rh(t,e,r){for(var i=1634760805,s=857760878,c=2036477234,p=1797285236,o=r[3]<<24|r[2]<<16|r[1]<<8|r[0],l=r[7]<<24|r[6]<<16|r[5]<<8|r[4],h=r[11]<<24|r[10]<<16|r[9]<<8|r[8],g=r[15]<<24|r[14]<<16|r[13]<<8|r[12],y=r[19]<<24|r[18]<<16|r[17]<<8|r[16],w=r[23]<<24|r[22]<<16|r[21]<<8|r[20],v=r[27]<<24|r[26]<<16|r[25]<<8|r[24],O=r[31]<<24|r[30]<<16|r[29]<<8|r[28],R=e[3]<<24|e[2]<<16|e[1]<<8|e[0],C=e[7]<<24|e[6]<<16|e[5]<<8|e[4],q=e[11]<<24|e[10]<<16|e[9]<<8|e[8],E=e[15]<<24|e[14]<<16|e[13]<<8|e[12],P=i,m=s,_=c,u=p,n=o,f=l,U=h,L=g,F=y,k=w,J=v,I=O,A=R,G=C,z=q,D=E,j=0;j<th;j+=2)P=P+n|0,A^=P,A=A>>>16|A<<16,F=F+A|0,n^=F,n=n>>>20|n<<12,m=m+f|0,G^=m,G=G>>>16|G<<16,k=k+G|0,f^=k,f=f>>>20|f<<12,_=_+U|0,z^=_,z=z>>>16|z<<16,J=J+z|0,U^=J,U=U>>>20|U<<12,u=u+L|0,D^=u,D=D>>>16|D<<16,I=I+D|0,L^=I,L=L>>>20|L<<12,_=_+U|0,z^=_,z=z>>>24|z<<8,J=J+z|0,U^=J,U=U>>>25|U<<7,u=u+L|0,D^=u,D=D>>>24|D<<8,I=I+D|0,L^=I,L=L>>>25|L<<7,m=m+f|0,G^=m,G=G>>>24|G<<8,k=k+G|0,f^=k,f=f>>>25|f<<7,P=P+n|0,A^=P,A=A>>>24|A<<8,F=F+A|0,n^=F,n=n>>>25|n<<7,P=P+f|0,D^=P,D=D>>>16|D<<16,J=J+D|0,f^=J,f=f>>>20|f<<12,m=m+U|0,A^=m,A=A>>>16|A<<16,I=I+A|0,U^=I,U=U>>>20|U<<12,_=_+L|0,G^=_,G=G>>>16|G<<16,F=F+G|0,L^=F,L=L>>>20|L<<12,u=u+n|0,z^=u,z=z>>>16|z<<16,k=k+z|0,n^=k,n=n>>>20|n<<12,_=_+L|0,G^=_,G=G>>>24|G<<8,F=F+G|0,L^=F,L=L>>>25|L<<7,u=u+n|0,z^=u,z=z>>>24|z<<8,k=k+z|0,n^=k,n=n>>>25|n<<7,m=m+U|0,A^=m,A=A>>>24|A<<8,I=I+A|0,U^=I,U=U>>>25|U<<7,P=P+f|0,D^=P,D=D>>>24|D<<8,J=J+D|0,f^=J,f=f>>>25|f<<7;Qe.writeUint32LE(P+i|0,t,0),Qe.writeUint32LE(m+s|0,t,4),Qe.writeUint32LE(_+c|0,t,8),Qe.writeUint32LE(u+p|0,t,12),Qe.writeUint32LE(n+o|0,t,16),Qe.writeUint32LE(f+l|0,t,20),Qe.writeUint32LE(U+h|0,t,24),Qe.writeUint32LE(L+g|0,t,28),Qe.writeUint32LE(F+y|0,t,32),Qe.writeUint32LE(k+w|0,t,36),Qe.writeUint32LE(J+v|0,t,40),Qe.writeUint32LE(I+O|0,t,44),Qe.writeUint32LE(A+R|0,t,48),Qe.writeUint32LE(G+C|0,t,52),Qe.writeUint32LE(z+q|0,t,56),Qe.writeUint32LE(D+E|0,t,60)}function Ps(t,e,r,i,s){if(s===void 0&&(s=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<r.length)throw new Error("ChaCha: destination is shorter than source");var c,p;if(s===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");c=new Uint8Array(16),p=c.length-e.length,c.set(e,p)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");c=e,p=s}for(var o=new Uint8Array(64),l=0;l<r.length;l+=64){rh(o,c,t);for(var h=l;h<l+64&&h<r.length;h++)i[h]=r[h]^o[h-l];nh(c,0,p)}return _i.wipe(o),s===0&&_i.wipe(c),i}qr.streamXOR=Ps;function ih(t,e,r,i){return i===void 0&&(i=0),_i.wipe(r),Ps(t,e,r,r,i)}qr.stream=ih;function nh(t,e,r){for(var i=1;r--;)i=i+(t[e]&255)|0,t[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var As={},Ct={};Object.defineProperty(Ct,"__esModule",{value:!0});function sh(t,e,r){return~(t-1)&e|t-1&r}Ct.select=sh;function ah(t,e){return(t|0)-(e|0)-1>>>31&1}Ct.lessOrEqual=ah;function Rs(t,e){if(t.length!==e.length)return 0;for(var r=0,i=0;i<t.length;i++)r|=t[i]^e[i];return 1&r-1>>>8}Ct.compare=Rs;function oh(t,e){return t.length===0||e.length===0?!1:Rs(t,e)!==0}Ct.equal=oh;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Ct,r=ct;t.DIGEST_LENGTH=16;var i=function(){function p(o){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var l=o[0]|o[1]<<8;this._r[0]=l&8191;var h=o[2]|o[3]<<8;this._r[1]=(l>>>13|h<<3)&8191;var g=o[4]|o[5]<<8;this._r[2]=(h>>>10|g<<6)&7939;var y=o[6]|o[7]<<8;this._r[3]=(g>>>7|y<<9)&8191;var w=o[8]|o[9]<<8;this._r[4]=(y>>>4|w<<12)&255,this._r[5]=w>>>1&8190;var v=o[10]|o[11]<<8;this._r[6]=(w>>>14|v<<2)&8191;var O=o[12]|o[13]<<8;this._r[7]=(v>>>11|O<<5)&8065;var R=o[14]|o[15]<<8;this._r[8]=(O>>>8|R<<8)&8191,this._r[9]=R>>>5&127,this._pad[0]=o[16]|o[17]<<8,this._pad[1]=o[18]|o[19]<<8,this._pad[2]=o[20]|o[21]<<8,this._pad[3]=o[22]|o[23]<<8,this._pad[4]=o[24]|o[25]<<8,this._pad[5]=o[26]|o[27]<<8,this._pad[6]=o[28]|o[29]<<8,this._pad[7]=o[30]|o[31]<<8}return p.prototype._blocks=function(o,l,h){for(var g=this._fin?0:2048,y=this._h[0],w=this._h[1],v=this._h[2],O=this._h[3],R=this._h[4],C=this._h[5],q=this._h[6],E=this._h[7],P=this._h[8],m=this._h[9],_=this._r[0],u=this._r[1],n=this._r[2],f=this._r[3],U=this._r[4],L=this._r[5],F=this._r[6],k=this._r[7],J=this._r[8],I=this._r[9];h>=16;){var A=o[l+0]|o[l+1]<<8;y+=A&8191;var G=o[l+2]|o[l+3]<<8;w+=(A>>>13|G<<3)&8191;var z=o[l+4]|o[l+5]<<8;v+=(G>>>10|z<<6)&8191;var D=o[l+6]|o[l+7]<<8;O+=(z>>>7|D<<9)&8191;var j=o[l+8]|o[l+9]<<8;R+=(D>>>4|j<<12)&8191,C+=j>>>1&8191;var M=o[l+10]|o[l+11]<<8;q+=(j>>>14|M<<2)&8191;var K=o[l+12]|o[l+13]<<8;E+=(M>>>11|K<<5)&8191;var Z=o[l+14]|o[l+15]<<8;P+=(K>>>8|Z<<8)&8191,m+=Z>>>5|g;var H=0,X=H;X+=y*_,X+=w*(5*I),X+=v*(5*J),X+=O*(5*k),X+=R*(5*F),H=X>>>13,X&=8191,X+=C*(5*L),X+=q*(5*U),X+=E*(5*f),X+=P*(5*n),X+=m*(5*u),H+=X>>>13,X&=8191;var V=H;V+=y*u,V+=w*_,V+=v*(5*I),V+=O*(5*J),V+=R*(5*k),H=V>>>13,V&=8191,V+=C*(5*F),V+=q*(5*L),V+=E*(5*U),V+=P*(5*f),V+=m*(5*n),H+=V>>>13,V&=8191;var Q=H;Q+=y*n,Q+=w*u,Q+=v*_,Q+=O*(5*I),Q+=R*(5*J),H=Q>>>13,Q&=8191,Q+=C*(5*k),Q+=q*(5*F),Q+=E*(5*L),Q+=P*(5*U),Q+=m*(5*f),H+=Q>>>13,Q&=8191;var N=H;N+=y*f,N+=w*n,N+=v*u,N+=O*_,N+=R*(5*I),H=N>>>13,N&=8191,N+=C*(5*J),N+=q*(5*k),N+=E*(5*F),N+=P*(5*L),N+=m*(5*U),H+=N>>>13,N&=8191;var T=H;T+=y*U,T+=w*f,T+=v*n,T+=O*u,T+=R*_,H=T>>>13,T&=8191,T+=C*(5*I),T+=q*(5*J),T+=E*(5*k),T+=P*(5*F),T+=m*(5*L),H+=T>>>13,T&=8191;var x=H;x+=y*L,x+=w*U,x+=v*f,x+=O*n,x+=R*u,H=x>>>13,x&=8191,x+=C*_,x+=q*(5*I),x+=E*(5*J),x+=P*(5*k),x+=m*(5*F),H+=x>>>13,x&=8191;var a=H;a+=y*F,a+=w*L,a+=v*U,a+=O*f,a+=R*n,H=a>>>13,a&=8191,a+=C*u,a+=q*_,a+=E*(5*I),a+=P*(5*J),a+=m*(5*k),H+=a>>>13,a&=8191;var b=H;b+=y*k,b+=w*F,b+=v*L,b+=O*U,b+=R*f,H=b>>>13,b&=8191,b+=C*n,b+=q*u,b+=E*_,b+=P*(5*I),b+=m*(5*J),H+=b>>>13,b&=8191;var B=H;B+=y*J,B+=w*k,B+=v*F,B+=O*L,B+=R*U,H=B>>>13,B&=8191,B+=C*f,B+=q*n,B+=E*u,B+=P*_,B+=m*(5*I),H+=B>>>13,B&=8191;var W=H;W+=y*I,W+=w*J,W+=v*k,W+=O*F,W+=R*L,H=W>>>13,W&=8191,W+=C*U,W+=q*f,W+=E*n,W+=P*u,W+=m*_,H+=W>>>13,W&=8191,H=(H<<2)+H|0,H=H+X|0,X=H&8191,H=H>>>13,V+=H,y=X,w=V,v=Q,O=N,R=T,C=x,q=a,E=b,P=B,m=W,l+=16,h-=16}this._h[0]=y,this._h[1]=w,this._h[2]=v,this._h[3]=O,this._h[4]=R,this._h[5]=C,this._h[6]=q,this._h[7]=E,this._h[8]=P,this._h[9]=m},p.prototype.finish=function(o,l){l===void 0&&(l=0);var h=new Uint16Array(10),g,y,w,v;if(this._leftover){for(v=this._leftover,this._buffer[v++]=1;v<16;v++)this._buffer[v]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(g=this._h[1]>>>13,this._h[1]&=8191,v=2;v<10;v++)this._h[v]+=g,g=this._h[v]>>>13,this._h[v]&=8191;for(this._h[0]+=g*5,g=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=g,g=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=g,h[0]=this._h[0]+5,g=h[0]>>>13,h[0]&=8191,v=1;v<10;v++)h[v]=this._h[v]+g,g=h[v]>>>13,h[v]&=8191;for(h[9]-=8192,y=(g^1)-1,v=0;v<10;v++)h[v]&=y;for(y=~y,v=0;v<10;v++)this._h[v]=this._h[v]&y|h[v];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,w=this._h[0]+this._pad[0],this._h[0]=w&65535,v=1;v<8;v++)w=(this._h[v]+this._pad[v]|0)+(w>>>16)|0,this._h[v]=w&65535;return o[l+0]=this._h[0]>>>0,o[l+1]=this._h[0]>>>8,o[l+2]=this._h[1]>>>0,o[l+3]=this._h[1]>>>8,o[l+4]=this._h[2]>>>0,o[l+5]=this._h[2]>>>8,o[l+6]=this._h[3]>>>0,o[l+7]=this._h[3]>>>8,o[l+8]=this._h[4]>>>0,o[l+9]=this._h[4]>>>8,o[l+10]=this._h[5]>>>0,o[l+11]=this._h[5]>>>8,o[l+12]=this._h[6]>>>0,o[l+13]=this._h[6]>>>8,o[l+14]=this._h[7]>>>0,o[l+15]=this._h[7]>>>8,this._finished=!0,this},p.prototype.update=function(o){var l=0,h=o.length,g;if(this._leftover){g=16-this._leftover,g>h&&(g=h);for(var y=0;y<g;y++)this._buffer[this._leftover+y]=o[l+y];if(h-=g,l+=g,this._leftover+=g,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(h>=16&&(g=h-h%16,this._blocks(o,l,g),l+=g,h-=g),h){for(var y=0;y<h;y++)this._buffer[this._leftover+y]=o[l+y];this._leftover+=h}return this},p.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var o=new Uint8Array(16);return this.finish(o),o},p.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},p}();t.Poly1305=i;function s(p,o){var l=new i(p);l.update(o);var h=l.digest();return l.clean(),h}t.oneTimeAuth=s;function c(p,o){return p.length!==t.DIGEST_LENGTH||o.length!==t.DIGEST_LENGTH?!1:e.equal(p,o)}t.equal=c})(As);(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=qr,r=As,i=ct,s=re,c=Ct;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var p=new Uint8Array(16),o=function(){function l(h){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,h.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(h)}return l.prototype.seal=function(h,g,y,w){if(h.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var v=new Uint8Array(16);v.set(h,v.length-h.length);var O=new Uint8Array(32);e.stream(this._key,v,O,4);var R=g.length+this.tagLength,C;if(w){if(w.length!==R)throw new Error("ChaCha20Poly1305: incorrect destination length");C=w}else C=new Uint8Array(R);return e.streamXOR(this._key,v,g,C,4),this._authenticate(C.subarray(C.length-this.tagLength,C.length),O,C.subarray(0,C.length-this.tagLength),y),i.wipe(v),C},l.prototype.open=function(h,g,y,w){if(h.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(g.length<this.tagLength)return null;var v=new Uint8Array(16);v.set(h,v.length-h.length);var O=new Uint8Array(32);e.stream(this._key,v,O,4);var R=new Uint8Array(this.tagLength);if(this._authenticate(R,O,g.subarray(0,g.length-this.tagLength),y),!c.equal(R,g.subarray(g.length-this.tagLength,g.length)))return null;var C=g.length-this.tagLength,q;if(w){if(w.length!==C)throw new Error("ChaCha20Poly1305: incorrect destination length");q=w}else q=new Uint8Array(C);return e.streamXOR(this._key,v,g.subarray(0,g.length-this.tagLength),q,4),i.wipe(v),q},l.prototype.clean=function(){return i.wipe(this._key),this},l.prototype._authenticate=function(h,g,y,w){var v=new r.Poly1305(g);w&&(v.update(w),w.length%16>0&&v.update(p.subarray(w.length%16))),v.update(y),y.length%16>0&&v.update(p.subarray(y.length%16));var O=new Uint8Array(8);w&&s.writeUint64LE(w.length,O),v.update(O),s.writeUint64LE(y.length,O),v.update(O);for(var R=v.digest(),C=0;C<R.length;C++)h[C]=R[C];v.clean(),i.wipe(R),i.wipe(O)},l}();t.ChaCha20Poly1305=o})(Pi);var Ls={},gr={},Ai={};Object.defineProperty(Ai,"__esModule",{value:!0});function ch(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}Ai.isSerializableHash=ch;Object.defineProperty(gr,"__esModule",{value:!0});var mt=Ai,hh=Ct,fh=ct,Us=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(i).clean():i.set(r);for(var s=0;s<i.length;s++)i[s]^=54;this._inner.update(i);for(var s=0;s<i.length;s++)i[s]^=106;this._outer.update(i),mt.isSerializableHash(this._inner)&&mt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),fh.wipe(i)}return t.prototype.reset=function(){if(!mt.isSerializableHash(this._inner)||!mt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){mt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),mt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!mt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!mt.isSerializableHash(this._inner)||!mt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!mt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();gr.HMAC=Us;function uh(t,e,r){var i=new Us(t,e);i.update(r);var s=i.digest();return i.clean(),s}gr.hmac=uh;gr.equal=hh.equal;Object.defineProperty(Ls,"__esModule",{value:!0});var In=gr,On=ct,lh=function(){function t(e,r,i,s){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=s;var c=In.hmac(this._hash,i,r);this._hmac=new In.HMAC(e,c),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),i=0;i<r.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[i]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),On.wipe(this._buffer),On.wipe(this._counter),this._bufpos=0},t}(),dh=Ls.HKDF=lh,kr={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=re,r=ct;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var i=function(){function o(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return o.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},o.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},o.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},o.prototype.update=function(l,h){if(h===void 0&&(h=l.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var g=0;if(this._bytesHashed+=h,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&h>0;)this._buffer[this._bufferLength++]=l[g++],h--;this._bufferLength===this.blockSize&&(c(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(h>=this.blockSize&&(g=c(this._temp,this._state,l,g,h),h%=this.blockSize);h>0;)this._buffer[this._bufferLength++]=l[g++],h--;return this},o.prototype.finish=function(l){if(!this._finished){var h=this._bytesHashed,g=this._bufferLength,y=h/536870912|0,w=h<<3,v=h%64<56?64:128;this._buffer[g]=128;for(var O=g+1;O<v-8;O++)this._buffer[O]=0;e.writeUint32BE(y,this._buffer,v-8),e.writeUint32BE(w,this._buffer,v-4),c(this._temp,this._state,this._buffer,0,v),this._finished=!0}for(var O=0;O<this.digestLength/4;O++)e.writeUint32BE(this._state[O],l,O*4);return this},o.prototype.digest=function(){var l=new Uint8Array(this.digestLength);return this.finish(l),l},o.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},o.prototype.restoreState=function(l){return this._state.set(l.state),this._bufferLength=l.bufferLength,l.buffer&&this._buffer.set(l.buffer),this._bytesHashed=l.bytesHashed,this._finished=!1,this},o.prototype.cleanSavedState=function(l){r.wipe(l.state),l.buffer&&r.wipe(l.buffer),l.bufferLength=0,l.bytesHashed=0},o}();t.SHA256=i;var s=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function c(o,l,h,g,y){for(;y>=64;){for(var w=l[0],v=l[1],O=l[2],R=l[3],C=l[4],q=l[5],E=l[6],P=l[7],m=0;m<16;m++){var _=g+m*4;o[m]=e.readUint32BE(h,_)}for(var m=16;m<64;m++){var u=o[m-2],n=(u>>>17|u<<15)^(u>>>19|u<<13)^u>>>10;u=o[m-15];var f=(u>>>7|u<<25)^(u>>>18|u<<14)^u>>>3;o[m]=(n+o[m-7]|0)+(f+o[m-16]|0)}for(var m=0;m<64;m++){var n=(((C>>>6|C<<26)^(C>>>11|C<<21)^(C>>>25|C<<7))+(C&q^~C&E)|0)+(P+(s[m]+o[m]|0)|0)|0,f=((w>>>2|w<<30)^(w>>>13|w<<19)^(w>>>22|w<<10))+(w&v^w&O^v&O)|0;P=E,E=q,q=C,C=R+n|0,R=O,O=v,v=w,w=n+f|0}l[0]+=w,l[1]+=v,l[2]+=O,l[3]+=R,l[4]+=C,l[5]+=q,l[6]+=E,l[7]+=P,g+=64,y-=64}return g}function p(o){var l=new i;l.update(o);var h=l.digest();return l.clean(),h}t.hash=p})(kr);var Ri={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=Jt,r=ct;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function i(m){const _=new Float64Array(16);if(m)for(let u=0;u<m.length;u++)_[u]=m[u];return _}const s=new Uint8Array(32);s[0]=9;const c=i([56129,1]);function p(m){let _=1;for(let u=0;u<16;u++){let n=m[u]+_+65535;_=Math.floor(n/65536),m[u]=n-_*65536}m[0]+=_-1+37*(_-1)}function o(m,_,u){const n=~(u-1);for(let f=0;f<16;f++){const U=n&(m[f]^_[f]);m[f]^=U,_[f]^=U}}function l(m,_){const u=i(),n=i();for(let f=0;f<16;f++)n[f]=_[f];p(n),p(n),p(n);for(let f=0;f<2;f++){u[0]=n[0]-65517;for(let L=1;L<15;L++)u[L]=n[L]-65535-(u[L-1]>>16&1),u[L-1]&=65535;u[15]=n[15]-32767-(u[14]>>16&1);const U=u[15]>>16&1;u[14]&=65535,o(n,u,1-U)}for(let f=0;f<16;f++)m[2*f]=n[f]&255,m[2*f+1]=n[f]>>8}function h(m,_){for(let u=0;u<16;u++)m[u]=_[2*u]+(_[2*u+1]<<8);m[15]&=32767}function g(m,_,u){for(let n=0;n<16;n++)m[n]=_[n]+u[n]}function y(m,_,u){for(let n=0;n<16;n++)m[n]=_[n]-u[n]}function w(m,_,u){let n,f,U=0,L=0,F=0,k=0,J=0,I=0,A=0,G=0,z=0,D=0,j=0,M=0,K=0,Z=0,H=0,X=0,V=0,Q=0,N=0,T=0,x=0,a=0,b=0,B=0,W=0,he=0,be=0,ue=0,ve=0,Ue=0,Pe=0,ge=u[0],le=u[1],fe=u[2],oe=u[3],ae=u[4],se=u[5],ne=u[6],ee=u[7],ce=u[8],de=u[9],te=u[10],me=u[11],_e=u[12],Ee=u[13],xe=u[14],we=u[15];n=_[0],U+=n*ge,L+=n*le,F+=n*fe,k+=n*oe,J+=n*ae,I+=n*se,A+=n*ne,G+=n*ee,z+=n*ce,D+=n*de,j+=n*te,M+=n*me,K+=n*_e,Z+=n*Ee,H+=n*xe,X+=n*we,n=_[1],L+=n*ge,F+=n*le,k+=n*fe,J+=n*oe,I+=n*ae,A+=n*se,G+=n*ne,z+=n*ee,D+=n*ce,j+=n*de,M+=n*te,K+=n*me,Z+=n*_e,H+=n*Ee,X+=n*xe,V+=n*we,n=_[2],F+=n*ge,k+=n*le,J+=n*fe,I+=n*oe,A+=n*ae,G+=n*se,z+=n*ne,D+=n*ee,j+=n*ce,M+=n*de,K+=n*te,Z+=n*me,H+=n*_e,X+=n*Ee,V+=n*xe,Q+=n*we,n=_[3],k+=n*ge,J+=n*le,I+=n*fe,A+=n*oe,G+=n*ae,z+=n*se,D+=n*ne,j+=n*ee,M+=n*ce,K+=n*de,Z+=n*te,H+=n*me,X+=n*_e,V+=n*Ee,Q+=n*xe,N+=n*we,n=_[4],J+=n*ge,I+=n*le,A+=n*fe,G+=n*oe,z+=n*ae,D+=n*se,j+=n*ne,M+=n*ee,K+=n*ce,Z+=n*de,H+=n*te,X+=n*me,V+=n*_e,Q+=n*Ee,N+=n*xe,T+=n*we,n=_[5],I+=n*ge,A+=n*le,G+=n*fe,z+=n*oe,D+=n*ae,j+=n*se,M+=n*ne,K+=n*ee,Z+=n*ce,H+=n*de,X+=n*te,V+=n*me,Q+=n*_e,N+=n*Ee,T+=n*xe,x+=n*we,n=_[6],A+=n*ge,G+=n*le,z+=n*fe,D+=n*oe,j+=n*ae,M+=n*se,K+=n*ne,Z+=n*ee,H+=n*ce,X+=n*de,V+=n*te,Q+=n*me,N+=n*_e,T+=n*Ee,x+=n*xe,a+=n*we,n=_[7],G+=n*ge,z+=n*le,D+=n*fe,j+=n*oe,M+=n*ae,K+=n*se,Z+=n*ne,H+=n*ee,X+=n*ce,V+=n*de,Q+=n*te,N+=n*me,T+=n*_e,x+=n*Ee,a+=n*xe,b+=n*we,n=_[8],z+=n*ge,D+=n*le,j+=n*fe,M+=n*oe,K+=n*ae,Z+=n*se,H+=n*ne,X+=n*ee,V+=n*ce,Q+=n*de,N+=n*te,T+=n*me,x+=n*_e,a+=n*Ee,b+=n*xe,B+=n*we,n=_[9],D+=n*ge,j+=n*le,M+=n*fe,K+=n*oe,Z+=n*ae,H+=n*se,X+=n*ne,V+=n*ee,Q+=n*ce,N+=n*de,T+=n*te,x+=n*me,a+=n*_e,b+=n*Ee,B+=n*xe,W+=n*we,n=_[10],j+=n*ge,M+=n*le,K+=n*fe,Z+=n*oe,H+=n*ae,X+=n*se,V+=n*ne,Q+=n*ee,N+=n*ce,T+=n*de,x+=n*te,a+=n*me,b+=n*_e,B+=n*Ee,W+=n*xe,he+=n*we,n=_[11],M+=n*ge,K+=n*le,Z+=n*fe,H+=n*oe,X+=n*ae,V+=n*se,Q+=n*ne,N+=n*ee,T+=n*ce,x+=n*de,a+=n*te,b+=n*me,B+=n*_e,W+=n*Ee,he+=n*xe,be+=n*we,n=_[12],K+=n*ge,Z+=n*le,H+=n*fe,X+=n*oe,V+=n*ae,Q+=n*se,N+=n*ne,T+=n*ee,x+=n*ce,a+=n*de,b+=n*te,B+=n*me,W+=n*_e,he+=n*Ee,be+=n*xe,ue+=n*we,n=_[13],Z+=n*ge,H+=n*le,X+=n*fe,V+=n*oe,Q+=n*ae,N+=n*se,T+=n*ne,x+=n*ee,a+=n*ce,b+=n*de,B+=n*te,W+=n*me,he+=n*_e,be+=n*Ee,ue+=n*xe,ve+=n*we,n=_[14],H+=n*ge,X+=n*le,V+=n*fe,Q+=n*oe,N+=n*ae,T+=n*se,x+=n*ne,a+=n*ee,b+=n*ce,B+=n*de,W+=n*te,he+=n*me,be+=n*_e,ue+=n*Ee,ve+=n*xe,Ue+=n*we,n=_[15],X+=n*ge,V+=n*le,Q+=n*fe,N+=n*oe,T+=n*ae,x+=n*se,a+=n*ne,b+=n*ee,B+=n*ce,W+=n*de,he+=n*te,be+=n*me,ue+=n*_e,ve+=n*Ee,Ue+=n*xe,Pe+=n*we,U+=38*V,L+=38*Q,F+=38*N,k+=38*T,J+=38*x,I+=38*a,A+=38*b,G+=38*B,z+=38*W,D+=38*he,j+=38*be,M+=38*ue,K+=38*ve,Z+=38*Ue,H+=38*Pe,f=1,n=U+f+65535,f=Math.floor(n/65536),U=n-f*65536,n=L+f+65535,f=Math.floor(n/65536),L=n-f*65536,n=F+f+65535,f=Math.floor(n/65536),F=n-f*65536,n=k+f+65535,f=Math.floor(n/65536),k=n-f*65536,n=J+f+65535,f=Math.floor(n/65536),J=n-f*65536,n=I+f+65535,f=Math.floor(n/65536),I=n-f*65536,n=A+f+65535,f=Math.floor(n/65536),A=n-f*65536,n=G+f+65535,f=Math.floor(n/65536),G=n-f*65536,n=z+f+65535,f=Math.floor(n/65536),z=n-f*65536,n=D+f+65535,f=Math.floor(n/65536),D=n-f*65536,n=j+f+65535,f=Math.floor(n/65536),j=n-f*65536,n=M+f+65535,f=Math.floor(n/65536),M=n-f*65536,n=K+f+65535,f=Math.floor(n/65536),K=n-f*65536,n=Z+f+65535,f=Math.floor(n/65536),Z=n-f*65536,n=H+f+65535,f=Math.floor(n/65536),H=n-f*65536,n=X+f+65535,f=Math.floor(n/65536),X=n-f*65536,U+=f-1+37*(f-1),f=1,n=U+f+65535,f=Math.floor(n/65536),U=n-f*65536,n=L+f+65535,f=Math.floor(n/65536),L=n-f*65536,n=F+f+65535,f=Math.floor(n/65536),F=n-f*65536,n=k+f+65535,f=Math.floor(n/65536),k=n-f*65536,n=J+f+65535,f=Math.floor(n/65536),J=n-f*65536,n=I+f+65535,f=Math.floor(n/65536),I=n-f*65536,n=A+f+65535,f=Math.floor(n/65536),A=n-f*65536,n=G+f+65535,f=Math.floor(n/65536),G=n-f*65536,n=z+f+65535,f=Math.floor(n/65536),z=n-f*65536,n=D+f+65535,f=Math.floor(n/65536),D=n-f*65536,n=j+f+65535,f=Math.floor(n/65536),j=n-f*65536,n=M+f+65535,f=Math.floor(n/65536),M=n-f*65536,n=K+f+65535,f=Math.floor(n/65536),K=n-f*65536,n=Z+f+65535,f=Math.floor(n/65536),Z=n-f*65536,n=H+f+65535,f=Math.floor(n/65536),H=n-f*65536,n=X+f+65535,f=Math.floor(n/65536),X=n-f*65536,U+=f-1+37*(f-1),m[0]=U,m[1]=L,m[2]=F,m[3]=k,m[4]=J,m[5]=I,m[6]=A,m[7]=G,m[8]=z,m[9]=D,m[10]=j,m[11]=M,m[12]=K,m[13]=Z,m[14]=H,m[15]=X}function v(m,_){w(m,_,_)}function O(m,_){const u=i();for(let n=0;n<16;n++)u[n]=_[n];for(let n=253;n>=0;n--)v(u,u),n!==2&&n!==4&&w(u,u,_);for(let n=0;n<16;n++)m[n]=u[n]}function R(m,_){const u=new Uint8Array(32),n=new Float64Array(80),f=i(),U=i(),L=i(),F=i(),k=i(),J=i();for(let z=0;z<31;z++)u[z]=m[z];u[31]=m[31]&127|64,u[0]&=248,h(n,_);for(let z=0;z<16;z++)U[z]=n[z];f[0]=F[0]=1;for(let z=254;z>=0;--z){const D=u[z>>>3]>>>(z&7)&1;o(f,U,D),o(L,F,D),g(k,f,L),y(f,f,L),g(L,U,F),y(U,U,F),v(F,k),v(J,f),w(f,L,f),w(L,U,k),g(k,f,L),y(f,f,L),v(U,f),y(L,F,J),w(f,L,c),g(f,f,F),w(L,L,f),w(f,F,J),w(F,U,n),v(U,k),o(f,U,D),o(L,F,D)}for(let z=0;z<16;z++)n[z+16]=f[z],n[z+32]=L[z],n[z+48]=U[z],n[z+64]=F[z];const I=n.subarray(32),A=n.subarray(16);O(I,I),w(A,A,I);const G=new Uint8Array(32);return l(G,A),G}t.scalarMult=R;function C(m){return R(m,s)}t.scalarMultBase=C;function q(m){if(m.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const _=new Uint8Array(m);return{publicKey:C(_),secretKey:_}}t.generateKeyPairFromSeed=q;function E(m){const _=(0,e.randomBytes)(32,m),u=q(_);return(0,r.wipe)(_),u}t.generateKeyPair=E;function P(m,_,u=!1){if(m.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(_.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const n=R(m,_);if(u){let f=0;for(let U=0;U<n.length;U++)f|=n[U];if(f===0)throw new Error("X25519: invalid shared key")}return n}t.sharedKey=P})(Ri);var Ie={};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.getLocalStorage=Ie.getLocalStorageOrThrow=Ie.getCrypto=Ie.getCryptoOrThrow=Ms=Ie.getLocation=Ie.getLocationOrThrow=Li=Ie.getNavigator=Ie.getNavigatorOrThrow=Cs=Ie.getDocument=Ie.getDocumentOrThrow=Ie.getFromWindowOrThrow=Ie.getFromWindow=void 0;function Gt(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}Ie.getFromWindow=Gt;function Xt(t){const e=Gt(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}Ie.getFromWindowOrThrow=Xt;function gh(){return Xt("document")}Ie.getDocumentOrThrow=gh;function ph(){return Gt("document")}var Cs=Ie.getDocument=ph;function yh(){return Xt("navigator")}Ie.getNavigatorOrThrow=yh;function bh(){return Gt("navigator")}var Li=Ie.getNavigator=bh;function mh(){return Xt("location")}Ie.getLocationOrThrow=mh;function _h(){return Gt("location")}var Ms=Ie.getLocation=_h;function vh(){return Xt("crypto")}Ie.getCryptoOrThrow=vh;function wh(){return Gt("crypto")}Ie.getCrypto=wh;function Eh(){return Xt("localStorage")}Ie.getLocalStorageOrThrow=Eh;function xh(){return Gt("localStorage")}Ie.getLocalStorage=xh;var Ui={};Object.defineProperty(Ui,"__esModule",{value:!0});var Ds=Ui.getWindowMetadata=void 0;const Tn=Ie;function Sh(){let t,e;try{t=Tn.getDocumentOrThrow(),e=Tn.getLocationOrThrow()}catch{return null}function r(){const y=t.getElementsByTagName("link"),w=[];for(let v=0;v<y.length;v++){const O=y[v],R=O.getAttribute("rel");if(R&&R.toLowerCase().indexOf("icon")>-1){const C=O.getAttribute("href");if(C)if(C.toLowerCase().indexOf("https:")===-1&&C.toLowerCase().indexOf("http:")===-1&&C.indexOf("//")!==0){let q=e.protocol+"//"+e.host;if(C.indexOf("/")===0)q+=C;else{const E=e.pathname.split("/");E.pop();const P=E.join("/");q+=P+"/"+C}w.push(q)}else if(C.indexOf("//")===0){const q=e.protocol+C;w.push(q)}else w.push(C)}}return w}function i(...y){const w=t.getElementsByTagName("meta");for(let v=0;v<w.length;v++){const O=w[v],R=["itemprop","property","name"].map(C=>O.getAttribute(C)).filter(C=>C?y.includes(C):!1);if(R.length&&R){const C=O.getAttribute("content");if(C)return C}}return""}function s(){let y=i("name","og:site_name","og:title","twitter:title");return y||(y=t.title),y}function c(){return i("description","og:description","twitter:description","keywords")}const p=s(),o=c(),l=e.origin,h=r();return{description:o,url:l,icons:h,name:p}}Ds=Ui.getWindowMetadata=Sh;var fr={},Ih=t=>encodeURIComponent(t).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),$s="%[a-f0-9]{2}",Nn=new RegExp("("+$s+")|([^%]+?)","gi"),Pn=new RegExp("("+$s+")+","gi");function vi(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(t.length===1)return t;e=e||1;var r=t.slice(0,e),i=t.slice(e);return Array.prototype.concat.call([],vi(r),vi(i))}function Oh(t){try{return decodeURIComponent(t)}catch{for(var e=t.match(Nn)||[],r=1;r<e.length;r++)t=vi(e,r).join(""),e=t.match(Nn)||[];return t}}function Th(t){for(var e={"%FE%FF":"","%FF%FE":""},r=Pn.exec(t);r;){try{e[r[0]]=decodeURIComponent(r[0])}catch{var i=Oh(r[0]);i!==r[0]&&(e[r[0]]=i)}r=Pn.exec(t)}e["%C2"]="";for(var s=Object.keys(e),c=0;c<s.length;c++){var p=s[c];t=t.replace(new RegExp(p,"g"),e[p])}return t}var Nh=function(t){if(typeof t!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch{return Th(t)}},Ph=(t,e)=>{if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[t];const r=t.indexOf(e);return r===-1?[t]:[t.slice(0,r),t.slice(r+e.length)]},Ah=function(t,e){for(var r={},i=Object.keys(t),s=Array.isArray(e),c=0;c<i.length;c++){var p=i[c],o=t[p];(s?e.indexOf(p)!==-1:e(p,o,t))&&(r[p]=o)}return r};(function(t){const e=Ih,r=Nh,i=Ph,s=Ah,c=E=>E==null,p=Symbol("encodeFragmentIdentifier");function o(E){switch(E.arrayFormat){case"index":return P=>(m,_)=>{const u=m.length;return _===void 0||E.skipNull&&_===null||E.skipEmptyString&&_===""?m:_===null?[...m,[g(P,E),"[",u,"]"].join("")]:[...m,[g(P,E),"[",g(u,E),"]=",g(_,E)].join("")]};case"bracket":return P=>(m,_)=>_===void 0||E.skipNull&&_===null||E.skipEmptyString&&_===""?m:_===null?[...m,[g(P,E),"[]"].join("")]:[...m,[g(P,E),"[]=",g(_,E)].join("")];case"colon-list-separator":return P=>(m,_)=>_===void 0||E.skipNull&&_===null||E.skipEmptyString&&_===""?m:_===null?[...m,[g(P,E),":list="].join("")]:[...m,[g(P,E),":list=",g(_,E)].join("")];case"comma":case"separator":case"bracket-separator":{const P=E.arrayFormat==="bracket-separator"?"[]=":"=";return m=>(_,u)=>u===void 0||E.skipNull&&u===null||E.skipEmptyString&&u===""?_:(u=u===null?"":u,_.length===0?[[g(m,E),P,g(u,E)].join("")]:[[_,g(u,E)].join(E.arrayFormatSeparator)])}default:return P=>(m,_)=>_===void 0||E.skipNull&&_===null||E.skipEmptyString&&_===""?m:_===null?[...m,g(P,E)]:[...m,[g(P,E),"=",g(_,E)].join("")]}}function l(E){let P;switch(E.arrayFormat){case"index":return(m,_,u)=>{if(P=/\[(\d*)\]$/.exec(m),m=m.replace(/\[\d*\]$/,""),!P){u[m]=_;return}u[m]===void 0&&(u[m]={}),u[m][P[1]]=_};case"bracket":return(m,_,u)=>{if(P=/(\[\])$/.exec(m),m=m.replace(/\[\]$/,""),!P){u[m]=_;return}if(u[m]===void 0){u[m]=[_];return}u[m]=[].concat(u[m],_)};case"colon-list-separator":return(m,_,u)=>{if(P=/(:list)$/.exec(m),m=m.replace(/:list$/,""),!P){u[m]=_;return}if(u[m]===void 0){u[m]=[_];return}u[m]=[].concat(u[m],_)};case"comma":case"separator":return(m,_,u)=>{const n=typeof _=="string"&&_.includes(E.arrayFormatSeparator),f=typeof _=="string"&&!n&&y(_,E).includes(E.arrayFormatSeparator);_=f?y(_,E):_;const U=n||f?_.split(E.arrayFormatSeparator).map(L=>y(L,E)):_===null?_:y(_,E);u[m]=U};case"bracket-separator":return(m,_,u)=>{const n=/(\[\])$/.test(m);if(m=m.replace(/\[\]$/,""),!n){u[m]=_&&y(_,E);return}const f=_===null?[]:_.split(E.arrayFormatSeparator).map(U=>y(U,E));if(u[m]===void 0){u[m]=f;return}u[m]=[].concat(u[m],f)};default:return(m,_,u)=>{if(u[m]===void 0){u[m]=_;return}u[m]=[].concat(u[m],_)}}}function h(E){if(typeof E!="string"||E.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function g(E,P){return P.encode?P.strict?e(E):encodeURIComponent(E):E}function y(E,P){return P.decode?r(E):E}function w(E){return Array.isArray(E)?E.sort():typeof E=="object"?w(Object.keys(E)).sort((P,m)=>Number(P)-Number(m)).map(P=>E[P]):E}function v(E){const P=E.indexOf("#");return P!==-1&&(E=E.slice(0,P)),E}function O(E){let P="";const m=E.indexOf("#");return m!==-1&&(P=E.slice(m)),P}function R(E){E=v(E);const P=E.indexOf("?");return P===-1?"":E.slice(P+1)}function C(E,P){return P.parseNumbers&&!Number.isNaN(Number(E))&&typeof E=="string"&&E.trim()!==""?E=Number(E):P.parseBooleans&&E!==null&&(E.toLowerCase()==="true"||E.toLowerCase()==="false")&&(E=E.toLowerCase()==="true"),E}function q(E,P){P=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},P),h(P.arrayFormatSeparator);const m=l(P),_=Object.create(null);if(typeof E!="string"||(E=E.trim().replace(/^[?#&]/,""),!E))return _;for(const u of E.split("&")){if(u==="")continue;let[n,f]=i(P.decode?u.replace(/\+/g," "):u,"=");f=f===void 0?null:["comma","separator","bracket-separator"].includes(P.arrayFormat)?f:y(f,P),m(y(n,P),f,_)}for(const u of Object.keys(_)){const n=_[u];if(typeof n=="object"&&n!==null)for(const f of Object.keys(n))n[f]=C(n[f],P);else _[u]=C(n,P)}return P.sort===!1?_:(P.sort===!0?Object.keys(_).sort():Object.keys(_).sort(P.sort)).reduce((u,n)=>{const f=_[n];return f&&typeof f=="object"&&!Array.isArray(f)?u[n]=w(f):u[n]=f,u},Object.create(null))}t.extract=R,t.parse=q,t.stringify=(E,P)=>{if(!E)return"";P=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},P),h(P.arrayFormatSeparator);const m=f=>P.skipNull&&c(E[f])||P.skipEmptyString&&E[f]==="",_=o(P),u={};for(const f of Object.keys(E))m(f)||(u[f]=E[f]);const n=Object.keys(u);return P.sort!==!1&&n.sort(P.sort),n.map(f=>{const U=E[f];return U===void 0?"":U===null?g(f,P):Array.isArray(U)?U.length===0&&P.arrayFormat==="bracket-separator"?g(f,P)+"[]":U.reduce(_(f),[]).join("&"):g(f,P)+"="+g(U,P)}).filter(f=>f.length>0).join("&")},t.parseUrl=(E,P)=>{P=Object.assign({decode:!0},P);const[m,_]=i(E,"#");return Object.assign({url:m.split("?")[0]||"",query:q(R(E),P)},P&&P.parseFragmentIdentifier&&_?{fragmentIdentifier:y(_,P)}:{})},t.stringifyUrl=(E,P)=>{P=Object.assign({encode:!0,strict:!0,[p]:!0},P);const m=v(E.url).split("?")[0]||"",_=t.extract(E.url),u=t.parse(_,{sort:!1}),n=Object.assign(u,E.query);let f=t.stringify(n,P);f&&(f=`?${f}`);let U=O(E.url);return E.fragmentIdentifier&&(U=`#${P[p]?g(E.fragmentIdentifier,P):E.fragmentIdentifier}`),`${m}${f}${U}`},t.pick=(E,P,m)=>{m=Object.assign({parseFragmentIdentifier:!0,[p]:!1},m);const{url:_,query:u,fragmentIdentifier:n}=t.parseUrl(E,m);return t.stringifyUrl({url:_,query:s(u,P),fragmentIdentifier:n},m)},t.exclude=(E,P,m)=>{const _=Array.isArray(P)?u=>!P.includes(u):(u,n)=>!P(u,n);return t.pick(E,_,m)}})(fr);const Rh={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}},Lh=":";function Vd(t){const[e,r]=t.split(Lh);return{namespace:e,reference:r}}function Yd(t,e=[]){const r=[];return Object.keys(t).forEach(i=>{if(e.length&&!e.includes(i))return;const s=t[i];r.push(...s.accounts)}),r}function js(t,e){return t.includes(":")?[t]:e.chains||[]}const zs="base10",et="base16",wi="base64pad",Ci="utf8",Ks=0,Qt=1,Uh=0,An=1,Ei=12,Mi=32;function Ch(){const t=Ri.generateKeyPair();return{privateKey:tt(t.secretKey,et),publicKey:tt(t.publicKey,et)}}function xi(){const t=Jt.randomBytes(Mi);return tt(t,et)}function Mh(t,e){const r=Ri.sharedKey(nt(t,et),nt(e,et),!0),i=new dh(kr.SHA256,r).expand(Mi);return tt(i,et)}function Dh(t){const e=kr.hash(nt(t,et));return tt(e,et)}function Si(t){const e=kr.hash(nt(t,Ci));return tt(e,et)}function $h(t){return nt(`${t}`,zs)}function pr(t){return Number(tt(t,zs))}function jh(t){const e=$h(typeof t.type<"u"?t.type:Ks);if(pr(e)===Qt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?nt(t.senderPublicKey,et):void 0,i=typeof t.iv<"u"?nt(t.iv,et):Jt.randomBytes(Ei),s=new Pi.ChaCha20Poly1305(nt(t.symKey,et)).seal(i,nt(t.message,Ci));return Kh({type:e,sealed:s,iv:i,senderPublicKey:r})}function zh(t){const e=new Pi.ChaCha20Poly1305(nt(t.symKey,et)),{sealed:r,iv:i}=$r(t.encoded),s=e.open(i,r);if(s===null)throw new Error("Failed to decrypt");return tt(s,Ci)}function Kh(t){if(pr(t.type)===Qt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return tt(di([t.type,t.senderPublicKey,t.iv,t.sealed]),wi)}return tt(di([t.type,t.iv,t.sealed]),wi)}function $r(t){const e=nt(t,wi),r=e.slice(Uh,An),i=An;if(pr(r)===Qt){const o=i+Mi,l=o+Ei,h=e.slice(i,o),g=e.slice(o,l),y=e.slice(l);return{type:r,sealed:y,iv:g,senderPublicKey:h}}const s=i+Ei,c=e.slice(i,s),p=e.slice(s);return{type:r,sealed:p,iv:c}}function Hh(t,e){const r=$r(t);return Hs({type:pr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?tt(r.senderPublicKey,et):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Hs(t){const e=(t==null?void 0:t.type)||Ks;if(e===Qt){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function Rn(t){return t.type===Qt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var Fh=Object.defineProperty,Ln=Object.getOwnPropertySymbols,Bh=Object.prototype.hasOwnProperty,qh=Object.prototype.propertyIsEnumerable,Un=(t,e,r)=>e in t?Fh(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Cn=(t,e)=>{for(var r in e||(e={}))Bh.call(e,r)&&Un(t,r,e[r]);if(Ln)for(var r of Ln(e))qh.call(e,r)&&Un(t,r,e[r]);return t};const kh="ReactNative",ot={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Gh="js";function Di(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function yr(){return!Cs()&&!!Li()&&navigator.product===kh}function Gr(){return!Di()&&!!Li()}function br(){return yr()?ot.reactNative:Di()?ot.node:Gr()?ot.browser:ot.unknown}function Wh(t,e){let r=fr.parse(t);return r=Cn(Cn({},r),e),t=fr.stringify(r),t}function Jd(){return Ds()||{name:"",description:"",url:"",icons:[""]}}function Vh(){if(br()===ot.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const t=oo();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function Yh(){var t;const e=br();return e===ot.browser?[e,((t=Ms())==null?void 0:t.host)||"unknown"].join(":"):e}function Jh(t,e,r){const i=Vh(),s=Yh();return[[t,e].join("-"),[Gh,r].join("-"),i,s].join("/")}function Xh({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:s,projectId:c,useOnCloseEvent:p}){const o=r.split("?"),l=Jh(t,e,i),h={auth:s,ua:l,projectId:c,useOnCloseEvent:p||void 0},g=Wh(o[1]||"",h);return o[0]+"?"+g}function Bt(t,e){return t.filter(r=>e.includes(r)).length===t.length}function Fs(t){return Object.fromEntries(t.entries())}function Bs(t){return new Map(Object.entries(t))}function Qh(t=ye.FIVE_MINUTES,e){const r=ye.toMiliseconds(t||ye.FIVE_MINUTES);let i,s,c;return{resolve:p=>{c&&i&&(clearTimeout(c),i(p))},reject:p=>{c&&s&&(clearTimeout(c),s(p))},done:()=>new Promise((p,o)=>{c=setTimeout(()=>{o(new Error(e))},r),i=p,s=o})}}function ur(t,e,r){return new Promise(async(i,s)=>{const c=setTimeout(()=>s(new Error(r)),e);try{const p=await t;i(p)}catch(p){s(p)}clearTimeout(c)})}function qs(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Zh(t){return qs("topic",t)}function ef(t){return qs("id",t)}function tf(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function Lr(t,e){return ye.fromMiliseconds((e||Date.now())+ye.toMiliseconds(t))}function Mn(t){return Date.now()>=ye.toMiliseconds(t)}function ai(t,e){return`${t}${e?`:${e}`:""}`}function Xd(t=[],e=[]){return[...new Set([...t,...e])]}async function Qd({id:t,topic:e,wcDeepLink:r}){try{if(!r)return;const i=typeof r=="string"?JSON.parse(r):r;let s=i==null?void 0:i.href;if(typeof s!="string")return;s.endsWith("/")&&(s=s.slice(0,-1));const c=`${s}/wc?requestId=${t}&sessionTopic=${e}`,p=br();p===ot.browser?c.startsWith("https://")?window.open(c,"_blank","noreferrer noopener"):window.open(c,"_self","noreferrer noopener"):p===ot.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(c)}catch(i){console.error(i)}}const rf="irn";function Ii(t){return(t==null?void 0:t.relay)||{protocol:rf}}function Ur(t){const e=Rh[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var nf=Object.defineProperty,Dn=Object.getOwnPropertySymbols,sf=Object.prototype.hasOwnProperty,af=Object.prototype.propertyIsEnumerable,$n=(t,e,r)=>e in t?nf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,of=(t,e)=>{for(var r in e||(e={}))sf.call(e,r)&&$n(t,r,e[r]);if(Dn)for(var r of Dn(e))af.call(e,r)&&$n(t,r,e[r]);return t};function cf(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(i)){const c=s.replace(i,""),p=t[s];r[c]=p}}),r}function hf(t){const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),s=t.substring(e+1,r).split("@"),c=typeof r<"u"?t.substring(r):"",p=fr.parse(c);return{protocol:i,topic:ff(s[0]),version:parseInt(s[1],10),symKey:p.symKey,relay:cf(p)}}function ff(t){return t.startsWith("//")?t.substring(2):t}function uf(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(s=>{const c=r+e+s;t[s]&&(i[c]=t[s])}),i}function lf(t){return`${t.protocol}:${t.topic}@${t.version}?`+fr.stringify(of({symKey:t.symKey},uf(t.relay)))}function Zt(t){const e=[];return t.forEach(r=>{const[i,s]=r.split(":");e.push(`${i}:${s}`)}),e}function df(t){const e=[];return Object.values(t).forEach(r=>{e.push(...Zt(r.accounts))}),e}function gf(t,e){const r=[];return Object.values(t).forEach(i=>{Zt(i.accounts).includes(e)&&r.push(...i.methods)}),r}function pf(t,e){const r=[];return Object.values(t).forEach(i=>{Zt(i.accounts).includes(e)&&r.push(...i.events)}),r}function Zd(t,e){const r=Nf(t,e);if(r)throw new Error(r.message);const i={};for(const[s,c]of Object.entries(t))i[s]={methods:c.methods,events:c.events,chains:c.accounts.map(p=>`${p.split(":")[0]}:${p.split(":")[1]}`)};return i}function yf(t){return t.includes(":")}function eg(t){return yf(t)?t.split(":")[0]:t}const bf={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},mf={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function pe(t,e){const{message:r,code:i}=mf[t];return{message:e?`${r} ${e}`:r,code:i}}function yt(t,e){const{message:r,code:i}=bf[t];return{message:e?`${r} ${e}`:r,code:i}}function mr(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function ks(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function wt(t){return typeof t>"u"}function ht(t,e){return e&&wt(t)?!0:typeof t=="string"&&!!t.trim().length}function $i(t,e){return e&&wt(t)?!0:typeof t=="number"&&!isNaN(t)}function tg(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),s=Object.keys(r);let c=!0;return Bt(s,i)?(i.forEach(p=>{const{accounts:o,methods:l,events:h}=t.namespaces[p],g=Zt(o),y=r[p];(!Bt(js(p,y),g)||!Bt(y.methods,l)||!Bt(y.events,h))&&(c=!1)}),c):!1}function jr(t){return ht(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function _f(t){if(ht(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&jr(r)}}return!1}function vf(t){if(ht(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function wf(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function Ef(t){return t==null?void 0:t.topic}function rg(t,e){let r=null;return ht(t==null?void 0:t.publicKey,!1)||(r=pe("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function jn(t){let e=!0;return mr(t)?t.length&&(e=t.every(r=>ht(r,!1))):e=!1,e}function xf(t,e,r){let i=null;return mr(e)&&e.length?e.forEach(s=>{i||jr(s)||(i=yt("UNSUPPORTED_CHAINS",`${r}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):jr(t)||(i=yt("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function Sf(t,e,r){let i=null;return Object.entries(t).forEach(([s,c])=>{if(i)return;const p=xf(s,js(s,c),`${e} ${r}`);p&&(i=p)}),i}function If(t,e){let r=null;return mr(t)?t.forEach(i=>{r||_f(i)||(r=yt("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=yt("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function Of(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=If(i==null?void 0:i.accounts,`${e} namespace`);s&&(r=s)}),r}function Tf(t,e){let r=null;return jn(t==null?void 0:t.methods)?jn(t==null?void 0:t.events)||(r=yt("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=yt("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function Gs(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const s=Tf(i,`${e}, namespace`);s&&(r=s)}),r}function ig(t,e,r){let i=null;if(t&&ks(t)){const s=Gs(t,e);s&&(i=s);const c=Sf(t,e,r);c&&(i=c)}else i=pe("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function Nf(t,e){let r=null;if(t&&ks(t)){const i=Gs(t,e);i&&(r=i);const s=Of(t,e);s&&(r=s)}else r=pe("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Pf(t){return ht(t.protocol,!0)}function ng(t,e){let r=!1;return e&&!t?r=!0:t&&mr(t)&&t.length&&t.forEach(i=>{r=Pf(i)}),r}function sg(t){return typeof t=="number"}function oi(t){return typeof t<"u"&&typeof t!==null}function ag(t){return!(!t||typeof t!="object"||!t.code||!$i(t.code,!1)||!t.message||!ht(t.message,!1))}function og(t){return!(wt(t)||!ht(t.method,!1))}function cg(t){return!(wt(t)||wt(t.result)&&wt(t.error)||!$i(t.id,!1)||!ht(t.jsonrpc,!1))}function hg(t){return!(wt(t)||!ht(t.name,!1))}function fg(t,e){return!(!jr(e)||!df(t).includes(e))}function ug(t,e,r){return ht(r,!1)?gf(t,e).includes(r):!1}function lg(t,e,r){return ht(r,!1)?pf(t,e).includes(r):!1}function dg(t,e,r){let i=null;const s=Af(t),c=Rf(e),p=Object.keys(s),o=Object.keys(c),l=zn(Object.keys(t)),h=zn(Object.keys(e)),g=l.filter(y=>!h.includes(y));return g.length&&(i=pe("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${g.toString()}
      Received: ${Object.keys(e).toString()}`)),Bt(p,o)||(i=pe("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${p.toString()}
      Approved: ${o.toString()}`)),Object.keys(e).forEach(y=>{if(!y.includes(":")||i)return;const w=Zt(e[y].accounts);w.includes(y)||(i=pe("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${y}
        Required: ${y}
        Approved: ${w.toString()}`))}),p.forEach(y=>{i||(Bt(s[y].methods,c[y].methods)?Bt(s[y].events,c[y].events)||(i=pe("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${y}`)):i=pe("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${y}`))}),i}function Af(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(s=>{e[s]={methods:t[r].methods,events:t[r].events}})}),e}function zn(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function Rf(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const i=Zt(t[r].accounts);i==null||i.forEach(s=>{e[s]={accounts:t[r].accounts.filter(c=>c.includes(`${s}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function gg(t,e){return $i(t,!1)&&t<=e.max&&t>=e.min}function Kn(){const t=br();return new Promise(e=>{switch(t){case ot.browser:e(Lf());break;case ot.reactNative:e(Uf());break;case ot.node:e(Cf());break;default:e(!0)}})}function Lf(){return Gr()&&(navigator==null?void 0:navigator.onLine)}async function Uf(){if(yr()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function Cf(){return!0}function Mf(t){switch(br()){case ot.browser:Df(t);break;case ot.reactNative:$f(t);break}}function Df(t){!yr()&&Gr()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function $f(t){yr()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}const ci={};let pg=class{static get(e){return ci[e]}static set(e,r){ci[e]=r}static delete(e){delete ci[e]}};const jf="PARSE_ERROR",zf="INVALID_REQUEST",Kf="METHOD_NOT_FOUND",Hf="INVALID_PARAMS",Ws="INTERNAL_ERROR",ji="SERVER_ERROR",Ff=[-32700,-32600,-32601,-32602,-32603],hr={[jf]:{code:-32700,message:"Parse error"},[zf]:{code:-32600,message:"Invalid Request"},[Kf]:{code:-32601,message:"Method not found"},[Hf]:{code:-32602,message:"Invalid params"},[Ws]:{code:-32603,message:"Internal error"},[ji]:{code:-32e3,message:"Server error"}},Vs=ji;function Bf(t){return Ff.includes(t)}function Hn(t){return Object.keys(hr).includes(t)?hr[t]:hr[Vs]}function qf(t){const e=Object.values(hr).find(r=>r.code===t);return e||hr[Vs]}function kf(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var Ys={},It={},Fn;function Gf(){if(Fn)return It;Fn=1,Object.defineProperty(It,"__esModule",{value:!0}),It.isBrowserCryptoAvailable=It.getSubtleCrypto=It.getBrowerCrypto=void 0;function t(){return(vt===null||vt===void 0?void 0:vt.crypto)||(vt===null||vt===void 0?void 0:vt.msCrypto)||{}}It.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}It.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return It.isBrowserCryptoAvailable=r,It}var Ot={},Bn;function Wf(){if(Bn)return Ot;Bn=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.isBrowser=Ot.isNode=Ot.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Ot.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Ot.isNode=e;function r(){return!t()&&!e()}return Ot.isBrowser=r,Ot}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Et;e.__exportStar(Gf(),t),e.__exportStar(Wf(),t)})(Ys);function Js(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function Xs(t=6){return BigInt(Js(t))}function zi(t,e,r){return{id:r||Js(),jsonrpc:"2.0",method:t,params:e}}function Qs(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Zs(t,e,r){return{id:t,jsonrpc:"2.0",error:Vf(e,r)}}function Vf(t,e){return typeof t>"u"?Hn(Ws):(typeof t=="string"&&(t=Object.assign(Object.assign({},Hn(ji)),{message:t})),typeof e<"u"&&(t.data=e),Bf(t.code)&&(t=qf(t.code)),t)}class Yf{}class Jf extends Yf{constructor(){super()}}class Xf extends Jf{constructor(e){super()}}const Qf="^https?:",Zf="^wss?:";function eu(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function ea(t,e){const r=eu(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function bg(t){return ea(t,Qf)}function qn(t){return ea(t,Zf)}function tu(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function ta(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function ra(t){return ta(t)&&"method"in t}function Ki(t){return ta(t)&&(ia(t)||Wr(t))}function ia(t){return"result"in t}function Wr(t){return"error"in t}class ru extends Xf{constructor(e){super(e),this.events=new Nt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(zi(e.method,e.params||[],e.id||Xs().toString()),r)}async requestStrict(e,r){return new Promise(async(i,s)=>{if(!this.connection.connected)try{await this.open()}catch(c){s(c)}this.events.on(`${e.id}`,c=>{Wr(c)?s(c.error):i(c.result)});try{await this.connection.send(e,r)}catch(c){s(c)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Ki(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const iu=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),nu=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",kn=t=>t.split("?")[0],Gn=10,su=iu();class au{constructor(e){if(this.url=e,this.events=new Nt.EventEmitter,this.registering=!1,!qn(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(dr(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!qn(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,s)=>{this.events.once("register_error",c=>{this.resetMaxListeners(),s(c)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const s=Ys.isReactNative()?void 0:{rejectUnauthorized:!tu(e)},c=new su(e,[],s);nu()?c.onerror=p=>{const o=p;i(this.emitError(o.error))}:c.on("error",p=>{i(this.emitError(p))}),c.onopen=()=>{this.onOpen(c),r(c)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Kr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),s=i.message||i.toString(),c=Zs(e,s);this.events.emit("payload",c)}parseError(e,r=this.url){return kf(e,kn(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Gn&&this.events.setMaxListeners(Gn)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${kn(this.url)}`));return this.events.emit("register_error",r),r}}var zr={exports:{}};zr.exports;(function(t,e){var r=200,i="__lodash_hash_undefined__",s=1,c=2,p=9007199254740991,o="[object Arguments]",l="[object Array]",h="[object AsyncFunction]",g="[object Boolean]",y="[object Date]",w="[object Error]",v="[object Function]",O="[object GeneratorFunction]",R="[object Map]",C="[object Number]",q="[object Null]",E="[object Object]",P="[object Promise]",m="[object Proxy]",_="[object RegExp]",u="[object Set]",n="[object String]",f="[object Symbol]",U="[object Undefined]",L="[object WeakMap]",F="[object ArrayBuffer]",k="[object DataView]",J="[object Float32Array]",I="[object Float64Array]",A="[object Int8Array]",G="[object Int16Array]",z="[object Int32Array]",D="[object Uint8Array]",j="[object Uint8ClampedArray]",M="[object Uint16Array]",K="[object Uint32Array]",Z=/[\\^$.*+?()[\]{}|]/g,H=/^\[object .+?Constructor\]$/,X=/^(?:0|[1-9]\d*)$/,V={};V[J]=V[I]=V[A]=V[G]=V[z]=V[D]=V[j]=V[M]=V[K]=!0,V[o]=V[l]=V[F]=V[g]=V[k]=V[y]=V[w]=V[v]=V[R]=V[C]=V[E]=V[_]=V[u]=V[n]=V[L]=!1;var Q=typeof vt=="object"&&vt&&vt.Object===Object&&vt,N=typeof self=="object"&&self&&self.Object===Object&&self,T=Q||N||Function("return this")(),x=e&&!e.nodeType&&e,a=x&&!0&&t&&!t.nodeType&&t,b=a&&a.exports===x,B=b&&Q.process,W=function(){try{return B&&B.binding&&B.binding("util")}catch{}}(),he=W&&W.isTypedArray;function be(d,S){for(var $=-1,Y=d==null?0:d.length,Oe=0,ie=[];++$<Y;){var Le=d[$];S(Le,$,d)&&(ie[Oe++]=Le)}return ie}function ue(d,S){for(var $=-1,Y=S.length,Oe=d.length;++$<Y;)d[Oe+$]=S[$];return d}function ve(d,S){for(var $=-1,Y=d==null?0:d.length;++$<Y;)if(S(d[$],$,d))return!0;return!1}function Ue(d,S){for(var $=-1,Y=Array(d);++$<d;)Y[$]=S($);return Y}function Pe(d){return function(S){return d(S)}}function ge(d,S){return d.has(S)}function le(d,S){return d==null?void 0:d[S]}function fe(d){var S=-1,$=Array(d.size);return d.forEach(function(Y,Oe){$[++S]=[Oe,Y]}),$}function oe(d,S){return function($){return d(S($))}}function ae(d){var S=-1,$=Array(d.size);return d.forEach(function(Y){$[++S]=Y}),$}var se=Array.prototype,ne=Function.prototype,ee=Object.prototype,ce=T["__core-js_shared__"],de=ne.toString,te=ee.hasOwnProperty,me=function(){var d=/[^.]+$/.exec(ce&&ce.keys&&ce.keys.IE_PROTO||"");return d?"Symbol(src)_1."+d:""}(),_e=ee.toString,Ee=RegExp("^"+de.call(te).replace(Z,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xe=b?T.Buffer:void 0,we=T.Symbol,lt=T.Uint8Array,bt=ee.propertyIsEnumerable,Pt=se.splice,st=we?we.toStringTag:void 0,Mt=Object.getOwnPropertySymbols,er=xe?xe.isBuffer:void 0,vr=oe(Object.keys,Object),Ce=Wt(T,"DataView"),Ae=Wt(T,"Map"),Me=Wt(T,"Promise"),De=Wt(T,"Set"),$e=Wt(T,"WeakMap"),Re=Wt(Object,"create"),Ke=$t(Ce),He=$t(Ae),Fe=$t(Me),Be=$t(De),qe=$t($e),ze=we?we.prototype:void 0,je=ze?ze.valueOf:void 0;function Te(d){var S=-1,$=d==null?0:d.length;for(this.clear();++S<$;){var Y=d[S];this.set(Y[0],Y[1])}}function ke(){this.__data__=Re?Re(null):{},this.size=0}function Ge(d){var S=this.has(d)&&delete this.__data__[d];return this.size-=S?1:0,S}function ba(d){var S=this.__data__;if(Re){var $=S[d];return $===i?void 0:$}return te.call(S,d)?S[d]:void 0}function ma(d){var S=this.__data__;return Re?S[d]!==void 0:te.call(S,d)}function _a(d,S){var $=this.__data__;return this.size+=this.has(d)?0:1,$[d]=Re&&S===void 0?i:S,this}Te.prototype.clear=ke,Te.prototype.delete=Ge,Te.prototype.get=ba,Te.prototype.has=ma,Te.prototype.set=_a;function xt(d){var S=-1,$=d==null?0:d.length;for(this.clear();++S<$;){var Y=d[S];this.set(Y[0],Y[1])}}function va(){this.__data__=[],this.size=0}function wa(d){var S=this.__data__,$=Er(S,d);if($<0)return!1;var Y=S.length-1;return $==Y?S.pop():Pt.call(S,$,1),--this.size,!0}function Ea(d){var S=this.__data__,$=Er(S,d);return $<0?void 0:S[$][1]}function xa(d){return Er(this.__data__,d)>-1}function Sa(d,S){var $=this.__data__,Y=Er($,d);return Y<0?(++this.size,$.push([d,S])):$[Y][1]=S,this}xt.prototype.clear=va,xt.prototype.delete=wa,xt.prototype.get=Ea,xt.prototype.has=xa,xt.prototype.set=Sa;function Dt(d){var S=-1,$=d==null?0:d.length;for(this.clear();++S<$;){var Y=d[S];this.set(Y[0],Y[1])}}function Ia(){this.size=0,this.__data__={hash:new Te,map:new(Ae||xt),string:new Te}}function Oa(d){var S=xr(this,d).delete(d);return this.size-=S?1:0,S}function Ta(d){return xr(this,d).get(d)}function Na(d){return xr(this,d).has(d)}function Pa(d,S){var $=xr(this,d),Y=$.size;return $.set(d,S),this.size+=$.size==Y?0:1,this}Dt.prototype.clear=Ia,Dt.prototype.delete=Oa,Dt.prototype.get=Ta,Dt.prototype.has=Na,Dt.prototype.set=Pa;function wr(d){var S=-1,$=d==null?0:d.length;for(this.__data__=new Dt;++S<$;)this.add(d[S])}function Aa(d){return this.__data__.set(d,i),this}function Ra(d){return this.__data__.has(d)}wr.prototype.add=wr.prototype.push=Aa,wr.prototype.has=Ra;function At(d){var S=this.__data__=new xt(d);this.size=S.size}function La(){this.__data__=new xt,this.size=0}function Ua(d){var S=this.__data__,$=S.delete(d);return this.size=S.size,$}function Ca(d){return this.__data__.get(d)}function Ma(d){return this.__data__.has(d)}function Da(d,S){var $=this.__data__;if($ instanceof xt){var Y=$.__data__;if(!Ae||Y.length<r-1)return Y.push([d,S]),this.size=++$.size,this;$=this.__data__=new Dt(Y)}return $.set(d,S),this.size=$.size,this}At.prototype.clear=La,At.prototype.delete=Ua,At.prototype.get=Ca,At.prototype.has=Ma,At.prototype.set=Da;function $a(d,S){var $=Sr(d),Y=!$&&Qa(d),Oe=!$&&!Y&&Yr(d),ie=!$&&!Y&&!Oe&&Xi(d),Le=$||Y||Oe||ie,We=Le?Ue(d.length,String):[],Ye=We.length;for(var Ne in d)(S||te.call(d,Ne))&&!(Le&&(Ne=="length"||Oe&&(Ne=="offset"||Ne=="parent")||ie&&(Ne=="buffer"||Ne=="byteLength"||Ne=="byteOffset")||Wa(Ne,Ye)))&&We.push(Ne);return We}function Er(d,S){for(var $=d.length;$--;)if(Wi(d[$][0],S))return $;return-1}function ja(d,S,$){var Y=S(d);return Sr(d)?Y:ue(Y,$(d))}function tr(d){return d==null?d===void 0?U:q:st&&st in Object(d)?ka(d):Xa(d)}function Bi(d){return rr(d)&&tr(d)==o}function qi(d,S,$,Y,Oe){return d===S?!0:d==null||S==null||!rr(d)&&!rr(S)?d!==d&&S!==S:za(d,S,$,Y,qi,Oe)}function za(d,S,$,Y,Oe,ie){var Le=Sr(d),We=Sr(S),Ye=Le?l:Rt(d),Ne=We?l:Rt(S);Ye=Ye==o?E:Ye,Ne=Ne==o?E:Ne;var at=Ye==E,dt=Ne==E,Xe=Ye==Ne;if(Xe&&Yr(d)){if(!Yr(S))return!1;Le=!0,at=!1}if(Xe&&!at)return ie||(ie=new At),Le||Xi(d)?ki(d,S,$,Y,Oe,ie):Ba(d,S,Ye,$,Y,Oe,ie);if(!($&s)){var ft=at&&te.call(d,"__wrapped__"),ut=dt&&te.call(S,"__wrapped__");if(ft||ut){var Lt=ft?d.value():d,St=ut?S.value():S;return ie||(ie=new At),Oe(Lt,St,$,Y,ie)}}return Xe?(ie||(ie=new At),qa(d,S,$,Y,Oe,ie)):!1}function Ka(d){if(!Ji(d)||Ya(d))return!1;var S=Vi(d)?Ee:H;return S.test($t(d))}function Ha(d){return rr(d)&&Yi(d.length)&&!!V[tr(d)]}function Fa(d){if(!Ja(d))return vr(d);var S=[];for(var $ in Object(d))te.call(d,$)&&$!="constructor"&&S.push($);return S}function ki(d,S,$,Y,Oe,ie){var Le=$&s,We=d.length,Ye=S.length;if(We!=Ye&&!(Le&&Ye>We))return!1;var Ne=ie.get(d);if(Ne&&ie.get(S))return Ne==S;var at=-1,dt=!0,Xe=$&c?new wr:void 0;for(ie.set(d,S),ie.set(S,d);++at<We;){var ft=d[at],ut=S[at];if(Y)var Lt=Le?Y(ut,ft,at,S,d,ie):Y(ft,ut,at,d,S,ie);if(Lt!==void 0){if(Lt)continue;dt=!1;break}if(Xe){if(!ve(S,function(St,jt){if(!ge(Xe,jt)&&(ft===St||Oe(ft,St,$,Y,ie)))return Xe.push(jt)})){dt=!1;break}}else if(!(ft===ut||Oe(ft,ut,$,Y,ie))){dt=!1;break}}return ie.delete(d),ie.delete(S),dt}function Ba(d,S,$,Y,Oe,ie,Le){switch($){case k:if(d.byteLength!=S.byteLength||d.byteOffset!=S.byteOffset)return!1;d=d.buffer,S=S.buffer;case F:return!(d.byteLength!=S.byteLength||!ie(new lt(d),new lt(S)));case g:case y:case C:return Wi(+d,+S);case w:return d.name==S.name&&d.message==S.message;case _:case n:return d==S+"";case R:var We=fe;case u:var Ye=Y&s;if(We||(We=ae),d.size!=S.size&&!Ye)return!1;var Ne=Le.get(d);if(Ne)return Ne==S;Y|=c,Le.set(d,S);var at=ki(We(d),We(S),Y,Oe,ie,Le);return Le.delete(d),at;case f:if(je)return je.call(d)==je.call(S)}return!1}function qa(d,S,$,Y,Oe,ie){var Le=$&s,We=Gi(d),Ye=We.length,Ne=Gi(S),at=Ne.length;if(Ye!=at&&!Le)return!1;for(var dt=Ye;dt--;){var Xe=We[dt];if(!(Le?Xe in S:te.call(S,Xe)))return!1}var ft=ie.get(d);if(ft&&ie.get(S))return ft==S;var ut=!0;ie.set(d,S),ie.set(S,d);for(var Lt=Le;++dt<Ye;){Xe=We[dt];var St=d[Xe],jt=S[Xe];if(Y)var Qi=Le?Y(jt,St,Xe,S,d,ie):Y(St,jt,Xe,d,S,ie);if(!(Qi===void 0?St===jt||Oe(St,jt,$,Y,ie):Qi)){ut=!1;break}Lt||(Lt=Xe=="constructor")}if(ut&&!Lt){var Ir=d.constructor,Or=S.constructor;Ir!=Or&&"constructor"in d&&"constructor"in S&&!(typeof Ir=="function"&&Ir instanceof Ir&&typeof Or=="function"&&Or instanceof Or)&&(ut=!1)}return ie.delete(d),ie.delete(S),ut}function Gi(d){return ja(d,to,Ga)}function xr(d,S){var $=d.__data__;return Va(S)?$[typeof S=="string"?"string":"hash"]:$.map}function Wt(d,S){var $=le(d,S);return Ka($)?$:void 0}function ka(d){var S=te.call(d,st),$=d[st];try{d[st]=void 0;var Y=!0}catch{}var Oe=_e.call(d);return Y&&(S?d[st]=$:delete d[st]),Oe}var Ga=Mt?function(d){return d==null?[]:(d=Object(d),be(Mt(d),function(S){return bt.call(d,S)}))}:ro,Rt=tr;(Ce&&Rt(new Ce(new ArrayBuffer(1)))!=k||Ae&&Rt(new Ae)!=R||Me&&Rt(Me.resolve())!=P||De&&Rt(new De)!=u||$e&&Rt(new $e)!=L)&&(Rt=function(d){var S=tr(d),$=S==E?d.constructor:void 0,Y=$?$t($):"";if(Y)switch(Y){case Ke:return k;case He:return R;case Fe:return P;case Be:return u;case qe:return L}return S});function Wa(d,S){return S=S??p,!!S&&(typeof d=="number"||X.test(d))&&d>-1&&d%1==0&&d<S}function Va(d){var S=typeof d;return S=="string"||S=="number"||S=="symbol"||S=="boolean"?d!=="__proto__":d===null}function Ya(d){return!!me&&me in d}function Ja(d){var S=d&&d.constructor,$=typeof S=="function"&&S.prototype||ee;return d===$}function Xa(d){return _e.call(d)}function $t(d){if(d!=null){try{return de.call(d)}catch{}try{return d+""}catch{}}return""}function Wi(d,S){return d===S||d!==d&&S!==S}var Qa=Bi(function(){return arguments}())?Bi:function(d){return rr(d)&&te.call(d,"callee")&&!bt.call(d,"callee")},Sr=Array.isArray;function Za(d){return d!=null&&Yi(d.length)&&!Vi(d)}var Yr=er||io;function eo(d,S){return qi(d,S)}function Vi(d){if(!Ji(d))return!1;var S=tr(d);return S==v||S==O||S==h||S==m}function Yi(d){return typeof d=="number"&&d>-1&&d%1==0&&d<=p}function Ji(d){var S=typeof d;return d!=null&&(S=="object"||S=="function")}function rr(d){return d!=null&&typeof d=="object"}var Xi=he?Pe(he):Ha;function to(d){return Za(d)?$a(d):Fa(d)}function ro(){return[]}function io(){return!1}t.exports=eo})(zr,zr.exports);var ou=zr.exports;const cu=co(ou);var hu={};function fu(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var c=t.charAt(s),p=c.charCodeAt(0);if(r[p]!==255)throw new TypeError(c+" is ambiguous");r[p]=s}var o=t.length,l=t.charAt(0),h=Math.log(o)/Math.log(256),g=Math.log(256)/Math.log(o);function y(O){if(O instanceof Uint8Array||(ArrayBuffer.isView(O)?O=new Uint8Array(O.buffer,O.byteOffset,O.byteLength):Array.isArray(O)&&(O=Uint8Array.from(O))),!(O instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(O.length===0)return"";for(var R=0,C=0,q=0,E=O.length;q!==E&&O[q]===0;)q++,R++;for(var P=(E-q)*g+1>>>0,m=new Uint8Array(P);q!==E;){for(var _=O[q],u=0,n=P-1;(_!==0||u<C)&&n!==-1;n--,u++)_+=256*m[n]>>>0,m[n]=_%o>>>0,_=_/o>>>0;if(_!==0)throw new Error("Non-zero carry");C=u,q++}for(var f=P-C;f!==P&&m[f]===0;)f++;for(var U=l.repeat(R);f<P;++f)U+=t.charAt(m[f]);return U}function w(O){if(typeof O!="string")throw new TypeError("Expected String");if(O.length===0)return new Uint8Array;var R=0;if(O[R]!==" "){for(var C=0,q=0;O[R]===l;)C++,R++;for(var E=(O.length-R)*h+1>>>0,P=new Uint8Array(E);O[R];){var m=r[O.charCodeAt(R)];if(m===255)return;for(var _=0,u=E-1;(m!==0||_<q)&&u!==-1;u--,_++)m+=o*P[u]>>>0,P[u]=m%256>>>0,m=m/256>>>0;if(m!==0)throw new Error("Non-zero carry");q=_,R++}if(O[R]!==" "){for(var n=E-q;n!==E&&P[n]===0;)n++;for(var f=new Uint8Array(C+(E-n)),U=C;n!==E;)f[U++]=P[n++];return f}}}function v(O){var R=w(O);if(R)return R;throw new Error(`Non-${e} character`)}return{encode:y,decodeUnsafe:w,decode:v}}var uu=fu,lu=uu;const na=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},du=t=>new TextEncoder().encode(t),gu=t=>new TextDecoder().decode(t);class pu{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class yu{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return sa(this,e)}}class bu{constructor(e){this.decoders=e}or(e){return sa(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const sa=(t,e)=>new bu({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class mu{constructor(e,r,i,s){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=s,this.encoder=new pu(e,r,i),this.decoder=new yu(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Vr=({name:t,prefix:e,encode:r,decode:i})=>new mu(t,e,r,i),_r=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:s}=lu(r,e);return Vr({prefix:t,name:e,encode:i,decode:c=>na(s(c))})},_u=(t,e,r,i)=>{const s={};for(let g=0;g<e.length;++g)s[e[g]]=g;let c=t.length;for(;t[c-1]==="=";)--c;const p=new Uint8Array(c*r/8|0);let o=0,l=0,h=0;for(let g=0;g<c;++g){const y=s[t[g]];if(y===void 0)throw new SyntaxError(`Non-${i} character`);l=l<<r|y,o+=r,o>=8&&(o-=8,p[h++]=255&l>>o)}if(o>=r||255&l<<8-o)throw new SyntaxError("Unexpected end of data");return p},vu=(t,e,r)=>{const i=e[e.length-1]==="=",s=(1<<r)-1;let c="",p=0,o=0;for(let l=0;l<t.length;++l)for(o=o<<8|t[l],p+=8;p>r;)p-=r,c+=e[s&o>>p];if(p&&(c+=e[s&o<<r-p]),i)for(;c.length*r&7;)c+="=";return c},Je=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Vr({prefix:e,name:t,encode(s){return vu(s,i,r)},decode(s){return _u(s,i,r,t)}}),wu=Vr({prefix:"\0",name:"identity",encode:t=>gu(t),decode:t=>du(t)});var Eu=Object.freeze({__proto__:null,identity:wu});const xu=Je({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Su=Object.freeze({__proto__:null,base2:xu});const Iu=Je({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Ou=Object.freeze({__proto__:null,base8:Iu});const Tu=_r({prefix:"9",name:"base10",alphabet:"0123456789"});var Nu=Object.freeze({__proto__:null,base10:Tu});const Pu=Je({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Au=Je({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Ru=Object.freeze({__proto__:null,base16:Pu,base16upper:Au});const Lu=Je({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Uu=Je({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Cu=Je({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Mu=Je({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Du=Je({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),$u=Je({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ju=Je({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),zu=Je({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Ku=Je({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Hu=Object.freeze({__proto__:null,base32:Lu,base32upper:Uu,base32pad:Cu,base32padupper:Mu,base32hex:Du,base32hexupper:$u,base32hexpad:ju,base32hexpadupper:zu,base32z:Ku});const Fu=_r({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Bu=_r({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var qu=Object.freeze({__proto__:null,base36:Fu,base36upper:Bu});const ku=_r({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Gu=_r({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Wu=Object.freeze({__proto__:null,base58btc:ku,base58flickr:Gu});const Vu=Je({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Yu=Je({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ju=Je({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Xu=Je({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Qu=Object.freeze({__proto__:null,base64:Vu,base64pad:Yu,base64url:Ju,base64urlpad:Xu});const aa=Array.from(""),Zu=aa.reduce((t,e,r)=>(t[r]=e,t),[]),el=aa.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function tl(t){return t.reduce((e,r)=>(e+=Zu[r],e),"")}function rl(t){const e=[];for(const r of t){const i=el[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const il=Vr({prefix:"",name:"base256emoji",encode:tl,decode:rl});var nl=Object.freeze({__proto__:null,base256emoji:il}),sl=oa,Wn=128,al=127,ol=~al,cl=Math.pow(2,31);function oa(t,e,r){e=e||[],r=r||0;for(var i=r;t>=cl;)e[r++]=t&255|Wn,t/=128;for(;t&ol;)e[r++]=t&255|Wn,t>>>=7;return e[r]=t|0,oa.bytes=r-i+1,e}var hl=Oi,fl=128,Vn=127;function Oi(t,i){var r=0,i=i||0,s=0,c=i,p,o=t.length;do{if(c>=o)throw Oi.bytes=0,new RangeError("Could not decode varint");p=t[c++],r+=s<28?(p&Vn)<<s:(p&Vn)*Math.pow(2,s),s+=7}while(p>=fl);return Oi.bytes=c-i,r}var ul=Math.pow(2,7),ll=Math.pow(2,14),dl=Math.pow(2,21),gl=Math.pow(2,28),pl=Math.pow(2,35),yl=Math.pow(2,42),bl=Math.pow(2,49),ml=Math.pow(2,56),_l=Math.pow(2,63),vl=function(t){return t<ul?1:t<ll?2:t<dl?3:t<gl?4:t<pl?5:t<yl?6:t<bl?7:t<ml?8:t<_l?9:10},wl={encode:sl,decode:hl,encodingLength:vl},ca=wl;const Yn=(t,e,r=0)=>(ca.encode(t,e,r),e),Jn=t=>ca.encodingLength(t),Ti=(t,e)=>{const r=e.byteLength,i=Jn(t),s=i+Jn(r),c=new Uint8Array(s+r);return Yn(t,c,0),Yn(r,c,i),c.set(e,s),new El(t,r,e,c)};class El{constructor(e,r,i,s){this.code=e,this.size=r,this.digest=i,this.bytes=s}}const ha=({name:t,code:e,encode:r})=>new xl(t,e,r);class xl{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Ti(this.code,r):r.then(i=>Ti(this.code,i))}else throw Error("Unknown type, must be binary type")}}const fa=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Sl=ha({name:"sha2-256",code:18,encode:fa("SHA-256")}),Il=ha({name:"sha2-512",code:19,encode:fa("SHA-512")});var Ol=Object.freeze({__proto__:null,sha256:Sl,sha512:Il});const ua=0,Tl="identity",la=na,Nl=t=>Ti(ua,la(t)),Pl={code:ua,name:Tl,encode:la,digest:Nl};var Al=Object.freeze({__proto__:null,identity:Pl});new TextEncoder,new TextDecoder;const Xn={...Eu,...Su,...Ou,...Nu,...Ru,...Hu,...qu,...Wu,...Qu,...nl};({...Ol,...Al});function da(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Rl(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?da(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ga(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Qn=ga("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),hi=ga("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Rl(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Ll={utf8:Qn,"utf-8":Qn,hex:Xn.base16,latin1:hi,ascii:hi,binary:hi,...Xn};function Ul(t,e="utf8"){const r=Ll[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?da(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}const pa="wc",Cl=2,Hi="core",Ut=`${pa}@2:${Hi}:`,Ml={name:Hi,logger:"error"},Dl={database:":memory:"},$l="crypto",Zn="client_ed25519_seed",jl=ye.ONE_DAY,zl="keychain",Kl="0.3",Hl="messages",Fl="0.3",Bl=ye.SIX_HOURS,ql="publisher",kl="irn",Gl="error",ya="wss://relay.walletconnect.com",es="wss://relay.walletconnect.org",Wl="relayer",it={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Vl="_subscription",Tt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Yl=ye.ONE_SECOND,Jl="2.10.2",Xl=1e4,Ql="0.3",Zl="WALLETCONNECT_CLIENT_ID",pt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},ed="subscription",td="0.3",rd=ye.FIVE_SECONDS*1e3,id="pairing",nd="0.3",or={wc_pairingDelete:{req:{ttl:ye.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ye.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ye.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ye.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ye.ONE_DAY,prompt:!1,tag:0},res:{ttl:ye.ONE_DAY,prompt:!1,tag:0}}},Pr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},_t={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},sd="history",ad="0.3",od="expirer",gt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},cd="0.3",fi="verify-api",ui="https://verify.walletconnect.com",ts="https://verify.walletconnect.org";class hd{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=zl,this.version=Kl,this.initialized=!1,this.storagePrefix=Ut,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,s)=>{this.isInitialized(),this.keychain.set(i,s),await this.persist()},this.get=i=>{this.isInitialized();const s=this.keychain.get(i);if(typeof s>"u"){const{message:c}=pe("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(c)}return s},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Fs(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Bs(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=pe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class fd{constructor(e,r,i){this.core=e,this.logger=r,this.name=$l,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),c=Sn(s);return Ns(c.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=Ch();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const c=await this.getClientSeed(),p=Sn(c),o=xi();return await eh(o,s,jl,p)},this.generateSharedKey=(s,c,p)=>{this.isInitialized();const o=this.getPrivateKey(s),l=Mh(o,c);return this.setSymKey(l,p)},this.setSymKey=async(s,c)=>{this.isInitialized();const p=c||Dh(s);return await this.keychain.set(p,s),p},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,c,p)=>{this.isInitialized();const o=Hs(p),l=dr(c);if(Rn(o)){const w=o.senderPublicKey,v=o.receiverPublicKey;s=await this.generateSharedKey(w,v)}const h=this.getSymKey(s),{type:g,senderPublicKey:y}=o;return jh({type:g,symKey:h,message:l,senderPublicKey:y})},this.decode=async(s,c,p)=>{this.isInitialized();const o=Hh(c,p);if(Rn(o)){const l=o.receiverPublicKey,h=o.senderPublicKey;s=await this.generateSharedKey(l,h)}try{const l=this.getSymKey(s),h=zh({symKey:l,encoded:c});return Kr(h)}catch(l){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(l)}},this.getPayloadType=s=>{const c=$r(s);return pr(c.type)},this.getPayloadSenderPublicKey=s=>{const c=$r(s);return c.senderPublicKey?tt(c.senderPublicKey,et):void 0},this.core=e,this.logger=Se.generateChildLogger(r,this.name),this.keychain=i||new hd(this.core,this.logger)}get context(){return Se.getLoggerContext(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Zn)}catch{e=xi(),await this.keychain.set(Zn,e)}return Ul(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=pe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class ud extends ac{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=Hl,this.version=Fl,this.initialized=!1,this.storagePrefix=Ut,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,s)=>{this.isInitialized();const c=Si(s);let p=this.messages.get(i);return typeof p>"u"&&(p={}),typeof p[c]<"u"||(p[c]=s,this.messages.set(i,p),await this.persist()),c},this.get=i=>{this.isInitialized();let s=this.messages.get(i);return typeof s>"u"&&(s={}),s},this.has=(i,s)=>{this.isInitialized();const c=this.get(i),p=Si(s);return typeof c[p]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=Se.generateChildLogger(e,this.name),this.core=r}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Fs(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Bs(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=pe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class ld extends oc{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new Nt.EventEmitter,this.name=ql,this.queue=new Map,this.publishTimeout=ye.toMiliseconds(ye.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(i,s,c)=>{var p;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:c}});try{const o=(c==null?void 0:c.ttl)||Bl,l=Ii(c),h=(c==null?void 0:c.prompt)||!1,g=(c==null?void 0:c.tag)||0,y=(c==null?void 0:c.id)||Xs().toString(),w={topic:i,message:s,opts:{ttl:o,relay:l,prompt:h,tag:g,id:y}},v=setTimeout(()=>this.queue.set(y,w),this.publishTimeout);try{await await ur(this.rpcPublish(i,s,o,l,h,g,y),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(y),this.relayer.events.emit(it.publish,w)}catch(O){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(p=c==null?void 0:c.internal)!=null&&p.throwOnFailedPublish)throw this.removeRequestFromQueue(y),O;return}finally{clearTimeout(v)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:s,opts:c}})}catch(o){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(o),o}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.relayer=e,this.logger=Se.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Se.getLoggerContext(this.logger)}rpcPublish(e,r,i,s,c,p,o){var l,h,g,y;const w={method:Ur(s.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:c,tag:p},id:o};return wt((l=w.params)==null?void 0:l.prompt)&&((h=w.params)==null||delete h.prompt),wt((g=w.params)==null?void 0:g.tag)&&((y=w.params)==null||delete y.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:w}),this.relayer.request(w)}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:s}=e;await this.publish(r,i,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(Yt.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(it.connection_stalled);return}this.checkQueue()}),this.relayer.on(it.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}class dd{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const s=i.filter(c=>c!==r);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var gd=Object.defineProperty,pd=Object.defineProperties,yd=Object.getOwnPropertyDescriptors,rs=Object.getOwnPropertySymbols,bd=Object.prototype.hasOwnProperty,md=Object.prototype.propertyIsEnumerable,is=(t,e,r)=>e in t?gd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,cr=(t,e)=>{for(var r in e||(e={}))bd.call(e,r)&&is(t,r,e[r]);if(rs)for(var r of rs(e))md.call(e,r)&&is(t,r,e[r]);return t},li=(t,e)=>pd(t,yd(e));class _d extends fc{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new dd,this.events=new Nt.EventEmitter,this.name=ed,this.version=td,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Ut,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(i,s)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}});try{const c=Ii(s),p={topic:i,relay:c};this.pending.set(i,p);const o=await this.rpcSubscribe(i,c);return this.onSubscribe(o,p),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:s}}),o}catch(c){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(c),c}},this.unsubscribe=async(i,s)=>{await this.restartToComplete(),this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(i,s.id,s):await this.unsubscribeByTopic(i,s)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((s,c)=>{const p=new ye.Watch;p.start(this.pendingSubscriptionWatchLabel);const o=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(o),p.stop(this.pendingSubscriptionWatchLabel),s(!0)),p.elapsed(this.pendingSubscriptionWatchLabel)>=rd&&(clearInterval(o),p.stop(this.pendingSubscriptionWatchLabel),c(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=Se.generateChildLogger(r,this.name),this.clientId=""}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async s=>await this.unsubscribeById(e,s,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const s=Ii(i);await this.rpcUnsubscribe(e,r,s);const c=yt("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,c),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,r){const i={method:Ur(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await ur(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(it.connection_stalled)}return Si(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:Ur(r.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await await ur(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(it.connection_stalled)}}rpcUnsubscribe(e,r,i){const s={method:Ur(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,r){this.setSubscription(e,li(cr({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,cr({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,cr({},r)),this.topicMap.set(r.topic,e),this.events.emit(pt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=pe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(pt.deleted,li(cr({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(pt.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<e;r++){const i=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(pt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=pe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const r=await this.rpcBatchSubscribe(e);mr(r)&&this.onBatchSubscribe(r.map((i,s)=>li(cr({},e[s]),{id:i})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(r=>{e.push(r)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(Yt.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(it.connect,async()=>{await this.onConnect()}),this.relayer.on(it.disconnect,()=>{this.onDisconnect()}),this.events.on(pt.created,async e=>{const r=pt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(pt.deleted,async e=>{const r=pt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=pe("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),e())},this.pollingInterval)})}}var vd=Object.defineProperty,ns=Object.getOwnPropertySymbols,wd=Object.prototype.hasOwnProperty,Ed=Object.prototype.propertyIsEnumerable,ss=(t,e,r)=>e in t?vd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xd=(t,e)=>{for(var r in e||(e={}))wd.call(e,r)&&ss(t,r,e[r]);if(ns)for(var r of ns(e))Ed.call(e,r)&&ss(t,r,e[r]);return t};class Sd extends cc{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new Nt.EventEmitter,this.name=Wl,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(i){throw this.logger.debug("Failed to Publish Request"),this.logger.error(i),i}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(it.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(it.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(Tt.payload,this.onPayloadHandler),this.provider.on(Tt.connect,this.onConnectHandler),this.provider.on(Tt.disconnect,this.onDisconnectHandler),this.provider.on(Tt.error,this.onProviderErrorHandler)},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Se.generateChildLogger(e.logger,this.name):Se.pino(Se.getDefaultLoggerOptions({level:e.logger||Gl})),this.messages=new ud(this.logger,e.core),this.subscriber=new _d(this,this.logger),this.publisher=new ld(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||ya,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${es}...`),await this.restartTransport(es)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Xl)}get context(){return Se.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now()})}async subscribe(e,r){var i;this.isInitialized();let s=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"";if(s)return s;let c;const p=o=>{o.topic===e&&(this.subscriber.off(pt.created,p),c())};return await Promise.all([new Promise(o=>{c=o,this.subscriber.on(pt.created,p)}),new Promise(async o=>{s=await this.subscriber.subscribe(e,r),o()})]),s}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await ur(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(e){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(pt.resubscribed,()=>{r()})}),new Promise(async(r,i)=>{try{await ur(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(s){i(s);return}r()})])}catch(r){this.logger.error(r);const i=r;if(!this.isConnectionStalled(i.message))throw r;this.provider.events.emit(Tt.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(e){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Kn())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(e){return this.staleConnectionErrors.some(r=>e.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new ru(new au(Xh({sdkVersion:Jl,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const s=this.messages.has(r,i);return s&&this.logger.debug(`Ignoring duplicate message: ${i}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),ra(e)){if(!e.method.endsWith(Vl))return;const r=e.params,{topic:i,message:s,publishedAt:c}=r.data,p={topic:i,message:s,publishedAt:c};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(xd({type:"event",event:r.id},p)),this.events.emit(r.id,p),await this.acknowledgePayload(e),await this.onMessageEvent(p)}else Ki(e)&&this.events.emit(it.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(it.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=Qs(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(Tt.payload,this.onPayloadHandler),this.provider.off(Tt.connect,this.onConnectHandler),this.provider.off(Tt.disconnect,this.onDisconnectHandler),this.provider.off(Tt.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(it.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let e=await Kn();Mf(async r=>{this.initialized&&e!==r&&(e=r,r?await this.restartTransport().catch(i=>this.logger.error(i)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(i=>this.logger.error(i))))})}onProviderDisconnect(){this.events.emit(it.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(e=>this.logger.error(e))},ye.toMiliseconds(Yl)))}isInitialized(){if(!this.initialized){const{message:e}=pe("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(e=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var Id=Object.defineProperty,as=Object.getOwnPropertySymbols,Od=Object.prototype.hasOwnProperty,Td=Object.prototype.propertyIsEnumerable,os=(t,e,r)=>e in t?Id(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,cs=(t,e)=>{for(var r in e||(e={}))Od.call(e,r)&&os(t,r,e[r]);if(as)for(var r of as(e))Td.call(e,r)&&os(t,r,e[r]);return t};class Nd extends hc{constructor(e,r,i,s=Ut,c=void 0){super(e,r,i,s),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=Ql,this.cached=[],this.initialized=!1,this.storagePrefix=Ut,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(p=>{this.getKey&&p!==null&&!wt(p)?this.map.set(this.getKey(p),p):wf(p)?this.map.set(p.id,p):Ef(p)&&this.map.set(p.topic,p)}),this.cached=[],this.initialized=!0)},this.set=async(p,o)=>{this.isInitialized(),this.map.has(p)?await this.update(p,o):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:p,value:o}),this.map.set(p,o),await this.persist())},this.get=p=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:p}),this.getData(p)),this.getAll=p=>(this.isInitialized(),p?this.values.filter(o=>Object.keys(p).every(l=>cu(o[l],p[l]))):this.values),this.update=async(p,o)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:p,update:o});const l=cs(cs({},this.getData(p)),o);this.map.set(p,l),await this.persist()},this.delete=async(p,o)=>{this.isInitialized(),this.map.has(p)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:p,reason:o}),this.map.delete(p),await this.persist())},this.logger=Se.generateChildLogger(r,this.name),this.storagePrefix=s,this.getKey=c}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:i}=pe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=pe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=pe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Pd{constructor(e,r){this.core=e,this.logger=r,this.name=id,this.version=nd,this.events=new so,this.initialized=!1,this.storagePrefix=Ut,this.ignoredPayloadTypes=[Qt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=xi(),s=await this.core.crypto.setSymKey(i),c=Lr(ye.FIVE_MINUTES),p={protocol:kl},o={topic:s,expiry:c,relay:p,active:!1},l=lf({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:p});return await this.pairings.set(s,o),await this.core.relayer.subscribe(s),this.core.expirer.set(s,c),{topic:s,uri:l}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:s,symKey:c,relay:p}=hf(i.uri);let o;if(this.pairings.keys.includes(s)&&(o=this.pairings.get(s),o.active))throw new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);this.core.crypto.keychain.has(s)||(await this.core.crypto.setSymKey(c,s),await this.core.relayer.subscribe(s,{relay:p}));const l=Lr(ye.FIVE_MINUTES),h={topic:s,relay:p,expiry:l,active:!1};return await this.pairings.set(s,h),this.core.expirer.set(s,l),i.activatePairing&&await this.activate({topic:s}),this.events.emit(Pr.create,h),h},this.activate=async({topic:i})=>{this.isInitialized();const s=Lr(ye.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:s}),this.core.expirer.set(i,s)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:s}=i;if(this.pairings.keys.includes(s)){const c=await this.sendRequest(s,"wc_pairingPing",{}),{done:p,resolve:o,reject:l}=Qh();this.events.once(ai("pairing_ping",c),({error:h})=>{h?l(h):o()}),await p()}},this.updateExpiry=async({topic:i,expiry:s})=>{this.isInitialized(),await this.pairings.update(i,{expiry:s})},this.updateMetadata=async({topic:i,metadata:s})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:s}=i;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",yt("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(i,s,c)=>{const p=zi(s,c),o=await this.core.crypto.encode(i,p),l=or[s].req;return this.core.history.set(i,p),this.core.relayer.publish(i,o,l),p.id},this.sendResult=async(i,s,c)=>{const p=Qs(i,c),o=await this.core.crypto.encode(s,p),l=await this.core.history.get(s,i),h=or[l.request.method].res;await this.core.relayer.publish(s,o,h),await this.core.history.resolve(p)},this.sendError=async(i,s,c)=>{const p=Zs(i,c),o=await this.core.crypto.encode(s,p),l=await this.core.history.get(s,i),h=or[l.request.method]?or[l.request.method].res:or.unregistered_method.res;await this.core.relayer.publish(s,o,h),await this.core.history.resolve(p)},this.deletePairing=async(i,s)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,yt("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),s?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(s=>Mn(s.expiry));await Promise.all(i.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=i=>{const{topic:s,payload:c}=i;switch(c.method){case"wc_pairingPing":return this.onPairingPingRequest(s,c);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,c);default:return this.onUnknownRpcMethodRequest(s,c)}},this.onRelayEventResponse=async i=>{const{topic:s,payload:c}=i,p=(await this.core.history.get(s,c.id)).request.method;switch(p){case"wc_pairingPing":return this.onPairingPingResponse(s,c);default:return this.onUnknownRpcMethodResponse(p)}},this.onPairingPingRequest=async(i,s)=>{const{id:c}=s;try{this.isValidPing({topic:i}),await this.sendResult(c,i,!0),this.events.emit(Pr.ping,{id:c,topic:i})}catch(p){await this.sendError(c,i,p),this.logger.error(p)}},this.onPairingPingResponse=(i,s)=>{const{id:c}=s;setTimeout(()=>{ia(s)?this.events.emit(ai("pairing_ping",c),{}):Wr(s)&&this.events.emit(ai("pairing_ping",c),{error:s.error})},500)},this.onPairingDeleteRequest=async(i,s)=>{const{id:c}=s;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(Pr.delete,{id:c,topic:i})}catch(p){await this.sendError(c,i,p),this.logger.error(p)}},this.onUnknownRpcMethodRequest=async(i,s)=>{const{id:c,method:p}=s;try{if(this.registeredMethods.includes(p))return;const o=yt("WC_METHOD_UNSUPPORTED",p);await this.sendError(c,i,o),this.logger.error(o)}catch(o){await this.sendError(c,i,o),this.logger.error(o)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(yt("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!oi(i)){const{message:s}=pe("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(s)}if(!vf(i.uri)){const{message:s}=pe("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(s)}},this.isValidPing=async i=>{if(!oi(i)){const{message:c}=pe("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(c)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidDisconnect=async i=>{if(!oi(i)){const{message:c}=pe("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(c)}const{topic:s}=i;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async i=>{if(!ht(i,!1)){const{message:s}=pe("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(s)}if(!this.pairings.keys.includes(i)){const{message:s}=pe("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(s)}if(Mn(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:s}=pe("EXPIRED",`pairing topic: ${i}`);throw new Error(s)}},this.core=e,this.logger=Se.generateChildLogger(r,this.name),this.pairings=new Nd(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Se.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=pe("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(it.message,async e=>{const{topic:r,message:i}=e;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const s=await this.core.crypto.decode(r,i);try{ra(s)?(this.core.history.set(r,s),this.onRelayEventRequest({topic:r,payload:s})):Ki(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:r,payload:s}),this.core.history.delete(r,s.id))}catch(c){this.logger.error(c)}})}registerExpirerEvents(){this.core.expirer.on(gt.expired,async e=>{const{topic:r}=tf(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(Pr.expire,{topic:r}))})}}class Ad extends sc{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new Nt.EventEmitter,this.name=sd,this.version=ad,this.cached=[],this.initialized=!1,this.storagePrefix=Ut,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,s,c)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:s,chainId:c}),this.records.has(s.id))return;const p={id:s.id,topic:i,request:{method:s.method,params:s.params||null},chainId:c,expiry:Lr(ye.THIRTY_DAYS)};this.records.set(p.id,p),this.events.emit(_t.created,p)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const s=await this.getRecord(i.id);typeof s.response>"u"&&(s.response=Wr(i)?{error:i.error}:{result:i.result},this.records.set(s.id,s),this.events.emit(_t.updated,s))},this.get=async(i,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:s}),await this.getRecord(s)),this.delete=(i,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(c=>{if(c.topic===i){if(typeof s<"u"&&c.id!==s)return;this.records.delete(c.id),this.events.emit(_t.deleted,c)}})},this.exists=async(i,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===i:!1),this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:zi(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=pe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(_t.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=pe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(_t.created,e=>{const r=_t.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(_t.updated,e=>{const r=_t.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(_t.deleted,e=>{const r=_t.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.core.heartbeat.on(Yt.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{ye.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=pe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Rd extends uc{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new Nt.EventEmitter,this.name=od,this.version=cd,this.cached=[],this.initialized=!1,this.storagePrefix=Ut,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const s=this.formatTarget(i);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(i,s)=>{this.isInitialized();const c=this.formatTarget(i),p={target:c,expiry:s};this.expirations.set(c,p),this.checkExpiry(c,p),this.events.emit(gt.created,{target:c,expiration:p})},this.get=i=>{this.isInitialized();const s=this.formatTarget(i);return this.getExpiration(s)},this.del=i=>{if(this.isInitialized(),this.has(i)){const s=this.formatTarget(i),c=this.getExpiration(s);this.expirations.delete(s),this.events.emit(gt.deleted,{target:s,expiration:c})}},this.on=(i,s)=>{this.events.on(i,s)},this.once=(i,s)=>{this.events.once(i,s)},this.off=(i,s)=>{this.events.off(i,s)},this.removeListener=(i,s)=>{this.events.removeListener(i,s)},this.logger=Se.generateChildLogger(r,this.name)}get context(){return Se.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Zh(e);if(typeof e=="number")return ef(e);const{message:r}=pe("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(gt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=pe("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=pe("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;ye.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(gt.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Yt.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(gt.created,e=>{const r=gt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(gt.expired,e=>{const r=gt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(gt.deleted,e=>{const r=gt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=pe("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Ld extends lc{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.name=fi,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async()=>{if(this.verifyDisabled||yr()||!Gr())return;const i=ui;this.verifyUrl!==i&&this.removeIframe(),this.verifyUrl=i;try{await this.createIframe()}catch(s){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(s)}if(!this.initialized){this.removeIframe(),this.verifyUrl=ts;try{await this.createIframe()}catch(s){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(s),this.verifyDisabled=!0}}},this.register=async i=>{this.initialized?this.sendPost(i.attestationId):(this.addToQueue(i.attestationId),await this.init())},this.resolve=async i=>{if(this.isDevEnv)return"";const s=(i==null?void 0:i.verifyUrl)||ui;let c;try{c=await this.fetchAttestation(i.attestationId,s)}catch(p){this.logger.info(`failed to resolve attestation: ${i.attestationId} from url: ${s}`),this.logger.info(p),c=await this.fetchAttestation(i.attestationId,ts)}return c},this.fetchAttestation=async(i,s)=>{this.logger.info(`resolving attestation: ${i} from url: ${s}`);const c=this.startAbortTimer(ye.ONE_SECOND*2),p=await fetch(`${s}/attestation/${i}`,{signal:this.abortController.signal});return clearTimeout(c),p.status===200?await p.json():void 0},this.addToQueue=i=>{this.queue.push(i)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(i=>this.sendPost(i)),this.queue=[])},this.sendPost=i=>{var s;try{if(!this.iframe)return;(s=this.iframe.contentWindow)==null||s.postMessage(i,"*"),this.logger.info(`postMessage sent: ${i} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let i;const s=c=>{c.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",s),i())};await Promise.race([new Promise(c=>{if(document.getElementById(fi))return c();window.addEventListener("message",s);const p=document.createElement("iframe");p.id=fi,p.src=`${this.verifyUrl}/${this.projectId}`,p.style.display="none",document.body.append(p),this.iframe=p,i=c}),new Promise((c,p)=>setTimeout(()=>{window.removeEventListener("message",s),p("verify iframe load timeout")},ye.toMiliseconds(ye.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=Se.generateChildLogger(r,this.name),this.verifyUrl=ui,this.abortController=new AbortController,this.isDevEnv=Di()&&hu.IS_VITEST}get context(){return Se.getLoggerContext(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),ye.toMiliseconds(e))}}var Ud=Object.defineProperty,hs=Object.getOwnPropertySymbols,Cd=Object.prototype.hasOwnProperty,Md=Object.prototype.propertyIsEnumerable,fs=(t,e,r)=>e in t?Ud(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,us=(t,e)=>{for(var r in e||(e={}))Cd.call(e,r)&&fs(t,r,e[r]);if(hs)for(var r of hs(e))Md.call(e,r)&&fs(t,r,e[r]);return t};class Fi extends nc{constructor(e){super(e),this.protocol=pa,this.version=Cl,this.name=Hi,this.events=new Nt.EventEmitter,this.initialized=!1,this.on=(i,s)=>this.events.on(i,s),this.once=(i,s)=>this.events.once(i,s),this.off=(i,s)=>this.events.off(i,s),this.removeListener=(i,s)=>this.events.removeListener(i,s),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||ya,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Se.pino(Se.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Ml.logger}));this.logger=Se.generateChildLogger(r,this.name),this.heartbeat=new Yt.HeartBeat,this.crypto=new fd(this,this.logger,e==null?void 0:e.keychain),this.history=new Ad(this,this.logger),this.expirer=new Rd(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Ho(us(us({},Dl),e==null?void 0:e.storageOptions)),this.relayer=new Sd({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Pd(this,this.logger),this.verify=new Ld(this.projectId||"",this.logger)}static async init(e){const r=new Fi(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(Zl,i),r}get context(){return Se.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const mg=Fi;export{Lr as $,mg as A,Pr as B,cu as C,it as D,Yt as E,Nd as F,Ho as G,dh as H,kt as I,Sn as J,Ns as K,eh as L,ru as M,pe as N,Xs as O,Js as P,gg as Q,Rh as R,gc as S,kd as T,Jd as U,Dh as V,Gd as W,kl as X,Qh as Y,ai as Z,Qt as _,Wr as a,ks as a0,Zd as a1,yt as a2,Qd as a3,tg as a4,Si as a5,Mn as a6,pg as a7,oi as a8,wt as a9,ng as aa,ig as ab,Nf as ac,dg as ad,ht as ae,ag as af,Pf as ag,rg as ah,fg as ai,og as aj,ug as ak,cg as al,hg as am,lg as an,ui as ao,gt as ap,tf as aq,sg as ar,bg as as,mr as at,eg as au,yf as av,Xd as aw,Vd as ax,Yd as ay,ra as b,Se as c,Ki as d,ye as e,Zs as f,zi as g,Qs as h,ia as i,vf as j,Ds as k,Li as l,Pi as m,Cs as n,fr as o,Ms as p,Gr as q,Jt as r,kr as s,qn as t,dr as u,Ys as v,tu as w,Ri as x,Kr as y,kf as z};
